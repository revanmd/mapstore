(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[138],{230138:(e,i,t)=>{"use strict";t.r(i),t.d(i,{default:()=>a});var n=t(845243),o=t.n(n),l=t(984596),r=t.n(l);const s={Point:["Mark","Icon","Text"],MultiPoint:["Mark","Icon","Text"],LineString:["Line"],MultiLineString:["Line"],Polygon:["Fill"],MultiPolygon:["Fill"]};function d(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.properties?Object.keys(e.properties).reduce(((i,t)=>{const n=new RegExp(`\\{\\{${t}\\}\\}`,"g");return i.replace(n,e.properties[t]??"")}),i):i}function c(e,i){let{rules:t=[]}=e,{geoStylerStyleFilter:n,images:l,getImageIdFromSymbolizer:c}=i;const a=[...t].reverse();return function(){let{opacity:e=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{filter:e=>{var i;const t=null==e||null===(i=e.geometry)||void 0===i?void 0:i.type;if(0===a.length)return!1;const o=s[t]||[];return!!a.find((i=>{var t;return(null==i||null===(t=i.symbolizers)||void 0===t?void 0:t.find((e=>o.includes(e.kind))))&&(!i.filter||n(e,i.filter))}))},pointToLayer:(i,t)=>{var u,y;const f=null==i||null===(u=i.geometry)||void 0===u?void 0:u.type,m=s[f]||[],g=a.find((e=>{var t;return(null==e||null===(t=e.symbolizers)||void 0===t?void 0:t.find((e=>m.includes(e.kind))))&&(!e.filter||n(i,e.filter))}))||{},h=(null==g||null===(y=g.symbolizers)||void 0===y?void 0:y.find((e=>m.includes(e.kind))))||{};if("Mark"===h.kind){const{image:i,src:n,width:r,height:s}=l.find((e=>{let{id:i}=e;return i===c(h)}))||{};if(i){const i=r/s,l=2*h.radius;let d=l,c=d/i;return s>r&&(c=l,d=c*i),o().marker(t,{icon:o().icon({iconUrl:n,iconSize:[d,c],iconAnchor:[d/2,c/2]}),opacity:1*e})}}if("Icon"===h.kind){const{image:i,src:n,width:r,height:s}=l.find((e=>{let{id:i}=e;return i===c(h)}))||{};if(i){const i=r/s;let l=h.size,d=l/i;return s>r&&(d=h.size,l=d*i),o().marker(t,{icon:o().icon({iconUrl:n,iconSize:[l,d],iconAnchor:[l/2,d/2]}),opacity:h.opacity*e})}}if("Text"===h.kind){var v,p;const n=d(i,h.label),l=`\n                        -webkit-text-stroke-width:${h.haloWidth}px;\n                        -webkit-text-stroke-color:${h.haloColor||""};\n                    `,s=o().divIcon({html:`<div style="\n                            color:${h.color};\n                            font-family: ${r()(h.font||[]).join(", ")};\n                            font-style: ${h.fontStyle||"normal"};\n                            font-weight: ${h.fontWeight||"normal"};\n                            font-size: ${h.size}px;\n\n                            position: absolute;\n                            transform: translate(${(null==h||null===(v=h.offset)||void 0===v?void 0:v[0])??0}px, ${(null==h||null===(p=h.offset)||void 0===p?void 0:p[1])??0}px) rotateZ(${(null==h?void 0:h.rotate)??0}deg);\n\n                            ${h.haloWidth>0?l:""}\n                        ">\n                            ${n}\n                            </div>`,className:""});return o().marker(t,{icon:s,opacity:1*e})}return null},style:i=>{var t,o;const l=null==i||null===(t=i.geometry)||void 0===t?void 0:t.type,r=s[l]||[],d=a.find((e=>{var t;return(null==e||null===(t=e.symbolizers)||void 0===t?void 0:t.find((e=>r.includes(e.kind))))&&(!e.filter||n(i,e.filter))}))||{},c=(null==d||null===(o=d.symbolizers)||void 0===o?void 0:o.find((e=>r.includes(e.kind))))||{};return"Line"===c.kind?{stroke:!0,fill:!1,color:c.color,opacity:c.opacity*e,weight:c.width,...c.dasharray&&{dashArray:c.dasharray.join(" ")},...c.cap&&{lineCap:c.cap},...c.join&&{lineJoin:c.join}}:"Fill"===c.kind?{fill:!0,stroke:!0,fillColor:c.color,fillOpacity:c.fillOpacity*e,color:c.outlineColor,opacity:(c.outlineOpacity??0)*e,weight:c.outlineWidth??0}:{stroke:!1,fill:!1}}}}}const a=class{constructor(){let{drawIcons:e,getImageIdFromSymbolizer:i,geoStylerStyleFilter:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._drawIcons=e||(()=>Promise.resolve(null)),this._getImageIdFromSymbolizer=i||(e=>e.symbolizerId),this._geoStylerStyleFilter=t||(()=>!0)}readStyle(){return new Promise(((e,i)=>{try{e(null)}catch(e){i(e)}}))}writeStyle(e){var i=this;return new Promise(((t,n)=>{try{this._drawIcons(e).then((function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const o=c(e,{images:n,getImageIdFromSymbolizer:i._getImageIdFromSymbolizer,geoStylerStyleFilter:i._geoStylerStyleFilter});t(o)}))}catch(e){n(e)}}))}}}}]);