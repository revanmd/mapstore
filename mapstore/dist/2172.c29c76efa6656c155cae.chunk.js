(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[2172],{592172:(t,e,n)=>{"use strict";n.d(e,{ZP:()=>C,Sq:()=>N});var a=n(124852),o=n.n(a),i=(n(707169),n(909041)),r=n(967134),l=n(867076),s=n(400043),c=n(45697),d=n.n(c),p=n(294184),u=n.n(p);function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const m="External Link";class h extends a.Component{constructor(){super(...arguments),g(this,"state",{expanded:!1}),g(this,"toggle",(()=>{this.setState((t=>({expanded:!t.expanded})))}))}render(){const{expanded:t}=this.state,{externalLinkOption:e,onSelectionChange:n,currentSelectOption:a,availableStorySections:i}=this.props;return o().createElement("div",{className:"rdw-block-wrapper","aria-label":"rdw-block-control"},o().createElement(r.Dropdown,{className:"ms-rdw-link-options-dropdown",onChange:n,expanded:t,doExpand:this.toggle,doCollapse:this.toggle,onExpandEvent:this.toggle,title:"MSLinks"},o().createElement("span",null,a),o().createElement(r.DropdownOption,{active:!0,value:{value:e,label:e},key:e},"External Link"),i&&i.map((t=>o().createElement(r.DropdownOption,{active:t.id===a,value:{value:t.id,label:t.title||t.type||t.id},key:t.id},t.title||t.type||t.id)))))}}g(h,"propTypes",{externalLinkOption:d().string,onSelectionChange:d().func,currentSelectOption:d().string,availableStorySections:d().array});class k extends a.Component{constructor(){super(...arguments),g(this,"state",{showModal:!1,linkTarget:"",linkTitle:"",attributes:{},linkTargetOption:this.props.config.defaultTargetOption,currentSelectOption:"Select link target"}),g(this,"removeLink",(()=>{const{onChange:t}=this.props;t("unlink")})),g(this,"addLink",(()=>{const{onChange:t}=this.props,{linkTitle:e,linkTarget:n,linkTargetOption:a,attributes:o}=this.state;t("link",e,n,a,o)})),g(this,"updateValue",(t=>{this.setState({[`${t.target.name}`]:t.target.value})})),g(this,"onSelectionChange",(t=>{t.value===m?this.setState({linkTarget:"",attributes:{},currentSelectOption:t.label}):this.setState({linkTarget:t.value,attributes:{"data-geostory-interaction-type":"scrollTo","data-geostory-interaction-params":`${t.value}`,"data-geostory-interaction-name":t.label},currentSelectOption:t.label})})),g(this,"updateTargetOption",(t=>{this.setState({linkTargetOption:t.target.checked?"_blank":"_self"})})),g(this,"hideModal",(()=>{this.setState({showModal:!1})})),g(this,"signalExpandShowModal",(()=>{const{onExpandEvent:t,currentState:{link:e,selectionText:n}}=this.props,{linkTargetOption:a}=this.state;t();let o="Select link target";null!=e&&e.target&&e.target.length>0&&(o=m),null!=e&&e.attributes["data-geostory-interaction-name"]&&(o=e.attributes["data-geostory-interaction-name"]),this.setState({showModal:!0,linkTarget:e&&e.target||"",linkTargetOption:e&&e.targetOption||a,linkTitle:e&&e.title||n,attributes:e&&e.attributes||{},currentSelectOption:o})})),g(this,"forceExpandAndShowModal",(()=>{const{doExpand:t,currentState:{link:e,selectionText:n}}=this.props,{linkTargetOption:a}=this.state;t();let o="Select link target";null!=e&&e.target&&e.target.length>0&&(o=m),null!=e&&e.attributes["data-geostory-interaction-name"]&&(o=e.attributes["data-geostory-interaction-name"]),this.setState({showModal:!0,linkTarget:e&&e.target,linkTargetOption:e&&e.targetOption||a,linkTitle:e&&e.title||n,attributes:e&&e.attributes||{},currentSelectOption:o})}))}componentDidUpdate(t){t.expanded&&!this.props.expanded&&this.setState({showModal:!1,linkTarget:"",linkTitle:"",attributes:{},linkTargetOption:this.props.config.defaultTargetOption,currentSelectOption:"Select link target"})}renderAddLinkModal(){const{config:{popupClassName:t},doCollapse:e,translations:n,availableStorySections:a}=this.props,{linkTitle:i,linkTarget:l,linkTargetOption:s,currentSelectOption:c}=this.state;return o().createElement("div",{className:u()("rdw-link-modal",t),onClick:r.stopPropagation},o().createElement("label",{className:"rdw-link-modal-label",htmlFor:"linkTitle"},n["components.controls.link.linkTitle"]),o().createElement("input",{id:"linkTitle",className:"rdw-link-modal-input",onChange:this.updateValue,onBlur:this.updateValue,name:"linkTitle",value:i}),o().createElement("label",{className:"rdw-link-modal-label",htmlFor:"linkTarget"},n["components.controls.link.linkTarget"]),o().createElement(h,{externalLinkOption:m,currentSelectOption:c,onSelectionChange:this.onSelectionChange,availableStorySections:a}),c===m&&o().createElement(o().Fragment,null,o().createElement("input",{id:"linkTarget",className:"rdw-link-modal-input",onChange:this.updateValue,onBlur:this.updateValue,name:"linkTarget",value:l}),o().createElement("label",{className:"rdw-link-modal-target-option",htmlFor:"openLinkInNewWindow"},o().createElement("input",{id:"openLinkInNewWindow",type:"checkbox",defaultChecked:"_blank"===s,value:"_blank",onChange:this.updateTargetOption}),o().createElement("span",null,n["components.controls.link.linkTargetOption"]))),o().createElement("span",{className:"rdw-link-modal-buttonsection"},o().createElement("button",{className:"rdw-link-modal-btn",onClick:this.addLink,disabled:!l||!i},n["generic.add"]),o().createElement("button",{className:"rdw-link-modal-btn",onClick:e},n["generic.cancel"])))}renderInFlatList(){const{config:{options:t,link:e,unlink:n,className:a},currentState:i,expanded:l,translations:s}=this.props,{showModal:c}=this.state;return o().createElement("div",{className:u()("rdw-link-wrapper",a),"aria-label":"rdw-link-control"},t.indexOf("link")>=0&&o().createElement(r.Option,{value:"unordered-list-item",className:u()(e.className),onClick:this.signalExpandShowModal,"aria-haspopup":"true","aria-expanded":c,title:e.title||s["components.controls.link.link"]},o().createElement("img",{src:e.icon,alt:""})),t.indexOf("unlink")>=0&&o().createElement(r.Option,{disabled:!i.link,value:"ordered-list-item",className:u()(n.className),onClick:this.removeLink,title:n.title||s["components.controls.link.unlink"]},o().createElement("img",{src:n.icon,alt:""})),l&&c?this.renderAddLinkModal():void 0)}renderInDropDown(){const{expanded:t,onExpandEvent:e,doCollapse:n,doExpand:a,onChange:i,config:l,currentState:s,translations:c}=this.props,{options:d,link:p,unlink:g,className:m,dropdownClassName:h,title:k}=l,{showModal:b}=this.state;return o().createElement("div",{className:"rdw-link-wrapper","aria-haspopup":"true","aria-label":"rdw-link-control","aria-expanded":t,title:k},o().createElement(r.Dropdown,{className:u()("rdw-link-dropdown",m),optionWrapperClassName:u()(h),onChange:i,expanded:t&&!b,doExpand:a,doCollapse:n,onExpandEvent:e},o().createElement("img",{src:(0,r.getFirstIcon)(l),alt:""}),d.indexOf("link")>=0&&o().createElement(r.DropdownOption,{onClick:this.forceExpandAndShowModal,className:u()("rdw-link-dropdownoption",p.className),title:p.title||c["components.controls.link.link"]},o().createElement("img",{src:p.icon,alt:""})),d.indexOf("unlink")>=0&&o().createElement(r.DropdownOption,{onClick:this.removeLink,disabled:!s.link,className:u()("rdw-link-dropdownoption",g.className),title:g.title||c["components.controls.link.unlink"]},o().createElement("img",{src:g.icon,alt:""}))),t&&b?this.renderAddLinkModal():void 0)}render(){const{config:{inDropdown:t}}=this.props;return t?this.renderInDropDown():this.renderInFlatList()}}g(k,"propTypes",{expanded:d().bool,doExpand:d().func,doCollapse:d().func,onExpandEvent:d().func,config:d().object,onChange:d().func,currentState:d().object,translations:d().object,modalHandler:d().any});const b=k;function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function w(t,e,n){t.findEntityRanges((t=>{const e=t.getEntity();return null!==e&&"LINK"===n.getEntity(e).getType()}),e)}function v(t){var e;const{showOpenOptionOnHover:n}=t;return e=class extends a.Component{constructor(){super(...arguments),y(this,"state",{showPopOver:!1}),y(this,"openLink",(()=>{const{entityKey:t,contentState:e}=this.props,{url:n}=e.getEntity(t).getData(),a=window.open(n,"blank");a&&a.focus()})),y(this,"toggleShowPopOver",(()=>{const t=!this.state.showPopOver;this.setState({showPopOver:t})})),y(this,"renderDecorator",(()=>{const{children:t,entityKey:e,contentState:a}=this.props,{url:i,targetOption:l,attributes:s}=a.getEntity(e).getData(),{showPopOver:c}=this.state;return s&&s["data-geostory-interaction-type"]?o().createElement("span",{className:"rdw-link-decorator-wrapper"},o().createElement("a",{"data-geostory-interaction-type":s["data-geostory-interaction-type"],"data-geostory-interaction-params":s["data-geostory-interaction-params"]},t)):o().createElement("span",{className:"rdw-link-decorator-wrapper",onMouseEnter:this.toggleShowPopOver,onMouseLeave:this.toggleShowPopOver},o().createElement("a",{href:i,target:l},t),c&&n?o().createElement("img",{src:r.openlink,alt:"",onClick:this.openLink,className:"rdw-link-decorator-icon"}):void 0)}))}render(){return this.renderDecorator()}},y(e,"propTypes",{entityKey:d().string.isRequired,children:d().array,contentState:d().object}),e}const E=t=>({strategy:w,component:v(t)});var S=n(406714);function f(){return f=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},f.apply(this,arguments)}const N=(0,l.compose)((0,l.withProps)((t=>{let{storyFonts:e=[],placeholder:n,toolbarStyle:a={},className:o="ms-text-editor",toolbar:i={}}=t;return{editorRef:t=>setTimeout((()=>t&&t.focus&&t.focus()),100),stripPastedStyles:!0,placeholder:n,toolbarStyle:a,toolbar:{options:["fontFamily","blockType","fontSize","inline","textAlign","colorPicker","list","link","remove"],fontFamily:{options:e.length>0?e:s.Km,className:void 0,component:void 0,dropdownClassName:void 0},link:{inDropdown:!1,className:void 0,component:void 0,popupClassName:void 0,dropdownClassName:void 0,showOpenOptionOnHover:!0,defaultTargetOption:"_self",options:["link","unlink"],link:{icon:void 0,className:void 0},unlink:{icon:void 0,className:void 0},linkCallback:void 0},blockType:{inDropdown:!0,options:["Normal","H1","H2","H3","H4","H5","H6","Blockquote","Code"],className:void 0,component:void 0,dropdownClassName:void 0},inline:{options:["bold","italic","underline","strikethrough","monospace"],bold:{className:`${o}-toolbar-btn`},italic:{className:`${o}-toolbar-btn`},underline:{className:`${o}-toolbar-btn`},strikethrough:{className:`${o}-toolbar-btn`},code:{className:`${o}-toolbar-btn`}},textAlign:{left:{className:`${o}-toolbar-btn`},center:{className:`${o}-toolbar-btn`},right:{className:`${o}-toolbar-btn`},justify:{className:`${o}-toolbar-btn`}},colorPicker:{className:`${o}-toolbar-btn`},remove:{className:`${o}-toolbar-btn`},...i},toolbarClassName:`${o}-toolbar`,wrapperClassName:`${o}-wrapper`,editorClassName:`${o}-main`}})),(0,l.renderComponent)(r.Editor)),O=(0,l.compose)((0,l.lifecycle)({componentWillUnmount(){const{editorState:t,save:e=(()=>{})}=this.props;e((0,S.sc)(t,s.gg))}}),(0,l.withHandlers)({onBlur:t=>{let{toggleEditing:e=(()=>{})}=t;return()=>{e(!1)}}}),(0,l.withProps)((t=>{let{sections:e=[]}=t;return{availableStorySections:e.reduce(((t,e)=>{const n=[];return[s.ID.IMMERSIVE,s.ID.CAROUSEL].includes(e.type)?e.contents.forEach((t=>{n.push(t)})):n.push(e),[...t,...n]}),[])}})),(0,l.withProps)((t=>{let{availableStorySections:e=[]}=t;return{toolbar:{link:{inDropdown:!1,className:void 0,component:t=>o().createElement(b,f({},t,{availableStorySections:e})),popupClassName:void 0,dropdownClassName:void 0,showOpenOptionOnHover:!0,defaultTargetOption:"_self",options:["link","unlink"],link:{icon:void 0,className:void 0},unlink:{icon:void 0,className:void 0},linkCallback:void 0,getLinkDecorator:E}}}})),N),C=(0,l.compose)((0,l.withState)("contentEditing","setContentEditing",!1),(0,l.withState)("editorState","onEditorStateChange"),(0,l.withHandlers)({toggleEditing:t=>{let{bubblingTextEditing:e=(()=>{}),sectionType:n,onEditorStateChange:a=(()=>{}),setContentEditing:o=(()=>{})}=t;return(t,r)=>{if(t){let t=(0,S.n0)(r);if(n===s.ID.TITLE&&"unstyled"===i.RichUtils.getCurrentBlockType(t)){let e=t.getCurrentContent();e=i.Modifier.setBlockType(e,i.EditorState.createWithContent(e).getSelection(),"header-one"),t=i.EditorState.createWithContent(e)}a(t),o(!0),e(!0)}else o(!1),e(!1)}}}),(0,l.branch)((t=>{let{contentEditing:e}=t;return!!e}),O))},406714:(t,e,n)=>{"use strict";n.d(e,{n0:()=>d,sc:()=>p});var a=n(909041),o=n(689265),i=n.n(o),r=n(717247),l=n.n(r);const s=t=>{let e;if(t instanceof HTMLAnchorElement){const n={};if(t.dataset&&void 0!==t.dataset.mention)n.url=t.href,n.text=t.innerHTML,n.value=t.dataset.value,e=a.Entity.__create("MENTION","IMMUTABLE",n);else{n.url=t.getAttribute&&t.getAttribute("href")||t.href,n.title=t.innerHTML,n.targetOption=t.target;const o=t.getAttribute&&t.getAttribute("data-geostory-interaction-type"),i=t.getAttribute&&t.getAttribute("data-geostory-interaction-params"),r=t.getAttribute&&t.getAttribute("data-geostory-interaction-name");let l={};r&&i&&o&&(l["data-geostory-interaction-type"]=o,l["data-geostory-interaction-params"]=i,l["data-geostory-interaction-name"]=r),n.attributes=l,e=a.Entity.__create("LINK","MUTABLE",n)}}return e},c=(t,e)=>{if("MENTION"===t.type)return`< href="${t.data.url}" class="wysiwyg-mention" data-mention data-value="${t.data.value}">${e}</a>`;if("LINK"===t.type){const n=t.data.targetOption||"_self",a=t.data.attributes;return a&&a["data-geostory-interaction-type"]?`<a data-geostory-interaction-name="${a["data-geostory-interaction-name"]}" data-geostory-interaction-type="${a["data-geostory-interaction-type"]}" data-geostory-interaction-params="${a["data-geostory-interaction-params"]}" onclick="__geostory_interaction(type='scrollTo', '${a["data-geostory-interaction-params"]}')">${e}</a>`:`<a href="${t.data.url}" target="${n}">${e}</a>`}if("IMAGE"===t.type){const e=t.data.alignment,n=e&&"none"!==e?`float: ${e};`:"display: block; margin: 0 auto 0 auto;";return`<img src="${t.data.src}" alt="${t.data.alt}" style="height: ${t.data.height}; width: ${t.data.width}; ${n}" />`}return"EMBEDDED_LINK"===t.type?`<iframe width="${t.data.width}" height="${t.data.height}" src="${t.data.src}" frameBorder="0"></iframe>`:e},d=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const e=l()(t,null,s),n=a.ContentState.createFromBlockArray(e.contentBlocks);return a.EditorState.createWithContent(n)},p=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t){const n=1!==(0,a.convertToRaw)(t.getCurrentContent()).blocks.length||(0,a.convertToRaw)(t.getCurrentContent()).blocks[0].text,o=i()((0,a.convertToRaw)(t.getCurrentContent()),null,null,c);return n?o:e}return e}}}]);