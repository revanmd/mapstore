(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[3026],{278426:(e,t,s)=>{"use strict";s.d(t,{Z:()=>E});var o=s(124852),i=s.n(o),r=s(45697),n=s.n(r),a=s(409669),p=s.n(a),l=s(618446),h=s.n(l),m=s(352353),u=s.n(m),c=s(313311),g=s.n(c),d=s(984596),y=s.n(d),v=s(923715),f=s(847529),b=s(119950),L=s(169141);function x(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class E extends i().Component{constructor(){super(...arguments),x(this,"addFeatures",(e=>{const t=new L.Z;let s=null,o=!1;"FeatureCollection"===e.type?(s={features:u()(e.properties.visibility)||e.properties.visibility?e.features:[]},o=!!e.features):(s={geometry:e.geometry},o=!(!e.geometry||!e.geometry.geometries&&!e.geometry.coordinates)),e.container&&o&&(this._feature=t.readFeatures({type:e.type,properties:e.properties,id:e.msId,...s},{dataProjection:e.featuresCrs}),this._feature.map((t=>{let s=t;return t.getProperties().isCircle&&(s=(0,f.aj)(t,e.crs||"EPSG:3857",e.featuresCrs),s.setGeometry(s.getGeometry().transform(e.crs||"EPSG:3857",e.featuresCrs))),s})).forEach((t=>t.getGeometry().transform(e.featuresCrs,e.crs||"EPSG:3857"))),e.style&&e.style!==e.layerStyle&&this._feature.forEach((t=>{let s=[],o={};"FeatureCollection"===e.type?(o=g()(e.features,(e=>e.properties.id===t.getProperties().id)),s=(0,b.createStylesAsync)(y()(o.style))):(s=(0,b.createStylesAsync)(y()(e.style)),o={type:e.type,geometry:e.geometry,properties:e.properties,style:e.style}),p().all(s).then((e=>{t.setStyle((()=>(0,v.Cw)({...o,style:e})))}))})),e.container.getSource().addFeatures(this._feature))})),x(this,"removeFromContainer",(()=>{if(this._feature)if(Array.isArray(this._feature)){const e=this.props.container.getSource();this._feature.map((t=>{let s=t.getId();void 0!==s&&e.getFeatureById(s)?e.removeFeature(e.getFeatureById(s)):e.removeFeature(t)}))}else this.props.container.getSource().removeFeature(this._feature)}))}componentDidMount(){this.addFeatures(this.props)}shouldComponentUpdate(e){return!(h()(e.properties,this.props.properties)&&h()(e.geometry,this.props.geometry)&&h()(e.features,this.props.features)&&h()(e.crs,this.props.crs)&&h()(e.style,this.props.style))}UNSAFE_componentWillUpdate(e){this.removeFromContainer(),this.addFeatures(e)}componentWillUnmount(){this.removeFromContainer()}render(){return null}}x(E,"propTypes",{type:n().string,layerStyle:n().object,style:n().object,properties:n().object,crs:n().string,container:n().object,features:n().array,geometry:n().object,msId:n().oneOfType([n().string,n().number]),featuresCrs:n().string}),x(E,"defaultProps",{featuresCrs:"EPSG:4326"})},877758:(e,t,s)=>{"use strict";s.d(t,{Z:()=>S});var o=s(45697),i=s.n(o),r=s(124852),n=s.n(r),a=s(477434),p=s(351546),l=s(727418),h=s.n(l),m=s(49977),u=s.n(m),c=s(281763),g=s.n(c),d=s(701469),y=s.n(d),v=s(957557),f=s.n(v),b=s(618446),L=s.n(b),x=s(414293),E=s.n(x),O=s(835516);function w(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class S extends n().Component{constructor(){super(...arguments),w(this,"setLayerVisibility",(e=>{const t=this.props.options&&!1!==this.props.options.visibility,s=e.options&&!1!==e.options.visibility;s!==t&&this.layer&&this.isValid()&&this.layer.setVisible(s)})),w(this,"setLayerOpacity",(e=>{e!==(this.props.options&&void 0!==this.props.options.opacity?this.props.options.opacity:1)&&this.layer&&this.layer.setOpacity(e)})),w(this,"generateOpts",((e,t,s,o,i,r)=>{const{minResolution:n,maxResolution:a,disableResolutionLimits:p,...l}=e,m={...l,...!p&&{minResolution:n,maxResolution:a,minZoom:E()(a)?void 0:(0,O.getZoomFromResolution)(a,r),maxZoom:E()(n)?void 0:(0,O.getZoomFromResolution)(n,r)}};return h()({},m,g()(t)?{zIndex:t}:null,{srs:s,onError:()=>{this.props.onCreationError(m)},securityToken:o,env:i})})),w(this,"createLayer",((e,t,s,o,i,r)=>{if(e){const n=this.generateOpts(t,s,(0,p.normalizeSRS)(this.props.srs),o,i,r);this.layer=a.default.createLayer(e,n,this.props.map,this.props.mapId);const l=a.default.isCompatible(e,n);if(this.layer&&!this.layer.detached){const e=this.props.map,s=e&&e.getView().getProjection().getExtent(),o=t&&t.bbox&&t.bbox.bounds,i=s&&(0,p.reprojectBbox)(s,this.props.srs,"EPSG:4326");let r=o&&(0,p.reprojectBbox)((0,p.getExtentFromNormalized)(o,this.props.srs).extent,"EPSG:4326");r&&2===r.length&&y()(r[1])&&(r=r[1]),(i&&r&&!(0,p.isBboxCompatible)((0,p.getPolygonFromExtent)(i),(0,p.getPolygonFromExtent)(r))||!l)&&this.props.onWarning({title:"warning",message:"notification.incompatibleDataAndProjection",action:{label:"close"},position:"tc",uid:"1"}),this.addLayer(t)}this.layer&&this.layer.get&&this.layer.get("getElevation")&&this.props.map.set("elevationLayer",this.layer),this.forceUpdate()}})),w(this,"updateLayer",((e,t)=>{if(e.position===t.position&&e.srs===t.srs&&e.securityToken===t.securityToken){if(e.options===t.options)return;if(L()(f()(e.options,["loading"]),f()(t.options,["loading"])))return}const s=a.default.updateLayer(this.props.type,this.layer,this.generateOpts(e.options,e.position,e.projection,e.securityToken,e.env,e.resolutions),this.generateOpts(t.options,t.position,t.projection,t.securityToken,t.env,t.resolutions),this.props.map,this.props.mapId);s&&(s.detached?this.layer=s:(this.props.map.removeLayer(this.layer),this.layer=s,this.addLayer(e.options)))})),w(this,"addLayer",(e=>{if(this.isValid()){this.props.map.addLayer(this.layer);const t=new(u().Subject),s=new(u().Subject);e.handleClickOnLayer&&this.layer.set("handleClickOnLayer",!0),this.layer.getSource().on("tileloadstart",(()=>{0===this.tilestoload?(this.props.onLayerLoading(e.id),this.tilestoload++):this.tilestoload++})),this.layer.getSource().on("tileloadend",(()=>{t.next({type:"tileloadend"}),this.tilestoload--,0===this.tilestoload&&s.next()})),this.layer.getSource().on("tileloaderror",(e=>{t.next({type:"tileloaderror",event:e}),this.tilestoload--,0===this.tilestoload&&s.next()})),t.bufferWhen((()=>s)).subscribe({next:t=>{const s=t.filter((e=>"tileloaderror"===e.type));s.length>0&&(e&&!e.hideErrors||!e)?(this.props.onLayerLoad(e.id,{error:!0}),this.props.onLayerError(e.id,t.length,s.length)):this.props.onLayerLoad(e.id)}}),this.tileLoadEndStream$=t,this.tileStopStream$=s;const o=new(u().Subject),i=new(u().Subject);if(this.layer.getSource().on("imageloadstart",(()=>{0===this.imagestoload?(this.props.onLayerLoading(e.id),this.imagestoload++):this.imagestoload++})),this.layer.getSource().on("imageloadend",(()=>{this.imagestoload--,o.next({type:"imageloadend"}),0===this.imagestoload&&i.next()})),this.layer.getSource().on("imageloaderror",(e=>{this.imagestoload--,o.next({type:"imageloaderror",event:e}),0===this.imagestoload&&i.next()})),o.bufferWhen((()=>i)).subscribe({next:t=>{const s=t.filter((e=>"imageloaderror"===e.type));s.length>0?(this.props.onLayerLoad(e.id,{error:!0}),(e&&!e.hideErrors||!e)&&this.props.onLayerError(e.id,t.length,s.length)):this.props.onLayerLoad(e.id)}}),this.imageLoadEndStream$=o,this.imageStopStream$=i,this.layer.getSource().on("vectorerror",(()=>{this.props.onLayerLoad(e.id,{error:!0})})),e.refresh){let t=0;this.refreshTimer=setInterval((()=>{this.layer.getSource().updateParams(h()({},e.params,{_refreshCounter:t++}))}),e.refresh)}}})),w(this,"isValid",(()=>{const e=a.default.isValid(this.props.type,this.layer);return this.valid=e,e}))}componentDidMount(){this.valid=!0,this.tilestoload=0,this.imagestoload=0,this.createLayer(this.props.type,this.props.options,this.props.position,this.props.securityToken,this.props.env,this.props.resolutions)}UNSAFE_componentWillReceiveProps(e){this.setLayerVisibility(e);const t=e.options&&void 0!==e.options.opacity?e.options.opacity:1;this.setLayerOpacity(t),e.position!==this.props.position&&this.layer&&this.layer.setZIndex&&this.layer.setZIndex(e.position),this.props.options&&this.updateLayer(e,this.props)}componentWillUnmount(){this.layer&&this.props.map&&(this.tileLoadEndStream$&&(this.tileLoadEndStream$.complete(),this.tileStopStream$.complete(),this.imageLoadEndStream$.complete(),this.imageStopStream$.complete()),this.layer.detached?this.layer.remove():this.props.map.removeLayer(this.layer)),this.refreshTimer&&clearInterval(this.refreshTimer),a.default.removeLayer(this.props.type,this.props.options,this.props.map,this.props.mapId,this.layer)}render(){if(this.props.children){const e=this.layer,t=e?n().Children.map(this.props.children,(t=>t?n().cloneElement(t,{container:e,styleName:this.props.options&&this.props.options.styleName}):null)):null;return n().createElement(n().Fragment,null,t)}return a.default.renderLayer(this.props.type,this.props.options,this.props.map,this.props.mapId,this.layer)}}w(S,"propTypes",{onWarning:i().func,maxExtent:i().array,map:i().object,mapId:i().string,srs:i().string,type:i().string,options:i().object,onLayerLoading:i().func,onLayerError:i().func,onCreationError:i().func,onLayerLoad:i().func,position:i().number,observables:i().array,securityToken:i().string,env:i().array,resolutions:i().array}),w(S,"defaultProps",{observables:[],onLayerLoading:()=>{},onLayerLoad:()=>{},onLayerError:()=>{},onCreationError:()=>{},onWarning:()=>{},srs:"EPSG:3857"})},323113:(e,t,s)=>{"use strict";s.d(t,{Z:()=>A});var o=s(537566),i=s(573800),r=s(386306),n=s(370878),a=s(978471),p=s(276773),l=s(218672),h=s(99937),m=s(169141),u=s(159398),c=s(301908),g=s(45697),d=s.n(g),y=s(124852),v=s.n(y),f=s(727418),b=s.n(f),L=s(351546),x=s(234228),E=s(835516),O=s(444183);var w=s(782527),S=s(618446),P=s.n(S),T=s(313311),j=s.n(T),C=s(823493),M=s.n(C),I=s(701469),Z=s.n(I),k=s(414293),F=s.n(k),G=(s(745902),s(893379)),V=s.n(G),z=s(559896);function R(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}V()(z.Z,{insert:"head",singleton:!1}),z.Z.locals;const D=new m.Z;class B extends v().Component{constructor(){var e;super(...arguments),e=this,R(this,"getDocument",(()=>this.props.document||document)),R(this,"getResolutions",(e=>{if(this.props.mapOptions&&this.props.mapOptions.view&&this.props.mapOptions.view.resolutions)return this.props.mapOptions.view.resolutions;const t=(e?(0,l.U2)(e):this.map.getView().getProjection()).getExtent();return(0,E.getResolutionsForProjection)(e??this.map.getView().getProjection().getCode(),this.props.mapOptions.minResolution,this.props.mapOptions.maxResolution,this.props.mapOptions.minZoom,this.props.mapOptions.maxZoom,this.props.mapOptions.zoomFactor,t)})),R(this,"mouseMoveEvent",(e=>{if(!e.dragging&&e.coordinate){const t=this.map.get("elevationLayer")&&this.map.get("elevationLayer").get("getElevation");let s=e.coordinate.slice(),o=(0,l.bU)(s,this.props.projection),i=o[0]/360%1*360;i<-180?i+=360:i>180&&(i-=360),this.props.onMouseMove({y:o[1]||0,x:i||0,z:this.map.get("elevationLayer")&&this.map.get("elevationLayer").get("getElevation")(s,e.pixel)||void 0,crs:"EPSG:4326",pixel:{x:e.pixel[0],y:e.pixel[1]},latlng:{lat:o[1],lng:i,z:t&&t(s,e.pixel)||void 0},lat:o[1],lng:i,rawPos:e.coordinate.slice()})}})),R(this,"updateMapInfoState",(()=>{let e=this.map.getView(),t=e.getCenter(),s=e.getProjection().getExtent()||(0,L.getExtentForProjection)(this.props.projection);const o=e.getProjection().getCode();if(-1!==["EPSG:3857","EPSG:900913","EPSG:4326"].indexOf(o)||t&&t[0]>=s[0]&&t[0]<=s[2]&&t[1]>=s[1]&&t[1]<=s[3]){let t=this.normalizeCenter(e.getCenter()),s=e.calculateExtent(this.map.getSize()),i={width:this.map.getSize()[0],height:this.map.getSize()[1]};this.props.onMapViewChanges({x:t[0]||0,y:t[1]||0,crs:"EPSG:4326"},e.getZoom(),{bounds:{minx:s[0],miny:s[1],maxx:s[2],maxy:s[3]},crs:o,rotation:e.getRotation()},i,this.props.id,this.props.projection,void 0,e.getResolution())}})),R(this,"haveResolutionsChanged",(e=>{const t=this.props.mapOptions&&this.props.mapOptions.view?this.props.mapOptions.view.resolutions:void 0,s=e.mapOptions&&e.mapOptions.view?e.mapOptions.view.resolutions:void 0;return!P()(t,s)})),R(this,"createView",(function(e,t,s,o){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=i.restrictedExtent&&i.crs&&(0,L.reprojectBbox)(i.restrictedExtent,i.crs,(0,L.normalizeSRS)(s)),n=!o||o&&!o.view?b()({},o,{extent:r}):b()({},o),a=b()({},{projection:(0,L.normalizeSRS)(s),center:[e.x,e.y],zoom:t,minZoom:i.minZoom},n||{});return new p.ZP(a)})),R(this,"_updateMapPositionFromNewProps",(e=>{var t=this.map.getView();const s=this.props.center;if(e.center.y!==s.y||e.center.x!==s.x){let s=(0,L.reproject)({x:e.center.x,y:e.center.y},"EPSG:4326",e.projection,!0);t.setCenter([s.x,s.y])}Math.round(e.zoom)!==this.props.zoom&&t.setZoom(Math.round(e.zoom)),(e.bbox&&void 0!==e.bbox.rotation||this.bbox&&void 0!==this.bbox.rotation&&e.bbox.rotation!==this.props.bbox.rotation)&&t.setRotation(e.bbox.rotation)})),R(this,"normalizeCenter",(e=>{let t=(0,L.reproject)({x:e[0],y:e[1]},this.props.projection,"EPSG:4326",!0);return[t.x,t.y]})),R(this,"setMousePointer",(e=>{this.map&&(this.map.getViewport().style.cursor=e||"auto")})),R(this,"registerHooks",(()=>{this.props.hookRegister.registerHook(E.default.RESOLUTIONS_HOOK,(e=>this.getResolutions(e))),this.props.hookRegister.registerHook(E.default.RESOLUTION_HOOK,(()=>this.map.getView().getResolution())),this.props.hookRegister.registerHook(E.default.COMPUTE_BBOX_HOOK,((e,t)=>{var s=(0,L.reproject)([e.x,e.y],"EPSG:4326",this.props.projection);let o=this.createView(s,t,this.props.projection,this.props.mapOptions&&this.props.mapOptions.view,this.props.limits),i=this.map.getSize(),r=o.calculateExtent(i);return{bounds:{minx:r[0],miny:r[1],maxx:r[2],maxy:r[3]},crs:this.props.projection,rotation:this.map.getView().getRotation()}})),this.props.hookRegister.registerHook(E.default.GET_PIXEL_FROM_COORDINATES_HOOK,(e=>this.map.getPixelFromCoordinate(e))),this.props.hookRegister.registerHook(E.default.GET_COORDINATES_FROM_PIXEL_HOOK,(e=>this.map.getCoordinateFromPixel(e))),this.props.hookRegister.registerHook(E.default.ZOOM_TO_EXTENT_HOOK,(function(t){let{padding:s,crs:o,maxZoom:i,duration:r,nearest:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(0,L.reprojectBbox)(t,o,e.props.projection);a&&a[0]===a[2]&&a[1]===a[3]&&"EPSG:4326"===o&&Z()(t)&&-180===t[0]&&-90===t[1]&&(a=e.map.getView().getProjection().getExtent());let p=i;a&&a[0]===a[2]&&a[1]===a[3]&&F()(p)&&(p=21),e.map.getView().fit(a,{size:e.map.getSize(),padding:s&&[s.top||0,s.right||0,s.bottom||0,s.left||0],maxZoom:p,duration:r,nearest:n})}))}))}componentDidMount(){[{code:"EPSG:4269",def:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs",axisOrientation:"neu",extent:[-172.54,23.81,-47.74,86.46],worldExtent:[-172.54,23.81,-47.74,86.46]},...this.props.projectionDefs].forEach((e=>{const t=u.default.defs(e.code);var s,o,i,r,n;s=e.code,o=e.extent,i=e.worldExtent,r=e.axisOrientation||t.axis||"enu",n=t.units||"m",(0,l.Sx)(new O.Z({code:s,extent:o,worldExtent:i,axisOrientation:r,units:n}))}));let e=(0,L.reproject)([this.props.center.x,this.props.center.y],"EPSG:4326",this.props.projection);(0,c.z)(u.default);let t=b()(this.props.interactive?{}:{doubleClickZoom:!1,dragPan:!1,altShiftDragRotate:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,pinchRotate:!1,pinchZoom:!1},this.props.mapOptions.interactions),s=(0,o.ce)(b()({dragPan:!1,mouseWheelZoom:!1},t,{}));void 0!==t&&void 0!==t.dragPan||(this.dragPanInteraction=new i.Z({kinetic:!1}),s.extend([this.dragPanInteraction])),void 0!==t&&void 0!==t.mouseWheelZoom||(this.mouseWheelInteraction=new r.Z({duration:0}),s.extend([this.mouseWheelInteraction]));let p=(0,n.c)(b()({zoom:this.props.zoomControl,attributionOptions:b()({collapsible:!1},this.props.mapOptions.attribution&&this.props.mapOptions.attribution.container?{target:this.getDocument().querySelector(this.props.mapOptions.attribution.container)}:{})},this.props.mapOptions.controls)),h=new a.default({layers:[],controls:p,interactions:s,maxTilesLoading:1/0,target:this.getDocument().getElementById(this.props.id)||`${this.props.id}`,view:this.createView(e,Math.round(this.props.zoom),this.props.projection,this.props.mapOptions&&this.props.mapOptions.view,this.props.limits)});this.map=h,this.props.registerHooks&&this.registerHooks(),this.map.disabledListeners={},this.map.disableEventListener=e=>{this.map.disabledListeners[e]=!0},this.map.enableEventListener=e=>{delete this.map.disabledListeners[e]},this.map.getViewport().addEventListener("mouseout",(()=>{setTimeout((()=>this.props.onMouseOut()),150)})),h.on("moveend",this.updateMapInfoState),h.on("singleclick",(e=>{if(this.props.onClick&&!this.map.disabledListeners.singleclick){let t=this.map.getView(),s=e.coordinate.slice(),o=t.getProjection().getExtent()||(0,L.getExtentForProjection)(this.props.projection);if("EPSG:4326"===this.props.projection&&(s[0]=(0,L.normalizeLng)(s[0])),"EPSG:900913"!==this.props.projection&&"EPSG:3857"!==this.props.projection||(s=(0,l.bU)(s,this.props.projection),o=(0,L.reprojectBbox)(o,this.props.projection,"EPSG:4326")),s[0]>=o[0]&&s[0]<=o[2]&&s[1]>=o[1]&&s[1]<=o[3]){let t,o;t="EPSG:900913"!==this.props.projection&&"EPSG:3857"!==this.props.projection?(0,L.reproject)(s,this.props.projection,"EPSG:4326"):{x:s[0],y:s[1]};let i={};this.markerPresent=!1,h.forEachFeatureAtPixel(e.pixel,((e,s)=>{if(s&&s.get("handleClickOnLayer")){const i=e.getGeometry();if(!this.markerPresent&&"Point"===i.getType()){this.markerPresent=!0,o=s.get("msId");const e=(0,l.bU)(i.getFirstCoordinate(),this.props.projection);t={x:e[0],y:e[1]}}}if(null!=s&&s.get("msId")){const t=D.writeFeatureObject(e,{featureProjection:this.props.projection,dataProjection:"EPSG:4326"});i[s.get("msId")]=i[s.get("msId")]?[...i[s.get("msId")],t]:[t]}}));const r=Object.keys(i).map((e=>({id:e,features:i[e]}))),n=(0,L.normalizeLng)(t.x),a=this.map.get("elevationLayer")&&this.map.get("elevationLayer").get("getElevation");this.props.onClick({pixel:{x:e.pixel[0],y:e.pixel[1]},latlng:{lat:t.y,lng:n,z:a&&a(s,e.pixel)||void 0},rawPos:e.coordinate.slice(),modifiers:{alt:e.originalEvent.altKey,ctrl:e.originalEvent.ctrlKey,metaKey:e.originalEvent.metaKey,shift:e.originalEvent.shiftKey},intersectedFeatures:r},o)}}}));const m=M()(this.mouseMoveEvent,100);h.on("pointermove",m),this.updateMapInfoState(),this.setMousePointer(this.props.mousePointer),this.forceUpdate(),this.props.onResolutionsChange(this.getResolutions())}UNSAFE_componentWillReceiveProps(e){if(e.mousePointer!==this.props.mousePointer&&this.setMousePointer(e.mousePointer),e.zoomControl!==this.props.zoomControl&&(e.zoomControl?this.map.addControl(new h.Z):this.map.removeControl(this.map.getControls().getArray().filter((e=>e instanceof h.Z))[0])),this.map&&(this.props.mapOptions&&this.props.mapOptions.interactions)!==(e.mapOptions&&e.mapOptions.interactions)){const t=e.mapOptions.interactions||{},s=this.map.getInteractions().getArray();Object.keys(t).forEach((e=>{const{Instance:o,options:i}=w.hH[e]||{};let r=j()(s,(t=>w.hH[e]&&t instanceof o));r?r.setActive(t[e]):t[e]&&o&&this.map.addInteraction(new o(i))}))}if(this.map&&this.props.id!==e.mapStateSource&&this._updateMapPositionFromNewProps(e),this.map&&e.resize!==this.props.resize&&setTimeout((()=>{this.map.updateSize()}),0),this.map&&(this.props.projection!==e.projection||this.haveResolutionsChanged(e))||this.props.limits!==e.limits){if(this.props.projection!==e.projection||this.props.limits!==e.limits){let t=e.projection;const s=(0,L.reproject)([e.center.x,e.center.y],"EPSG:4326",t);this.map.setView(this.createView(s,e.zoom,e.projection,e.mapOptions&&e.mapOptions.view,e.limits)),this.props.onResolutionsChange(this.getResolutions())}this.map.getLayers().forEach((e=>{let t=e.getSource();t.getTileLoadFunction&&t.setTileLoadFunction(t.getTileLoadFunction())})),this.map.render()}}componentWillUnmount(){const e=this.props.mapOptions.attribution&&this.props.mapOptions.attribution.container&&this.getDocument().querySelector(this.props.mapOptions.attribution.container);if(e&&e.querySelector(".ol-attribution"))try{e.removeChild(e.querySelector(".ol-attribution"))}catch(e){}this.map&&this.map.setTarget(null)}render(){const e=this.map,t=e?v().Children.map(this.props.children,(t=>t?v().cloneElement(t,{map:e,mapId:this.props.id,onLayerLoading:this.props.onLayerLoading,onLayerError:this.props.onLayerError,onLayerLoad:this.props.onLayerLoad,projection:this.props.projection,onCreationError:this.props.onCreationError,resolutions:this.getResolutions()}):null)):null;return v().createElement("div",{id:this.props.id,style:this.props.style},t)}}R(B,"propTypes",{id:d().string,document:d().object,style:d().object,center:x.ZP.PropTypes.center,zoom:d().number.isRequired,mapStateSource:x.ZP.PropTypes.mapStateSource,projection:d().string,projectionDefs:d().array,onMapViewChanges:d().func,onResolutionsChange:d().func,onClick:d().func,mapOptions:d().object,zoomControl:d().bool,mousePointer:d().string,onMouseMove:d().func,onLayerLoading:d().func,onLayerLoad:d().func,onLayerError:d().func,resize:d().oneOfType([d().number,d().string]),measurement:d().object,changeMeasurementState:d().func,registerHooks:d().bool,hookRegister:d().object,interactive:d().bool,onCreationError:d().func,bbox:d().object,wpsBounds:d().object,onWarning:d().func,maxExtent:d().array,limits:d().object,onMouseOut:d().func}),R(B,"defaultProps",{id:"map",onMapViewChanges:()=>{},onResolutionsChange:()=>{},onCreationError:()=>{},onClick:null,onMouseMove:()=>{},mapOptions:{},projection:"EPSG:3857",projectionDefs:[],onLayerLoading:()=>{},onLayerLoad:()=>{},onLayerError:()=>{},resize:0,registerHooks:!0,hookRegister:E.default,interactive:!0,onMouseOut:()=>{},center:{x:13,y:45,crs:"EPSG:4326"},zoom:5});const A=B},36624:(e,t,s)=>{"use strict";s.d(t,{Z:()=>D});var o=s(124852),i=s.n(o),r=s(45697),n=s.n(r),a=s(59854),p=s.n(a),l=s(227361),h=s.n(l),m=s(618446),u=s.n(m),c=s(843624),g=s.n(c),d=s(610928),y=s.n(d),v=s(351546),f=s(556233),b=s(521923),L=s(923715),x=s(719648),E=s(782527),O=s(944538),w=s(640353),S=s(193409),P=s(973410),T=s(429902),j=s(623068),C=s(831219),M=s(898185),I=s(120767),Z=s(409371),k=s(372445),F=s(169141),G=s(756834),V=s(870295);function z(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const R=e=>e.getView().getProjection().getCode();class D extends i().Component{constructor(){var e;super(...arguments),e=this,z(this,"getLength",((e,t)=>{if("Bearing"===t.measurement.geomType&&e.length>1)return(0,v.calculateAzimuth)(e[0],e[1],R(t.map));const s=this.reprojectedCoordinatesIn4326(e);return(0,v.calculateDistance)(s,t.measurement.lengthFormula)})),z(this,"getArea",(e=>this.calculateGeodesicArea(e.getLinearRing(0).getCoordinates()))),z(this,"updateInteraction",((e,t)=>{t.some((e=>h()(e,"properties.disabled")))?this.removeDrawInteraction():null===this.drawInteraction&&(this.restoreDrawState(),this.addDrawInteraction(e))})),z(this,"convertPolyToLineFeature",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=[];const o=(0,f.wd)(t[0]);return o&&(0,f.wd)(t[1])?s=e.reprojectedCoordinatesFrom4326([t[0],t[1]]):o&&(s=e.reprojectedCoordinatesFrom4326([t[0]])),s.length?new O.Z(s):null})),z(this,"modifyFeatures",(e=>{var t,s,o,i;let{currentFeature:r,features:n}=e.measurement||{},a=(null===(t=n[r])||void 0===t||null===(s=t.geometry)||void 0===s?void 0:s.coordinates)||[],p=(null===(o=n[r])||void 0===o||null===(i=o.geometry)||void 0===i?void 0:i.type)||"";var l;"Polygon"===p&&(a=(null===(l=a)||void 0===l?void 0:l[0])||[]);const h=a.length,m=a.some((e=>!(0,f.wd)(e)));let c;if(!m&&"LineString"===p&&h<2){const e=this.reprojectedCoordinatesFrom4326(a);c=new O.Z(e),n[r]=(0,b.t8)("properties.disabled",!0,(0,b.t8)("geometry.coordinates",[...a,["",""]],n[r]))}else!m&&"Polygon"===p&&h<=4&&u()(a[h-1],a[h-2])&&(a.splice(2,0,["",""]),a.pop(),n[r]=(0,b.t8)("properties.disabled",!0,(0,b.t8)("geometry.coordinates",[a],n[r])));var g,d,y,v;let L;return"Polygon"===p&&h<=4&&(c=this.convertPolyToLineFeature(a)),!m&&u()(a[h-1],a[h-2])&&(null===(g=n[r])||void 0===g||null===(d=g.geometry)||void 0===d||null===(y=d.coordinates)||void 0===y||null===(v=y[0])||void 0===v||v.pop()),c&&(this.source.clear(),L=new j.Z({geometry:c})),[n,L]})),z(this,"updateFeatures",(e=>{const[t,s]=this.modifyFeatures(e)||[],o=this.source.getFeatures();this.removeMeasureTooltips(),this.removeSegmentLengthOverlays(),this.source.clear(),this.textLabels=[],this.segmentLengths=[];let i=null;this.updateInteraction(e,t);const r=t.map(((t,r)=>{if(h()(t,"properties.disabled"))return i=r,[t,o&&o[r]&&o[r].getGeometry()||(null==s?void 0:s.getGeometry())];const n=t.geometry.type,a=h()(t,"properties.values",[]),p="bearing"===(a[0]||{}).type||!(a[0]||{}).type&&e.measurement.bearingMeasureEnabled,l="Polygon"===n?t.geometry.coordinates[0]:t.geometry.coordinates;let m=l;"LineString"===n&&l.length>=2&&!p&&(m=(0,v.transformLineToArcs)(l));const u=this.reprojectedCoordinatesFrom4326(m),c="Polygon"===n?new w.ZP([u]):new O.Z(u),g={Point:()=>l,LineString:()=>p?(0,v.calculateAzimuth)(l[0],l[1],"EPSG:4326"):(0,v.calculateDistance)(l,e.measurement.lengthFormula),Polygon:()=>this.getArea(c)},d={LineString:()=>this.formatLengthValue(p?(0,v.calculateAzimuth)(l[0],l[1],"EPSG:4326"):(0,v.calculateDistance)(l,e.measurement.lengthFormula),e.uom,p,e.measurement.trueBearing),Polygon:()=>this.formatAreaValue(this.getArea(c),e.uom)},b=this.reprojectedCoordinatesFrom4326(l);if(!p)for(let t=0;t<l.length-1;++t){this.createSegmentLengthOverlay();const s=(0,v.calculateAzimuth)(l[t],l[t+1],"EPSG:4326"),o=(0,v.calculateDistance)([l[t],l[t+1]],e.measurement.lengthFormula),i=this.props.measurement&&this.props.measurement.showLengthAndBearingLabel&&" | "+(0,f.rp)(s,this.props.measurement.trueBearing)||"",r=this.formatLengthValue(o,e.uom,p)+i;y()(this.segmentOverlayElements).innerHTML=r;let a=(0,v.midpoint)(l[t],l[t+1],!0),h=(0,v.midpoint)(b[t],b[t+1],!0);if("LineString"===n){const e=m[100*t+50];e&&(a=e,h=(0,v.pointObjectToArray)((0,v.reproject)(e,"EPSG:4326",R(this.props.map))))}y()(this.segmentOverlays).setPosition(h),this.textLabels[this.segmentOverlays.length-1]={text:r,position:a},this.segmentLengths[this.segmentOverlays.length-1]={value:o,type:p?"bearing":"length"}}if(this.createMeasureTooltip(),"Polygon"===n&&this.createMeasureTooltip(),this.tooltipCoord="LineString"===n?y()(b):this.tooltipCoord=c.getInteriorPoint().getCoordinates(),y()(this.measureTooltipElements).innerHTML=d[n](),y()(this.measureTooltips).setPosition(this.tooltipCoord),this.outputValues[this.measureTooltipElements.length-1]={value:g[n](),type:"Polygon"===n?"area":p?"bearing":"length"},"Polygon"===n){const t=(0,v.calculateDistance)(l,e.measurement.lengthFormula);this.measureTooltipElements[this.measureTooltipElements.length-2].innerHTML=this.formatLengthValue(t,e.uom,!1),this.outputValues[this.measureTooltipElements.length-2]={value:t,type:"length"},this.perimeterTooltipCoord=y()(b),this.measureTooltips[this.measureTooltipElements.length-2].setPosition(this.perimeterTooltipCoord),this.measureTooltips[this.measureTooltipElements.length-2].setOffset([0,-7])}let L={...t};return L.properties=t.properties?{...t.properties}:{},L.properties.values=[{value:(g[n]||(()=>null))(),formattedValue:(d[n]||(()=>null))(),position:"Polygon"===n?(0,v.pointObjectToArray)((0,v.reproject)(c.getInteriorPoint().getCoordinates(),R(e.map),"EPSG:4326")):y()(l),type:(a[0]||{}).type||(e.measurement.pointMeasureEnabled?"point":e.measurement.lineMeasureEnabled?"length":e.measurement.areaMeasureEnabled?"area":e.measurement.bearingMeasureEnabled?"bearing":void 0)},..."Polygon"===n?[{value:(0,v.calculateDistance)(l,e.measurement.lengthFormula),formattedValue:this.formatLengthValue((0,v.calculateDistance)(l,e.measurement.lengthFormula),e.uom,!1),position:y()(l),uom:e.uom,type:"length"}]:[]],[L,c]})),n=r.map((e=>e[0])),a=r.map((e=>e[1]));this.source.addFeatures(a.filter((e=>!!e)).map((e=>new j.Z({geometry:e}))));let p=[...this.textLabels];n.map(((e,t)=>{var s,o;const r=!(null===(s=e.properties)||void 0===s||null===(o=s.values)||void 0===o||!o.find((e=>"bearing"===e.type))),n="Polygon"===e.geometry.type,a=n||r?0:1,l=n?e.geometry.coordinates[0]:e.geometry.coordinates,h=l.some((e=>!(0,f.wd)(e))),m=n?l.length-1:r?0:l.length;return e.geometry.textLabels=null!==i&&i===t&&h?e.geometry.textLabels.concat([{text:"0"}]):p.splice(0,m-a)||[],e})),this.props.changeGeometry(n),this.props.setTextLabels([...this.textLabels]);for(let e=0;e<this.measureTooltipElements.length;++e)this.measureTooltipElements[e]&&(this.measureTooltipElements[e].className="tooltip tooltip-static");for(let e=0;e<this.segmentOverlayElements.length;++e)this.segmentOverlayElements[e]&&(this.segmentOverlayElements[e].className="segment-overlay segment-overlay-static")})),z(this,"updateMeasures",(e=>{const t=t=>{let{type:s,value:o}=t;return"length"===s?this.formatLengthValue(o,e.uom,!1):"area"===s?this.formatAreaValue(o,e.uom):this.formatLengthValue(o,e.uom,!0,e.measurement.trueBearing)};this.outputValues=this.outputValues||[],this.segmentOverlayElements=this.segmentOverlayElements||[],this.textLabels=this.textLabels||[];for(let e=0;e<this.outputValues.length;++e)this.outputValues[e]&&(this.measureTooltipElements[e].innerHTML=t(this.outputValues[e]));for(let e=0;e<this.segmentOverlayElements.length;++e){if(!this.segmentOverlayElements[e])continue;const s=t(this.segmentLengths[e]);let o=this.textLabels[e].text;const i=o.indexOf(" | ");o=o.replace(o.substring(0,-1!==i?i:o.length),s),this.segmentOverlayElements[e].innerHTML=o,this.textLabels[e].text=o}this.drawing||this.props.setTextLabels([...this.textLabels]);const s=(e.measurement.features||[]).map((e=>({...e,...e.properties?{properties:{...e.properties,values:(e.properties.values||[]).map((e=>({...e,formattedValue:t({type:e.type,value:e.value})})))}}:{}})));this.props.changeGeometry(s)})),z(this,"addFeature",(e=>{let t=!1;this.source||(this.source=new P.Z,t=!0);let s=(0,v.reprojectGeoJson)(e,"EPSG:4326",R(this.props.map)).geometry;const o=new j.Z({geometry:(0,E.y7)(s)});this.source.addFeature(o),t&&this.measureLayer.setSource(this.source)})),z(this,"resetGeometry",(()=>{this.source.clear(),this.props.resetGeometry()})),z(this,"saveDrawState",(()=>{var e,t;this.savedDrawState={textLabels:this.textLabels.slice(),segmentLengths:this.segmentLengths.slice(),measureTooltipsLength:(null===(e=this.measureTooltips)||void 0===e?void 0:e.length)??0,segmentOverlaysLength:(null===(t=this.segmentOverlays)||void 0===t?void 0:t.length)??0}})),z(this,"discardDrawState",(()=>{this.savedDrawState=null})),z(this,"restoreDrawState",(()=>{if(this.savedDrawState){this.textLabels=this.savedDrawState.textLabels,this.segmentLengths=this.savedDrawState.segmentLengths;for(let e=this.savedDrawState.measureTooltipsLength;e<this.measureTooltips.length;++e)this.props.map.removeOverlay(this.measureTooltips[e]),this.measureTooltipElements[e].parentNode.removeChild(this.measureTooltipElements[e]);for(let e=this.savedDrawState.segmentOverlaysLength;e<this.segmentOverlays.length;++e)this.props.map.removeOverlay(this.segmentOverlays[e]),this.segmentOverlayElements[e].parentNode.removeChild(this.segmentOverlayElements[e]);this.measureTooltips.splice(this.savedDrawState.measureTooltipsLength),this.measureTooltipElements.splice(this.savedDrawState.measureTooltipsLength),this.outputValues.splice(this.savedDrawState.measureTooltipsLength),this.segmentOverlays.splice(this.savedDrawState.segmentOverlaysLength),this.segmentOverlayElements.splice(this.savedDrawState.segmentOverlaysLength),this.curPolygonLength=void 0,this.curLineStringLength=void 0,this.savedDrawState=null}})),z(this,"addDrawInteraction",(e=>{let t,s,{startEndPoint:o}=e.measurement;if(this.continueLineMsg=(0,x.S$)(this.context.messages,"measureSupport.continueLine"),this.continuePolygonMsg=(0,x.S$)(this.context.messages,"measureSupport.continuePolygon"),this.drawInteraction&&this.removeDrawInteraction(),!this.vector){this.source=new P.Z;let t=[new C.default({fill:new M.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new I.default({color:"#ffcc33",width:2}),image:new Z.default({radius:7,fill:new M.default({color:"#ffcc33"})})})],s=[],i=o||!0===o;if(i||void 0===o){let t=i?void 0===o?{}:o:e.startEndPoint;s=(0,L.rm)(t.startPointOptions,t.endPointOptions)}const r=[...t,...s];this.vector=new T.Z({source:this.source,zIndex:1e6,style:r}),this.props.map.addLayer(this.vector)}s="Bearing"===e.measurement.geomType?"LineString":e.measurement.geomType,t=new k.ZP({source:new P.Z,type:s,style:new C.default({fill:new M.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new I.default({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new Z.default({radius:5,stroke:new I.default({color:"rgba(0, 0, 0, 0.7)"}),fill:new M.default({color:"rgba(255, 255, 255, 0.2)"})})})}),this.clickListener=this.props.map.on("click",(()=>this.updateMeasurementResults(this.props))),this.props.updateOnMouseMove&&this.props.map.on("pointermove",(()=>this.updateMeasurementResults(this.props))),this.props.map.on("pointermove",(e=>this.pointerMoveHandler(e))),t.on("drawstart",(e=>{var t,s;this.sketchFeature=e.feature,this.drawing=!0,this.textId=(null===(t=this.props.measurement)||void 0===t||null===(s=t.features)||void 0===s?void 0:s.length)||0,this.textLabels||(this.textLabels=[]),this.segmentLengths||(this.segmentLengths=[]),this.props.measurement.disableLabels||(this.saveDrawState(),this.createMeasureTooltip("Polygon"===this.props.measurement.geomType?[0,0]:void 0),"Polygon"===this.props.measurement.geomType&&this.createMeasureTooltip(),"Polygon"===this.props.measurement.geomType&&this.createSegmentLengthOverlay()),this.listener=this.sketchFeature.getGeometry().on("change",(e=>{let t,s,o=e.target;if(o instanceof w.ZP){s={value:this.getArea(o),type:"area"},t=this.formatAreaValue(s.value,this.props.uom),this.tooltipCoord=o.getInteriorPoint().getCoordinates();const e=o.getCoordinates()[0];let i=[];if(!this.props.measurement.disableLabels&&((void 0===this.curPolygonLength||this.curPolygonLength<e.length)&&(this.createSegmentLengthOverlay(),this.curPolygonLength=e.length),e.length>2)){i.push((0,v.midpoint)(e[e.length-1],e[e.length-2],!0)),i.push((0,v.midpoint)(e[e.length-2],e[e.length-3],!0));for(let t=0;t<i.length;++t){const s=e.slice(e.length-2-t,e.length-t),o=this.getLength(s,this.props),r=this.props.measurement&&this.props.measurement.showLengthAndBearingLabel&&" | "+(0,f.rp)((0,v.calculateAzimuth)(s[0],s[1],R(this.props.map)),this.props.measurement.trueBearing)||"",n=this.formatLengthValue(o,this.props.uom,!1)+r;this.segmentOverlayElements[this.segmentOverlays.length-t-1].innerHTML=n,this.segmentOverlays[this.segmentOverlays.length-t-1].setPosition(i[t]),this.segmentLengths[this.segmentOverlays.length-t-1]={value:o,type:"length"},this.textLabels[this.segmentOverlays.length-t-1]={text:n,position:(0,v.pointObjectToArray)((0,v.reproject)(i[t],R(this.props.map),"EPSG:4326")),type:this.props.measurement.geomType,textId:this.textId}}}}else if(o instanceof O.Z){const e=o.getCoordinates(),i=[e[e.length-2],e[e.length-1]];this.props.measurement.disableLabels||this.props.measurement.bearingMeasureEnabled||!(void 0===this.curLineStringLength||this.curLineStringLength<e.length)||(this.createSegmentLengthOverlay(),this.curLineStringLength=e.length);const r=this.getLength(e,this.props),n=this.getLength(i,this.props);if(t=this.formatLengthValue(r,this.props.uom,"Bearing"===this.props.measurement.geomType,this.props.measurement.trueBearing),this.tooltipCoord=o.getLastCoordinate(),!this.props.measurement.disableLabels&&!this.props.measurement.bearingMeasureEnabled){const e=this.props.measurement&&this.props.measurement.showLengthAndBearingLabel&&" | "+(0,f.rp)((0,v.calculateAzimuth)(i[0],i[1],R(this.props.map)),this.props.measurement.trueBearing)||"",t=this.formatLengthValue(n,this.props.uom,"Bearing"===this.props.measurement.geomType,this.props.measurement.trueBearing)+e;y()(this.segmentOverlayElements).innerHTML=t,y()(this.segmentOverlays).setPosition((0,v.midpoint)(i[0],i[1],!0)),this.textLabels[this.segmentOverlays.length-1]={text:t,position:(0,v.pointObjectToArray)((0,v.reproject)((0,v.midpoint)(i[0],i[1],!0),R(this.props.map),"EPSG:4326")),type:this.props.measurement.geomType,textId:this.textId},this.segmentLengths[this.segmentOverlays.length-1]={value:n,type:"Bearing"===this.props.measurement.geomType?"bearing":"length"}}s={value:r,type:"Bearing"===this.props.measurement.geomType?"bearing":"length"}}if(!this.props.measurement.disableLabels&&(y()(this.measureTooltipElements).innerHTML=t,y()(this.measureTooltips).setPosition(this.tooltipCoord),this.outputValues[this.outputValues.length-1]=s,o instanceof w.ZP)){const e=o.getCoordinates()[0],t=this.getLength(3===e.length?g()(e):e,this.props);this.measureTooltipElements[this.measureTooltipElements.length-2].innerHTML=this.formatLengthValue(t,this.props.uom,!1),this.outputValues[this.measureTooltipElements.length-2]={value:t,type:"length"},this.perimeterTooltipCoord=o.getLastCoordinate(),this.measureTooltips[this.measureTooltipElements.length-2].setPosition(this.perimeterTooltipCoord)}}))})),t.on("drawend",(e=>{var t;this.drawing=!1;const s=h()(this.props.measurement,"features",[]),o=e.feature.getGeometry(),i=o.getCoordinates(),r=new F.Z,n={Point:()=>(0,v.reproject)(i,R(this.props.map),"EPSG:4326"),LineString:()=>this.getLength(i,this.props),Polygon:()=>this.getArea(o),Bearing:()=>(0,v.calculateAzimuth)(i[0],i[1],R(this.props.map))},a={LineString:()=>this.formatLengthValue(this.getLength(i,this.props),this.props.uom,!1),Polygon:()=>this.formatAreaValue(this.getArea(o),this.props.uom),Bearing:()=>this.formatLengthValue((0,v.calculateAzimuth)(i[0],i[1],R(this.props.map)),this.props.uom,!0,this.props.measurement.trueBearing)};let p=(0,v.reprojectGeoJson)(r.writeFeatureObject(e.feature.clone()),R(this.props.map),"EPSG:4326");p.properties=p.properties||{},p.properties.values=[{value:(n[this.props.measurement.geomType]||(()=>null))(),formattedValue:(a[this.props.measurement.geomType]||(()=>null))(),position:(0,v.pointObjectToArray)((0,v.reproject)("Polygon"===this.props.measurement.geomType?o.getInteriorPoint().getCoordinates():y()(i),R(this.props.map),"EPSG:4326")),type:this.props.measurement.pointMeasureEnabled?"point":this.props.measurement.lineMeasureEnabled?"length":this.props.measurement.areaMeasureEnabled?"area":this.props.measurement.bearingMeasureEnabled?"bearing":void 0},..."Polygon"===this.props.measurement.geomType?[{value:(this.outputValues[this.measureTooltipElements.length-2]||{}).value||0,formattedValue:this.formatLengthValue((this.outputValues[this.measureTooltipElements.length-2]||{}).value||0,this.props.uom,!1),position:(0,v.pointObjectToArray)((0,v.reproject)(y()(i[0]),R(this.props.map),"EPSG:4326")),uom:this.props.uom,type:"length"}]:[]];let l={...p};if(this.props.measurement.lineMeasureEnabled){let e=l.geometry.coordinates,t=(0,v.transformLineToArcs)(e);if(!this.props.measurement.disableLabels){this.removeLastSegment();for(let s=0;s<e.length-1;++s){const o=t[100*s+50];o&&(this.textLabels[this.segmentOverlays.length-e.length+1+s].position=o,this.segmentOverlays[this.segmentOverlays.length-e.length+1+s].setPosition((0,v.pointObjectToArray)((0,v.reproject)(o,"EPSG:4326",R(this.props.map)))))}}l=(0,b.t8)("geometry.coordinates",t,l)}else!this.props.measurement.disableLabels&&this.props.measurement.areaMeasureEnabled&&(this.textLabels.splice(this.segmentOverlays.length-2,1),this.props.map.removeOverlay(this.segmentOverlays[this.segmentOverlays.length-2]),this.segmentOverlayElements[this.segmentOverlays.length-2].parentNode.removeChild(this.segmentOverlayElements[this.segmentOverlays.length-2]),this.segmentOverlayElements.splice(this.segmentOverlays.length-2,1),this.segmentOverlays.splice(this.segmentOverlays.length-2,1));const m="bearing"===(null===(t=p.properties.values[0])||void 0===t?void 0:t.type)?"Bearing":p.geometry.type;if(p.geometry.textLabels=this.textLabels.filter((e=>e.type===m&&e.textId===this.textId)).map((e=>{let{textId:t,type:s,...o}=e;return o})),this.props.changeGeometry([...s,p]),this.props.setTextLabels([...this.textLabels]),this.addFeature(l),!this.props.measurement.disableLabels&&(y()(this.measureTooltipElements).className="tooltip tooltip-static",y()(this.measureTooltips).setOffset([0,-7]),"Polygon"===this.props.measurement.geomType&&(this.measureTooltipElements[this.measureTooltipElements.length-2].className="tooltip tooltip-static",this.measureTooltips[this.measureTooltipElements.length-2].setOffset([0,-7])),this.segmentOverlayElements))for(let e=0;e<this.segmentOverlayElements.length;++e)this.segmentOverlayElements[e]&&(this.segmentOverlayElements[e].className="segment-overlay segment-overlay-static");(0,G.B)(this.listener),this.curPolygonLength=void 0,this.curLineStringLength=void 0,this.discardDrawState()})),this.props.map.addInteraction(t),this.createHelpTooltip(),this.drawInteraction=t,this.measureLayer=this.vector})),z(this,"removeLastSegment",(()=>{this.textLabels.pop(),this.segmentLengths.pop(),this.props.map.removeOverlay(y()(this.segmentOverlays)),y()(this.segmentOverlayElements).parentNode.removeChild(y()(this.segmentOverlayElements)),this.segmentOverlays.pop(),this.segmentOverlayElements.pop()})),z(this,"removeDrawInteraction",(()=>{null!==this.drawInteraction&&(this.removeHelpTooltip(),this.props.map.removeInteraction(this.drawInteraction),this.drawInteraction=null,this.sketchFeature=null,this.props.map.un("click",(()=>this.updateMeasurementResults(this.props)),this),(0,G.B)(this.clickListener),this.props.updateOnMouseMove&&this.props.map.un("pointermove",(()=>this.updateMeasurementResults(this.props)),this))})),z(this,"pointerMoveHandler",(function(e){if(e.dragging)return;let t=(0,x.S$)(this.context.messages,"measureSupport.startDrawing");if(this.sketchFeature&&this.drawing){let e=this.sketchFeature.getGeometry();e instanceof w.ZP?t=this.continuePolygonMsg:e instanceof O.Z&&(t=this.continueLineMsg)}this.helpTooltipElement.innerHTML=t,this.helpTooltip.setPosition(e.coordinate),this.helpTooltipElement.classList.remove("hidden")})),z(this,"updateMeasurementResults",(e=>{if(!this.sketchFeature)return;let t=this.sketchFeature.getGeometry().getCoordinates();if("Bearing"===e.measurement.geomType&&t.length>1&&t.length>2){for(this.drawInteraction.sketchCoords_=[t[0],t[1],t[0]];this.sketchFeature.getGeometry().getCoordinates().length>3;)this.drawInteraction.removeLastPoint();this.sketchFeature.getGeometry().setCoordinates([t[0],t[1]]),this.drawInteraction.sketchFeature_=this.sketchFeature,this.drawInteraction.finishDrawing()}})),z(this,"reprojectedCoordinatesFrom4326",(e=>e.map((e=>{let t=(0,v.reproject)(e,"EPSG:4326",R(this.props.map));return[t.x,t.y]})))),z(this,"reprojectedCoordinatesIn4326",(e=>e.map((e=>{let t=(0,v.reproject)(e,R(this.props.map),"EPSG:4326");return[t.x,t.y]})))),z(this,"calculateGeodesicArea",(e=>{if(e.length>=4){const t=this.reprojectedCoordinatesIn4326(e);return Math.abs((0,V.bg)(new w.ZP([t]),{projection:"EPSG:4326"}))}return 0})),z(this,"createHelpTooltip",(()=>{this.removeHelpTooltip(),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="tooltip hidden",this.helpTooltip=new S.Z({element:this.helpTooltipElement,offset:[15,0],positioning:"center-left"}),this.props.map.addOverlay(this.helpTooltip)})),z(this,"createMeasureTooltip",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,-15];e.measureTooltipElements||(e.measureTooltipElements=[]),e.measureTooltips||(e.measureTooltips=[]),e.outputValues||(e.outputValues=[]);let s=document.createElement("div");s.className="tooltip tooltip-measure",s.style.display=e.props.measurement.showLabel?"":"none",e.measureTooltipElements.push(s);let o=new S.Z({element:s,offset:t,positioning:"bottom-center"});e.props.map.addOverlay(o),e.measureTooltips.push(o),e.outputValues.push(null)})),z(this,"createSegmentLengthOverlay",(e=>{this.segmentOverlayElements||(this.segmentOverlayElements=[]),this.segmentOverlays||(this.segmentOverlays=[]);let t=document.createElement("div");t.className="segment-overlay",t.style.display=this.props.measurement.showSegmentLengths&&!e?"":"none",this.segmentOverlayElements.push(t);let s=new S.Z({element:t,offset:[0,0],positioning:"center-center"});this.props.map.addOverlay(s),this.segmentOverlays.push(s)})),z(this,"formatLengthValue",(function(t,s,o){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(o)return(0,f.rp)(t,i);const{label:r,unit:n}=s&&s.length,a=p()((0,f.Ov)(t,"m",n),2);return e.props.formatNumber(a)+" "+r})),z(this,"formatAreaValue",((e,t)=>{const{label:s,unit:o}=t&&t.area,i=p()((0,f.Ov)(e,"sqm",o),2);return this.props.formatNumber(i)+" "+s})),z(this,"removeHelpTooltip",(()=>{this.helpTooltipElement&&this.helpTooltipElement.parentNode&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltip&&this.props.map.removeOverlay(this.helpTooltip)})),z(this,"removeMeasureTooltips",(()=>{(this.measureTooltips||[]).forEach((e=>{this.props.map.removeOverlay(e)}));let e=document.getElementsByClassName("tooltip-static")||[];for(let t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t]);e=document.getElementsByClassName("tooltip-measure")||[];for(let t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t]);this.measureTooltips=[],this.measureTooltipElements=[],this.outputValues=[]})),z(this,"removeSegmentLengthOverlays",(()=>{(this.segmentOverlays||[]).forEach((e=>{this.props.map.removeOverlay(e)})),(this.segmentOverlayElements||[]).forEach((e=>{e.parentNode.removeChild(e)})),this.segmentOverlays=[],this.segmentOverlayElements=[]}))}UNSAFE_componentWillReceiveProps(e){if(this.measureTooltipElements&&e.measurement.showLabel!==this.props.measurement.showLabel)for(let t=0;t<this.measureTooltipElements.length;++t)this.measureTooltipElements[t]&&(this.measureTooltipElements[t].style.display=e.measurement.showLabel?"":"none");if(this.segmentOverlayElements&&e.measurement.showSegmentLengths)for(let t=0;t<this.segmentOverlayElements.length;++t)this.segmentOverlayElements[t]&&(this.segmentOverlayElements[t].style.display=e.measurement.showSegmentLengths?"":"none");(e.measurement.geomType&&e.measurement.geomType!==this.props.measurement.geomType||e.measurement.geomType&&(e.measurement.lineMeasureEnabled||e.measurement.areaMeasureEnabled||e.measurement.bearingMeasureEnabled)&&!this.props.enabled&&e.enabled)&&(this.restoreDrawState(),this.addDrawInteraction(e)),e.measurement.geomType||(this.removeDrawInteraction(),this.removeMeasureTooltips(),this.removeSegmentLengthOverlays(),this.textLabels=[],this.segmentLengths=[],this.props.map.removeLayer(this.measureLayer),this.vector=null,this.measureLayer=null,e.measurement.features&&e.measurement.features.length>0&&this.props.changeGeometry([]),e.measurement.textLabels&&e.measurement.textLabels.length>0&&this.props.setTextLabels([]),this.source&&(this.source.clear(),this.source=null));let t=this.props.measurement.features,s=e.measurement.features;e.measurement.updatedByUI&&!u()(t,s)?this.updateFeatures(e):e.measurement.updatedByUI&&!u()(this.props.uom,e.uom)&&this.updateMeasures(e)}render(){return null}}z(D,"propTypes",{startEndPoint:n().object,map:n().object,measurement:n().object,enabled:n().bool,uom:n().object,formatNumber:n().func,changeMeasurementState:n().func,updateMeasures:n().func,resetGeometry:n().func,changeGeometry:n().func,updateOnMouseMove:n().bool,setTextLabels:n().func}),z(D,"contextTypes",{messages:n().object}),z(D,"defaultProps",{changeMeasurementState:()=>{},resetGeometry:()=>{},updateMeasures:()=>{},changeGeometry:()=>{},formatNumber:e=>e,setTextLabels:()=>{},startEndPoint:{startPointOptions:{radius:3,fillColor:"green",applyToPolygon:!0},endPointOptions:{radius:3,fillColor:"red",applyToPolygon:!0}},updateOnMouseMove:!1})},904101:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});var o=s(45697),i=s.n(o),r=s(124852),n=s.n(r),a=s(477434),p=s(727418),l=s.n(p),h=s(797398),m=s.n(h),u=s(203728);function c(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s(848709);const g={className:"ol-overviewmap ol-custom-overviewmap",collapseLabel:"»",label:"«",collapsed:!0,collapsible:!0};class d extends n().Component{constructor(){super(...arguments),c(this,"dragstart",(e=>{this.dragging||(this.dragBox=this.box.cloneNode(),this.dragBox.setAttribute("class","ol-overview-dargbox"),this.dragBox.style.position="relative",this.box.appendChild(this.dragBox),""===this.box.style.top?this.offsetStartTop=0:this.offsetStartTop=parseInt(this.box.style.top.slice(0,-2),10),""===this.box.style.left?this.offsetStartLeft=0:this.offsetStartLeft=parseInt(this.box.style.left.slice(0,-2),10),this.mouseStartTop=e.pageY,this.mouseStartLeft=e.pageX,this.dragging=!0)})),c(this,"draggingel",(e=>{!0===this.dragging&&(this.dragBox.style.top=this.offsetStartTop+e.pageY-this.mouseStartTop+"px",this.dragBox.style.left=this.offsetStartLeft+e.pageX-this.mouseStartLeft+"px",e.stopPropagation(),e.preventDefault())})),c(this,"dragend",(()=>{if(!0===this.dragging){let e={};e.top=""===this.dragBox.style.top?0:parseInt(this.dragBox.style.top.slice(0,-2),10),e.left=""===this.dragBox.style.left?0:parseInt(this.dragBox.style.left.slice(0,-2),10),this.box.removeChild(this.dragBox),delete this.dragBox,this.dragging=!1,this.setNewExtent(e)}})),c(this,"setNewExtent",(e=>{let t=this.box.offsetWidth,s=this.box.offsetHeight,o=this.props.map.getSize(),i=e.left*Math.abs(o[0]/t),r=e.top*Math.abs(o[1]/s);i=m()(i)?i:0,r=m()(r)?r:0;let n=[0+i,o[1]+r],a=[o[0]+i,0+r],p=this.props.map.getCoordinateFromPixel(n)||[0,0],l=this.props.map.getCoordinateFromPixel(a)||[0,0],h=[p[0],p[1],l[0],l[1]];this.props.map.getView().fit(h,o,{nearest:!0})}))}componentDidMount(){let e=[];this.props.layers.forEach((t=>{e.push(a.default.createLayer(t.type,t.options||{}))}));let t=l()({},g,this.props.overviewOpt,{layers:e});this.overview=new u.Z(t),this.props.map&&this.overview.setMap(this.props.map),this.box=this.overview.element.getElementsByClassName("ol-overviewmap-box").item(0),this.box.onmousedown=e=>{this.dragstart(e),this.box.onmousemove=e=>{this.draggingel(e)},this.overview.element.onmousemove=e=>{this.draggingel(e)},this.box.onmouseup=()=>{this.dragend(),this.overview.element.onmousemove=null,this.box.onmousemove=null,this.box.onmouseup=null}}}render(){return null}}c(d,"displayName","Overview"),c(d,"propTypes",{id:i().string,map:i().object,overviewOpt:i().object,layers:i().array}),c(d,"defaultProps",{id:"overview",overviewOpt:{},layers:[{type:"osm",options:{}}]})},37525:(e,t,s)=>{"use strict";s.d(t,{Z:()=>m});var o=s(45697),i=s.n(o),r=s(124852),n=s.n(r),a=s(727418),p=s.n(a),l=s(225303);function h(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class m extends n().Component{componentDidMount(){this.scalebar=new l.ZP(p()({},this.props,this.props.container?{target:document.querySelector(this.props.container)}:{})),this.props.map&&this.props.map.addControl(this.scalebar)}componentWillUnmount(){if(this.props.container&&document.querySelector(".ol-scale-line"))try{document.querySelector(this.props.container).removeChild(document.querySelector(".ol-scale-line"))}catch(e){}}render(){return null}}h(m,"propTypes",{map:i().object,className:i().string,minWidth:i().number,units:i().oneOf(["degrees","imperial","nautical","metric","us"]),container:i().string}),h(m,"defaultProps",{map:null,className:"ol-scale-line",minWidth:64,units:"metric"})},782527:(e,t,s)=>{"use strict";s.d(t,{y7:()=>b,oU:()=>L,hH:()=>x});var o=s(573800),i=s(345801),r=s(386306),n=s(718369),a=s(878516),p=s(500052),l=s(848041),h=s(978653),m=s(497950),u=s(752043),c=s(944538),g=s(552329),d=s(525642),y=s(513987),v=s(869669),f=s(640353);const b=function(){let e,{type:t,coordinates:s,radius:o,center:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch(t){case"Point":e=new u.Z(s||[]);break;case"LineString":e=new c.Z(s||[]);break;case"MultiPoint":e=new g.Z(s||[]);break;case"MultiLineString":e=new d.Z(s||[]);break;case"MultiPolygon":e=new y.Z(s||[]);break;default:e=o&&i?(0,f.Bb)(new v.Z([i.x,i.y],o),100):new f.ZP(s||[])}return e},L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e&&e.geometry&&"Polygon"===e.geometry.type},x={dragPan:{options:{kinetic:!1},Instance:o.Z},keyboardPan:{options:{kinetic:!1},Instance:i.Z},mouseWheelZoom:{options:{duration:0},Instance:r.Z},doubleClickZoom:{options:{duration:0},Instance:n.Z},shiftDragZoom:{options:{duration:0},Instance:a.Z},keyboardZoom:{options:{},Instance:p.Z},pinchZoom:{options:{duration:0},Instance:l.Z},pinchRotate:{options:{},Instance:h.Z},altShiftDragRotate:{options:{},Instance:m.Z}}},559896:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var o=s(923645),i=s.n(o)()((function(e){return e[1]}));i.push([e.id,".ms2 .ol-control button:hover, .ms2 .ol-control button:focus {\n    background-color: #f4f4f4;\n}\n.ms2 .ol-zoom .ol-zoom-out, .ms2 .ol-zoom .ol-zoom-in{\n    width: 26px;\n    height: 26px;\n    line-height: 26px;\n    display: block;\n\n    color: black;\n    background-color: #fff;\n    border-width: 0;\n    margin:0;\n}\n.ms2 .ol-zoom.ol-unselectable.ol-control .ol-zoom-in, .ms2 .ol-zoom.ol-unselectable.ol-control .ol-zoom-out {\n    font-family: 'Lucida Console', Monaco, monospace;\n    text-align: center;\n    text-decoration: none;\n    font-weight: bold;\n}\n\n.ms2 .ol-zoom .ol-zoom-out{\n    font-size: 18px;\n    border-radius: 0 0 4px 4px;\n}\n.ms2 .ol-zoom .ol-zoom-in{\n    border-bottom: 1px solid #ccc;\n    border-radius: 4px 4px 0 0;\n    font-size: 20px;\n}\n.ms2 .ol-zoom.ol-unselectable.ol-control{\n    top:10px;\n    left:10px;\n    padding:0;\n    box-shadow: rgba(0, 0, 0, 0.65098) 0px 1px 5px 0px;\n    border-radius: 4px;\n}\n\n.ms2 .ol-scale-line.ol-unselectable{\n    background-color: rgba(255, 255, 255, 0.8);\n}\n",""]);const r=i},660260:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var o=s(923645),i=s.n(o)()((function(e){return e[1]}));i.push([e.id,".ms2 .ol-custom-overviewmap,\n       .ms2 .ol-custom-overviewmap.ol-uncollapsible {\n          bottom: 20px;\n          left: auto;\n          right: 10px;\n          top: auto;\n\n      }\n      .ms2 .ol-custom-overviewmap:not(.ol-collapsed)  {\n\n           box-shadow: 0 1px 5px rgba(0,0,0,0.65);\n           border-radius: 1px;\n           transition: all .2s;\n      }\n      .ms2 .ol-custom-overviewmap .ol-overviewmap-map {\n          border: none;\n          width: 300px;\n          height: 150px;\n\n      }\n\n      .ms2 .ol-custom-overviewmap .ol-overviewmap-box {\n          border: 1px solid black;\n          cursor: pointer;\n          border-radius: 5px;\n      }\n\n      .ms2 .ol-custom-overviewmap:not(.ol-collapsed) button{\n          bottom: auto;\n          left: auto;\n          right: 2px;\n          bottom: 2px;\n      }\n\n      .ms2 .ol-rotate {\n          top: 170px;\n          right: 0;\n      }\n      .ms2 .ol-overview-dargbox{\n           border: 1px solid black;\n           background-color: rgba(125,125,0,.5);\n           border-radius: 5px;\n      }\n",""]);const r=i},848709:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var o=s(893379),i=s.n(o),r=s(660260);i()(r.Z,{insert:"head",singleton:!1});const n=r.Z.locals||{}}}]);