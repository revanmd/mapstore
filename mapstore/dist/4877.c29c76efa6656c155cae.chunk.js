(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[4877],{284877:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>L});var i=a(618446),s=a.n(i),r=a(513218),l=a.n(r),o=a(727418),n=a.n(o),c=a(45697),h=a.n(c),p=a(124852),m=a.n(p),d=a(630294),u=a(662398),g=a(200020),y=a(717621),f=a.n(y),C=a(719648),E=a(804504),S=a(741085),b=a(569291),v=a(954747),x=a(317723),k=a(894449);function I(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const T={current:void 0,unconfigured:void 0,applied:void 0};class P extends m().Component{constructor(){var e;super(...arguments),e=this,I(this,"getCurrentThema",(e=>{const t=this.props.getThematicParameters(e.params||[]).reduce(((e,t)=>n()(e,{[t.field]:t.defaultValue})),{});return n()({},this.props.initialParams,{attribute:e.attribute||""},t,e.applied)})),I(this,"getClassification",(()=>this.props.layer.thematic.current.classification||this.props.classification||[])),I(this,"getValue",(e=>!l()(e)&&e||e.value||e.name)),I(this,"getColors",(()=>{const e=this.props.getColors(this.props.colors,this.props.layer,this.props.colorSamples);return e?e.map((e=>{let{name:t,...a}=e;return{label:`global.colors.${t}`,name:t,...a}})):[]})),I(this,"renderError",((e,t)=>m().createElement(d.Alert,{bsStyle:"danger"},m().createElement(E.Z,{msgId:"toc.thematic."+t,msgParams:{message:this.localizedItem(e.message,"")}})))),I(this,"renderInputError",(e=>{const t=this.props.invalidInputs[e];return t?m().createElement(d.Alert,{bsStyle:"danger"},m().createElement(E.Z,{msgId:t.message,msgParams:t.params||{}})):null})),I(this,"renderThemaPanel",(e=>m().createElement(d.Row,null,m().createElement(d.Col,{xs:12},m().createElement(b.Z,{expanded:!0,locked:!0,title:this.localizedItem("toc.thematic.data_panel",""),buttons:[{glyph:"cog",tooltip:this.localizedItem("toc.thematic.go_to_cfg",""),visible:this.props.canEditThematic,onClick:this.toggleCfg}]},m().createElement(d.Grid,{fluid:!0},m().createElement(d.Row,null,this.props.layer.thematic.params&&this.props.layer.thematic.params.length?this.renderParams(e):null,m().createElement(d.Col,{xs:12},m().createElement(d.FormGroup,null,m().createElement(d.Col,{xs:6},m().createElement(d.ControlLabel,null,m().createElement(E.Z,{msgId:"toc.thematic.classification_field"}))),m().createElement(d.Col,{xs:6},m().createElement(g.Combobox,{disabled:this.hasCustomClassification(),busy:this.props.fieldsLoading.status,data:this.props.fields,textField:"name",valueField:"name",value:e.field,onChange:e=>this.updateStyle("field",this.getValue(e))}))))),m().createElement(d.Row,null,m().createElement(d.Col,{xs:12},this.props.fieldsLoading.error?this.renderError(this.props.fieldsLoading.error,"fields_error"):null))))),",",m().createElement(d.Col,{xs:12},m().createElement(b.Z,{expanded:!0,locked:!0,title:m().createElement(E.Z,{msgId:"toc.thematic.classify"}),buttons:[{glyph:"trash",tooltip:this.localizedItem("toc.thematic.remove",""),onClick:this.removeStyle,visible:this.props.enableRemoveStyle&&this.props.hasThematicStyle(this.props.layer)},{glyph:"undo",tooltip:this.localizedItem("toc.thematic.restore",""),onClick:this.restoreStyle,visible:this.hasCustomClassification()},{glyph:"ok",disabled:!this.props.applyEnabled||Object.keys(this.props.invalidInputs).length>0,tooltip:this.localizedItem("toc.thematic.apply",""),onClick:()=>this.applyStyle(this.props.layer)}]},m().createElement(d.Grid,{fluid:!0},m().createElement(d.Row,null,m().createElement(d.Col,{xs:12},m().createElement(d.FormGroup,null,m().createElement(d.Col,{xs:6},m().createElement(d.ControlLabel,null,m().createElement(E.Z,{msgId:"toc.thematic.classification_method"}))),m().createElement(d.Col,{xs:6},m().createElement(g.Combobox,{disabled:this.hasCustomClassification(),data:this.props.methods,textField:this.localizedItem,defaultValue:e.method,onSelect:e=>this.updateStyle("method",this.getValue(e))})))),m().createElement(d.Col,{xs:12},m().createElement(d.FormGroup,null,m().createElement(d.Col,{xs:6},m().createElement(d.ControlLabel,null,m().createElement(E.Z,{msgId:"toc.thematic.classification_intervals"}))),m().createElement(d.Col,{xs:6},m().createElement(g.NumberPicker,{disabled:this.hasCustomClassification(),value:e.intervals,onChange:e=>{this.updateStyle("intervals",this.constrainIntervals(this.getValue(e)))}}))),this.renderInputError("intervals")),m().createElement(d.Col,{xs:12},m().createElement(d.FormGroup,null,m().createElement(d.Col,{xs:6},m().createElement(d.ControlLabel,null,m().createElement(E.Z,{msgId:"toc.thematic.classification_colors"}))),m().createElement(d.Col,{xs:6},m().createElement(k.Z,{items:this.getColors(),rampFunction:this.createRamp,value:{name:e.ramp},disabled:this.hasCustomClassification(),samples:5,onChange:e=>{this.updateStyle("ramp",this.getValue(e))}})))),"LineString"!==this.props.geometryType?m().createElement(d.Col,{xs:12},m().createElement(d.FormGroup,null,m().createElement(d.Col,{xs:6},m().createElement(d.ControlLabel,null,m().createElement(E.Z,{msgId:"toc.thematic.classification_stroke"}))),m().createElement(d.Col,{xs:1},m().createElement(d.Checkbox,{checked:e.strokeOn,onChange:e=>this.updateStyle("strokeOn",e.target.checked)})),m().createElement(d.Col,{xs:2},m().createElement(v.Z,{key:"strokeColor",pickerProps:{disableAlpha:!0},disabled:!e.strokeOn,text:e.strokeColor,value:{...f()(e.strokeColor).toRgb(),a:100},onChangeColor:this.updateStrokeColor})),m().createElement(d.Col,{xs:3},m().createElement(g.NumberPicker,{key:"strokeWeight",disabled:!e.strokeOn,format:"- ###.###",value:e.strokeWeight,onChange:this.updateStrokeWeight})))):null),m().createElement(d.Row,null,m().createElement(d.Col,{xs:12},this.props.classificationLoading.status?m().createElement(S.Z,{width:this.props.loaderSize,height:this.props.loaderSize}):null,this.renderInputError("classification"),m().createElement(x.Z,{className:this.props.classificationLoading.status?"loading":"",classification:this.getClassification(),onUpdateClasses:this.updateClassification}),this.props.classificationLoading.error?this.renderError(this.props.classificationLoading.error,"classification_error"):null)))))))),I(this,"renderConfigurationEditor",(()=>{const e=this.isConfigurationValid();return m().createElement(d.Row,null,m().createElement(d.Col,{xs:12},m().createElement(b.Z,{expanded:!0,locked:!0,title:m().createElement(E.Z,{msgId:"toc.thematic.configuration"}),buttons:[{glyph:"arrow-right",tooltip:this.localizedItem("toc.thematic.go_to_thema",""),onClick:()=>this.applyCfg(this.props.adminCfg.current),visible:e},{glyph:"exclamation-mark",tooltip:this.localizedItem("toc.thematic.cfgError",""),glyphClassName:"text-danger",visible:!e}]},m().createElement(u.Z,{ref:e=>{this.cfgEditor=e},editorDidMount:this.props.onEditorReady,style:{width:"500px"},key:"code-mirror",value:this.props.adminCfg.current,onBeforeChange:this.updateCfg,options:{theme:"midnight",mode:{name:"javascript"},lineNumbers:!0}}))))})),I(this,"renderParams",(e=>this.props.getThematicParameters(this.props.layer.thematic.params).map((t=>m().createElement(d.Col,{xs:12},m().createElement(d.FormGroup,null,m().createElement(d.Col,{xs:6},m().createElement(d.ControlLabel,null,this.localizedItem(t.title,""))),m().createElement(d.Col,{xs:6},m().createElement(g.Combobox,{data:t.values,textField:e=>this.localizedItem(e.name,""),valueField:"value",value:e[t.field],onSelect:e=>this.updateStyle(t.field,this.getValue(e))})))))))),I(this,"constrainIntervals",(e=>(isNaN(e)||e<2||e>this.props.maxClasses?this.props.onInvalidInput("intervals","toc.thematic.interval_limit",{min:2,max:this.props.maxClasses}):this.props.onValidInput("intervals"),e))),I(this,"checkInitialStyle",(e=>{const t=e.layer.thematic;!e.hasThematicStyle(e.layer)&&t&&!t.unconfigured&&t.current&&t.current.field&&e.classification&&e.classification.length&&this.applyStyle(e.layer)})),I(this,"hasConfiguration",(()=>this.props.layer.thematic&&!this.props.layer.thematic.unconfigured)),I(this,"updateStrokeColor",(e=>{e&&this.updateStyle("strokeColor",f()(e).toHexString())})),I(this,"updateStrokeWeight",(e=>{this.updateStyle("strokeWeight",e)})),I(this,"hasCustomClassification",(()=>!!this.props.layer.thematic.current.classification)),I(this,"removeStyle",(()=>{const e=this.props.layer,t=this.props.removeThematicStyle(e.params);this.props.onChange({params:t,thematic:n()({},e.thematic,{applied:n()({},e.thematic.current)})})})),I(this,"updateClassification",(e=>{this.props.onChange("thematic",n()({},this.props.layer.thematic,{current:n()({},this.props.layer.thematic.current,{classification:e})})),this.validClassification(e)?this.props.onValidInput("classification"):this.props.onInvalidInput("classification","toc.thematic.invalid_classes"),this.props.onDirtyStyle()})),I(this,"validClassification",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return!e.reduce(((e,t)=>e||t.max<t.min),!1)})),I(this,"createRamp",(e=>e.colors)),I(this,"isConfigurationValid",(()=>{try{return JSON.parse(this.props.adminCfg.current),!0}catch(e){return!1}})),I(this,"applyCfg",(e=>{try{const t=JSON.parse(e),a=n()({},t,{current:this.getCurrentThema(t),unconfigured:!1});this.props.onChange("thematic",a),this.props.onSwitchLayer(n()({},this.props.layer,{thematic:a})),this.props.onChangeConfiguration(this.props.layer,!1,e)}catch(t){this.props.onChangeConfiguration(this.props.layer,!0,e,t.message)}})),I(this,"updateCfg",((e,t,a)=>{this.props.onChangeConfiguration(this.props.layer,!0,a)})),I(this,"toggleCfg",(()=>{this.props.onChangeConfiguration(this.props.layer,!this.props.adminCfg.open,this.props.adminCfg.current)})),I(this,"localizedItem",(function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"toc.thematic.values.";return(0,C.S$)(e.context.messages,a+t)})),I(this,"switchLayer",(e=>{if(e.thematic){const t=this.getCurrentThema(e.thematic);this.props.onChange("thematic",n()({},e.thematic,{current:t}))}this.props.onSwitchLayer(e)})),I(this,"restoreStyle",(()=>{const e=n()({},this.props.layer,{thematic:n()({},this.props.layer.thematic,{current:n()({},this.props.layer.thematic.current,{classification:null})})});this.updateStyle("classification",null,!0),this.applyStyle(e)})),I(this,"applyStyle",(e=>{const t=n()({},e.params,this.props.getStyleParameters(e,e.thematic.current));this.props.onChange({params:t,thematic:n()({},e.thematic,{applied:n()({},e.thematic.current)})}),this.props.onApplyStyle()})),I(this,"needsToUpdateClassification",(e=>!this.hasCustomClassification()&&-1===["strokeOn","strokeColor","strokeWeight"].indexOf(e)||"classification"===e)),I(this,"updateStyle",((e,t,a)=>{const i=this.props.layer,s=n()({},i.thematic.current,{[e]:t}),r=n()({},i.thematic,{current:s});if(this.props.onChange("thematic",r),this.needsToUpdateClassification(e)){const e=n()({},this.props.getMetadataParameters(i,s));this.props.onClassify(n()({},i,{thematic:r}),e)}a||this.props.onDirtyStyle()}))}UNSAFE_componentWillMount(){this.props.layer&&(this.props.onChangeConfiguration(this.props.layer,!1,JSON.stringify(n()({},this.props.layer.thematic,T),null,4)),this.hasConfiguration()?this.switchLayer(this.props.layer):this.applyCfg("{}"),this.checkInitialStyle(this.props))}UNSAFE_componentWillReceiveProps(e){if(!e.layer||this.props.layer&&e.layer.id===this.props.layer.id||this.switchLayer(e.layer),e.fields&&e.fields.length&&!s()(e.fields,this.props.fields)){const t=e.layer.thematic.applied&&e.layer.thematic.applied.field||e.fields[0].name;this.updateStyle("field",t,!0)}this.checkInitialStyle(e)}render(){const e=this.props.layer&&this.props.layer.thematic&&this.props.layer.thematic.current;return m().createElement(d.Grid,{fluid:!0,className:"thematic_layer"},this.props.canEditThematic&&this.props.adminCfg.open?this.renderConfigurationEditor():null,this.hasConfiguration()&&!this.props.adminCfg.open&&e?this.renderThemaPanel(e):null)}}I(P,"propTypes",{layer:h().object,onChange:h().func,onChangeConfiguration:h().func,onSwitchLayer:h().func,onApplyStyle:h().func,onClassify:h().func,onDirtyStyle:h().func,onInvalidInput:h().func,onValidInput:h().func,getStyleParameters:h().func,getThematicParameters:h().func,getMetadataParameters:h().func,getColors:h().func,hasThematicStyle:h().func,removeThematicStyle:h().func,colors:h().array,fields:h().array,fieldsLoading:h().object,classification:h().array,classificationLoading:h().object,initialParams:h().object,methods:h().array,canEditThematic:h().bool,colorSamples:h().number,maxClasses:h().number,loaderSize:h().number,adminCfg:h().object,enableRemoveStyle:h().bool,applyEnabled:h().bool,invalidInputs:h().object,geometryType:h().string,onEditorReady:h().func}),I(P,"contextTypes",{messages:h().object}),I(P,"defaultProps",{onChange:()=>{},onChangeConfiguration:()=>{},onInvalidInput:()=>{},onValidInput:()=>{},getStyleParameters:()=>{},getThematicParameters:e=>e,getMetadataParameters:()=>{},hasThematicStyle:()=>{},removeThematicStyle:()=>{},getColors:e=>e,onSwitchLayer:()=>{},onClassify:()=>{},onApplyStyle:()=>{},onDirtyStyle:()=>{},canEditThematic:!1,fieldsLoading:{status:!1,error:null},classificationLoading:{status:!1,error:null},initialParams:{},colorSamples:5,maxClasses:15,loaderSize:100,adminCfg:{open:!1,current:null,error:null},enableRemoveStyle:!1,applyEnabled:!1,invalidInputs:{},geometryType:"Polygon",onEditorReady:()=>{}});const L=P}}]);