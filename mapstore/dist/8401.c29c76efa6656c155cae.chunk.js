(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[8401],{849514:(e,t,i)=>{"use strict";i.d(t,{Z:()=>v});var o=i(124852),s=i.n(o),r=i(237001),n=i(727418),p=i.n(n),a=i(45697),h=i.n(a),l=i(59854),d=i.n(l),c=i(414293),m=i.n(c),u=i(835516);function y(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class g extends s().Component{constructor(){super(...arguments),y(this,"updateZIndex",(e=>{const t=e||this.props.position;if(this.provider){const e=this.props.map.imageryLayers._layers.indexOf(this.provider),i=[...this.props.map.imageryLayers._layers].sort(((e,i)=>(e===this.provider?t:e._position)-(i===this.provider?t:i._position))).indexOf(this.provider)-e;0!==i&&[...new Array(Math.abs(i)).keys()].forEach((()=>{this.props.map.imageryLayers[i>0?"raise":"lower"](this.provider)})),this.props.map.scene.requestRender()}})),y(this,"setLayerVisibility",(e=>{const t=this.getVisibilityOption(this.props),i=this.getVisibilityOption(e);var o,s;i!==t&&(null!==(o=this.layer)&&void 0!==o&&o.detached&&null!==(s=this.layer)&&void 0!==s&&s.setVisible?this.layer.setVisible(i):i?(this.addLayer(e),this.updateZIndex()):this.removeLayer(),e.map.scene.requestRender())})),y(this,"getVisibilityOption",(e=>{const{options:t={},zoom:i,resolutions:o=(0,u.getResolutions)()}=e,s=d()(i),{visibility:r,minResolution:n=-1/0,maxResolution:p=1/0,disableResolutionLimits:a}=t||{};if(!a&&!m()(o[s])){const e=o[s];if(!(e<p&&e>=n))return!1}return!1!==r})),y(this,"setLayerOpacity",(e=>{e!==(this.props.options&&void 0!==this.props.options.opacity?this.props.options.opacity:1)&&this.layer&&this.provider&&(this.provider.alpha=e,this.props.map.scene.requestRender())})),y(this,"createLayer",((e,t,i,o,s)=>{if(e){const n=p()({},t,i?{zIndex:i}:null,{securityToken:s});this.layer=r.default.createLayer(e,n,o),this.layer&&(this.layer.layerName=t.name,this.layer.layerId=t.id),null===this.layer&&this.props.onCreationError(t),this.props.map.scene.requestRender()}})),y(this,"updateLayer",((e,t)=>{const i=r.default.updateLayer(e.type,this.layer,{...e.options,securityToken:e.securityToken},{...t.options,securityToken:t.securityToken},this.props.map);i&&(this.removeLayer(),this.layer=i,e.options.visibility&&this.addLayer(e)),e.map.scene.requestRender()})),y(this,"addLayerInternal",(e=>{e.options.useForElevation?this.props.map.terrainProvider=this.layer:(this.provider=this.props.map.imageryLayers.addImageryProvider(this.layer),this.provider._position=this.props.position,void 0!==e.options.opacity&&(this.provider.alpha=e.options.opacity)),e.map.scene.requestRender()})),y(this,"addLayer",(e=>{if(this.layer&&!this.layer.detached&&(this.addLayerInternal(e),this.props.options.refresh&&this.layer.updateParams)){let t=0;this.refreshTimer=setInterval((()=>{const i=this.layer.updateParams(p()({},this.props.options.params,{_refreshCounter:t++}));this.removeLayer(),this.layer=i,this.addLayerInternal(e),this.props.map.scene.requestRender()}),this.props.options.refresh)}})),y(this,"removeLayer",(e=>{var t,i;const o=e||this.provider;o&&this.props.map.imageryLayers.remove(o),null!==(t=this.layer)&&void 0!==t&&t.detached&&null!==(i=this.layer)&&void 0!==i&&i.remove&&this.layer.remove(),this.props.map.scene.requestRender()}))}componentDidMount(){this.createLayer(this.props.type,this.props.options,this.props.position,this.props.map,this.props.securityToken),this.props.options&&this.layer&&this.getVisibilityOption(this.props)&&(this.addLayer(this.props),this.updateZIndex())}UNSAFE_componentWillReceiveProps(e){this.setLayerVisibility(e);const t=e.options&&void 0!==e.options.opacity?e.options.opacity:1;if(this.setLayerOpacity(t),e.position!==this.props.position&&(this.updateZIndex(e.position),this.provider&&(this.provider._position=e.position)),this.props.options&&this.props.options.params&&this.layer.updateParams&&e.options.visibility&&Object.keys(this.props.options.params).reduce(((t,i)=>e.options.params[i]!==this.props.options.params[i]||t),!1)){const t=this.provider,i=this.layer.updateParams(e.options.params);this.layer=i,this.addLayer(e),setTimeout((()=>{this.removeLayer(t)}),1e3)}this.updateLayer(e,this.props)}componentWillUnmount(){var e;this.layer&&this.props.map&&!this.props.map.isDestroyed()&&(this.layer.detached&&null!==(e=this.layer)&&void 0!==e&&e.remove?this.layer.remove():(this.layer.destroy&&this.layer.destroy(),this.props.map.imageryLayers.remove(this.provider)),this.refreshTimer&&clearInterval(this.refreshTimer))}render(){if(this.props.children){const e=this.layer,t=e?s().Children.map(this.props.children,(t=>t?s().cloneElement(t,{container:e,styleName:this.props.options&&this.props.options.styleName}):null)):null;return s().createElement(s().Fragment,null,t)}return r.default.renderLayer(this.props.type,this.props.options,this.props.map,this.props.map.id,this.layer)}}y(g,"propTypes",{map:h().object,type:h().string,options:h().object,onCreationError:h().func,position:h().number,securityToken:h().string,zoom:h().number});const v=g},258258:(e,t,i)=>{"use strict";i.d(t,{Z:()=>L});var o=i(624089),s=(i(319683),i(763934),i(169819)),r=i(45697),n=i.n(r),p=i(49977),a=i.n(p),h=i(124852),l=i.n(h),d=i(180307),c=i.n(d),m=i(234228);const u=(e,t)=>{var i=e.scene;const s=t.position||t.endPosition;if(!s)return null;const r=e.camera.getPickRay(s),n=e.scene.globe.pick(r,e.scene),p=i._globe.ellipsoid;if(o.defined(n)){const o=p.cartesianToCartographic(n),s=function(e,t){if(null!==t.position){const i=e.scene,o=i._globe.ellipsoid;return i.camera.pickEllipsoid(t.position||t.endPosition,o)}return null}(e,t);return s&&(o.height=i._globe.getHeight(o),o.cartesian=s,o.position=n),o}return null};var y=i(835516),g=i(351546),v=i(727418),b=i.n(v),f=i(823493),O=i.n(f),E=i(618446),P=i.n(E);function T(){return T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},T.apply(this,arguments)}function C(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class k extends l().Component{constructor(){var e;super(...arguments),e=this,C(this,"state",{renderError:null}),C(this,"onClick",((e,t)=>{if(this.props.onClick&&null!==t.position){const i=e.camera.pickEllipsoid(t.position,e.scene.globe.ellipsoid),s=this.getIntersectedFeatures(e,t.position);let r=u(e,t)||i&&o.Cartographic.fromCartesian(i);if(r){const e=180*r.latitude/Math.PI,t=180*r.longitude/Math.PI,i=(90-e)/180*this.props.standardHeight*(this.props.zoom+1),o=(180+t)/360*this.props.standardWidth*(this.props.zoom+1);this.props.onClick({pixel:{x:o,y:i},height:this.props.mapOptions&&this.props.mapOptions.terrainProvider?r.height:void 0,cartographic:r,latlng:{lat:e,lng:t},crs:"EPSG:4326",intersectedFeatures:s,resolution:(0,y.getResolutions)()[Math.round(this.props.zoom)]})}}})),C(this,"onMouseMove",(e=>{var t;if(this.props.onMouseMove&&e.endPosition&&null!==(t=this.map)&&void 0!==t&&t.camera){const t=this.map.camera.pickEllipsoid(e.endPosition,this.map.scene.globe.ellipsoid);let i=u(this.map,e)||t&&o.Cartographic.fromCartesian(t);if(i){const e=Math.round(i.height);this.props.onMouseMove({y:180*i.latitude/Math.PI,x:180*i.longitude/Math.PI,z:e,crs:"EPSG:4326"})}}})),C(this,"getDocument",(()=>this.props.document||document)),C(this,"getMapOptions",(e=>{let t={};if(e.terrainProvider){let{type:i,...s}=e.terrainProvider;switch(i){case"cesium":t.terrainProvider=new o.CesiumTerrainProvider(s);break;case"ellipsoid":t.terrainProvider=new o.EllipsoidTerrainProvider}}return b()({},e,t)})),C(this,"getCenter",(()=>{const e=this.map.camera.positionCartographic;return{longitude:180*e.longitude/Math.PI,latitude:180*e.latitude/Math.PI,height:e.height}})),C(this,"getZoomFromHeight",(e=>Math.log2(this.props.zoomToHeight/e)+1)),C(this,"getHeightFromZoom",(e=>this.props.zoomToHeight/Math.pow(2,e-1))),C(this,"getIntersectedFeatures",((e,t)=>{const i=e.scene.drillPick(t);if(i){const e=i.reduce(((e,t)=>{var i;if(t instanceof o.Cesium3DTileFeature&&null!=t&&null!==(i=t.tileset)&&void 0!==i&&i.msId){const i=t.tileset.msId,o=t.getPropertyNames(),s=Object.fromEntries(o.map((e=>[e,t.getProperty(e)])));return{...e,[i]:e[i]?[...e[i],{type:"Feature",properties:s,geometry:null}]:[{type:"Feature",properties:s,geometry:null}]}}return e}),[]);return Object.keys(e).map((t=>({id:t,features:e[t]})))}return[]})),C(this,"gestureStartListener",(e=>{e.preventDefault()})),C(this,"setMousePointer",(e=>{this.map&&(c().findDOMNode(this).getElementsByClassName("cesium-viewer")[0].style.cursor=e||"auto")})),C(this,"_updateMapPositionFromNewProps",(e=>{const t=this.getCenter(),i=this.getZoomFromHeight(t.height),s=function(e,t){return void 0!==e&&void 0!==t&&e.toFixed(12)-t.toFixed(12)<=1e-12},r=!s(e.center.x,t.longitude)||!s(e.center.y,t.latitude),n=e.zoom!==i;if(r||n){const t={destination:o.Cartesian3.fromDegrees(e.center.x,e.center.y,this.getHeightFromZoom(e.zoom)),orientation:e.viewerOptions.orientation};this.setView(t)}})),C(this,"setView",(e=>{this.props.mapOptions&&this.props.mapOptions.flyTo?this.map.camera.flyTo(e,this.props.mapOptions.defaultFlightOptions):this.map.camera.setView(e)})),C(this,"subscribeClickEvent",(e=>{const t={LEFT_UP:o.ScreenSpaceEventType.LEFT_UP,LEFT_DOWN:o.ScreenSpaceEventType.LEFT_DOWN,LEFT_CLICK:o.ScreenSpaceEventType.LEFT_CLICK,PINCH_START:o.ScreenSpaceEventType.PINCH_START,PINCH_END:o.ScreenSpaceEventType.PINCH_END,PINCH_MOVE:o.ScreenSpaceEventType.PINCH_MOVE},i=new(a().Subject),s=new(a().Subject);Object.keys(t).forEach((e=>this.hand.setInputAction((o=>{s.next({type:t[e],movement:o}),i.next({type:t[e],movement:o})}),t[e]))),s.filter((e=>e.type===t.PINCH_END)).switchMap((()=>a().Observable.of(!0).concat(a().Observable.of(!1).delay(500)))).startWith(!1).switchMap((e=>e?a().Observable.never():i)).filter((e=>e.type===t.LEFT_DOWN)).switchMap((e=>{let{movement:o}=e;return i.filter((e=>e.type===t.LEFT_CLICK)).takeUntil(a().Observable.timer(500).merge(i.filter((e=>{return e.type!==t.LEFT_UP&&e.type!==t.LEFT_CLICK||e.type===t.LEFT_UP&&(i=o&&o.position,s=e.movement&&e.movement.position,!(i&&s&&i.x===s.x&&i.y===s.y));var i,s}))))})).subscribe((t=>{let{movement:i}=t;return this.onClick(e,i)})),this.clickStream$=i,this.pauserStream$=s})),C(this,"registerHooks",(()=>{this.props.hookRegister.registerHook(y.GET_PIXEL_FROM_COORDINATES_HOOK),this.props.hookRegister.registerHook(y.GET_COORDINATES_FROM_PIXEL_HOOK),this.props.hookRegister.registerHook(y.ZOOM_TO_EXTENT_HOOK,(function(t){let{crs:i,duration:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=(0,g.reprojectBbox)(t,i,"EPSG:4326");if(e.map.camera.flyTo){const t=o.Rectangle.fromDegrees(r[0],r[1],r[2],r[3]);e.map.camera.flyTo({destination:t,duration:s,complete:e.updateMapInfoState})}}))})),C(this,"updateMapInfoState",(()=>{const e=this.getCenter(),t=this.getZoomFromHeight(e.height),i={height:Math.round(this.props.standardWidth*(t+1)),width:Math.round(this.props.standardHeight*(t+1))};this.props.onMapViewChanges({x:e.longitude,y:e.latitude,crs:"EPSG:4326"},t,{bounds:{minx:-180,miny:-90,maxx:180,maxy:90},crs:"EPSG:4326",rotation:0},i,this.props.id,this.props.projection,{orientation:{heading:this.map.camera.heading,pitch:this.map.camera.pitch,roll:this.map.camera.roll}},(0,y.getResolutions)()[t])}))}UNSAFE_componentWillMount(){this.getDocument().addEventListener("gesturestart",this.gestureStartListener)}componentDidMount(){var e,t,i,r,n,p,a;const h=document.querySelector((null===(e=this.props.mapOptions)||void 0===e||null===(t=e.attribution)||void 0===t?void 0:t.container)||"#footer-attribution-container");let l=new o.Viewer(this.getDocument().getElementById(this.props.id),b()({imageryProvider:new o.OpenStreetMapImageryProvider,baseLayerPicker:!1,animation:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,creditContainer:h||void 0,requestRenderMode:!0,maximumRenderTimeChange:1/0,skyBox:!1},this.getMapOptions(this.props.mapOptions)));var d;this.props.errorPanel&&(l.cesiumWidget.showErrorPanel=(e,t,i)=>{this.setState({renderError:{title:e,message:t,error:i}})}),this.props.registerHooks&&this.registerHooks(),(null!==(i=this.props.mapOptions)&&void 0!==i&&i.navigationTools||this.props.zoomControl)&&l.extend(s.Z,{enableCompass:null===(d=this.props.mapOptions)||void 0===d?void 0:d.navigationTools,enableZoomControls:this.props.zoomControl,enableDistanceLegend:!1}),l.scene.globe.baseColor=o.Color.WHITE,l.imageryLayers.removeAll(),l.camera.moveEnd.addEventListener(this.updateMapInfoState),this.hand=new o.ScreenSpaceEventHandler(l.scene.canvas),this.subscribeClickEvent(l),this.hand.setInputAction(O()(this.onMouseMove.bind(this),500),o.ScreenSpaceEventType.MOUSE_MOVE),l.camera.setView({destination:o.Cartesian3.fromDegrees(this.props.center.x,this.props.center.y,this.getHeightFromZoom(this.props.zoom))}),this.setMousePointer(this.props.mousePointer),this.map=l;const c=this.map.scene;c.skyAtmosphere.show=(null===(r=this.props.mapOptions)||void 0===r?void 0:r.showSkyAtmosphere)??!0,c.fog.enabled=(null===(n=this.props.mapOptions)||void 0===n?void 0:n.enableFog)??!1,c.globe.showGroundAtmosphere=(null===(p=this.props.mapOptions)||void 0===p?void 0:p.showGroundAtmosphere)??!1,c.globe.depthTestAgainstTerrain=(null===(a=this.props.mapOptions)||void 0===a?void 0:a.depthTestAgainstTerrain)??!1,this.forceUpdate(),l.scene.requestRender()}UNSAFE_componentWillReceiveProps(e){return e.mousePointer!==this.props.mousePointer&&this.setMousePointer(e.mousePointer),e.mapStateSource!==this.props.id&&this._updateMapPositionFromNewProps(e),!1}componentDidUpdate(e){var t,i,s,r,n;if(null!==(t=this.props)&&void 0!==t&&t.orientate&&e&&!P()(this.props.orientate,null==e?void 0:e.orientate)){const e={destination:o.Cartesian3.fromDegrees(parseFloat(this.props.orientate.x),parseFloat(this.props.orientate.y),this.getHeightFromZoom(parseFloat(this.props.orientate.z))),orientation:{heading:parseFloat(this.props.orientate.heading),pitch:parseFloat(this.props.orientate.pitch),roll:parseFloat(this.props.orientate.roll)}};this.setView(e)}e&&this.props.mapOptions.showSkyAtmosphere!==(null==e||null===(i=e.mapOptions)||void 0===i?void 0:i.showSkyAtmosphere)&&(this.map.scene.skyAtmosphere.show=this.props.mapOptions.showSkyAtmosphere),e&&this.props.mapOptions.showGroundAtmosphere!==(null==e||null===(s=e.mapOptions)||void 0===s?void 0:s.showGroundAtmosphere)&&(this.map.scene.globe.showGroundAtmosphere=this.props.mapOptions.showGroundAtmosphere),e&&this.props.mapOptions.enableFog!==(null==e||null===(r=e.mapOptions)||void 0===r?void 0:r.enableFog)&&(this.map.scene.fog.enabled=this.props.mapOptions.enableFog),e&&this.props.mapOptions.depthTestAgainstTerrain!==(null==e||null===(n=e.mapOptions)||void 0===n?void 0:n.depthTestAgainstTerrain)&&(this.map.scene.globe.depthTestAgainstTerrain=this.props.mapOptions.depthTestAgainstTerrain)}componentWillUnmount(){var e,t;this.clickStream$.complete(),this.pauserStream$.complete(),this.hand.destroy(),this.getDocument().removeEventListener("gesturestart",this.gestureStartListener),null!==(e=this.map)&&void 0!==e&&null!==(t=e.cesiumNavigation)&&void 0!==t&&t.destroy&&this.map.cesiumNavigation.destroy(),this.map.destroy()}render(){var e;const t=this.map,i=this.props.projection,o=t?l().Children.map(this.props.children,(e=>e?l().cloneElement(e,{map:t,projection:i,onCreationError:this.props.onCreationError,zoom:this.props.zoom}):null)):null,s=this.props.errorPanel;return l().createElement("div",{id:this.props.id},o,s?l().createElement(s,{show:!!this.state.renderError,error:null===(e=this.state.renderError)||void 0===e?void 0:e.error,onReload:()=>this.props.onReload()}):null)}}C(k,"propTypes",{id:n().string,document:n().object,center:m.ZP.PropTypes.center,zoom:n().number.isRequired,mapStateSource:m.ZP.PropTypes.mapStateSource,projection:n().string,onMapViewChanges:n().func,onCreationError:n().func,onClick:n().func,onMouseMove:n().func,mapOptions:n().object,standardWidth:n().number,standardHeight:n().number,mousePointer:n().string,zoomToHeight:n().number,registerHooks:n().bool,hookRegister:n().object,viewerOptions:n().object,orientate:n().object,zoomControl:n().bool,errorPanel:n().func,onReload:n().func}),C(k,"defaultProps",{id:"map",onMapViewChanges:()=>{},onClick:()=>{},onCreationError:()=>{},projection:"EPSG:3857",mapOptions:{},standardWidth:512,standardHeight:512,zoomToHeight:8e7,registerHooks:!0,hookRegister:{registerHook:y.registerHook},orientate:void 0,viewerOptions:{orientation:{heading:0,pitch:-1*Math.PI/2,roll:0}},onReload:()=>{}});const L=(0,h.forwardRef)(((e,t)=>{const[i,o]=(0,h.useState)(1);return l().createElement(k,T({key:i,ref:t},e,{onReload:()=>o(i+1)}))}))}}]);