(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[7056],{99866:(e,t,a)=>{"use strict";a.r(t),a.d(t,{contextManagerSearchContextsEpic:()=>m,editContext:()=>x,contextManagerDeleteContextEpic:()=>g,resetContextSearch:()=>b,contextManagerReloadOnContexts:()=>T});var s=a(49977),o=a.n(s),r=a(275982),n=a(288287),i=a(426529),c=a(504518),l=a(679426),p=a(853),u=a(371714),d=a(622901),h=a(372492);const m=e=>e.ofType(h.Ut).map((e=>{let{text:t,options:a}=e;return{text:t,options:a||{params:{start:0,limit:12}}}})).switchMap((e=>{let{text:t,options:a}=e;return o().Observable.defer((()=>n.Z.getResourcesByCategory("CONTEXT",t,a))).map((e=>(0,h.g_)(e,t,a))).let((0,i.hP)((0,h.as)(!0,"loading"),(0,h.as)(!1,"loading"),(()=>o().Observable.of((0,c.vU)({title:"notification.error",message:"resources.contexts.errorLoadingContexts",autoDismiss:6,position:"tc"})))))})),x=e=>e.ofType(h.y8).switchMap((e=>{let{resource:t}=e;return t?o().Observable.of((0,d.kb)(),(0,r.VF)(`/context-creator/${t.id}`)):o().Observable.empty()})),g=e=>e.ofType(h.v8).switchMap((e=>(0,l.fg)(e).map((()=>(0,h.zr)(e))))).let((0,i.hP)((0,h.as)(!0,"loading"),(0,h.as)(!1,"loading"),(()=>o().Observable.of((0,c.vU)({title:"notification.error",message:"resources.contexts.deleteError",autoDismiss:6,position:"tc"}))))),b=e=>e.ofType(h.x_).switchMap((()=>o().Observable.of((0,h.H6)("",{params:{start:0,limit:12}})))),T=(e,t)=>e.ofType(h.Ej,h.fJ,u.vY,d.Ps).delay(1e3).switchMap((()=>o().Observable.of((0,h.H6)((0,p.e8)(t.getState()),(e=>{const t=(0,p._y)(e),a=(0,p.bA)(e)||{},{start:s,limit:o,...r}=a.params;return s===t-1?{start:Math.max(0,s-o),limit:o}:{...a,params:{...r,start:s,limit:o}}})(t.getState())))))},940670:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>re});var s={};a.r(s),a.d(s,{reloadOnContexts:()=>B,searchContextsEpic:()=>z,searchContextsOnMapSearch:()=>V});var o=a(124852),r=a.n(o),n=a(45697),i=a.n(n),c=a(171703),l=a(867076),p=a(22222),u=a(804504),d=a(152543),h=a(510644),m=a(522073);const x=e=>e&&e.contexts&&e.contexts.searchText,g=e=>e&&e.contexts&&e.contexts.options,b=(0,p.P1)(g,(e=>e&&e.params)),T=e=>e&&e.contexts&&e.contexts.results,v=e=>e&&e.contexts&&e.contexts.totalCount,f=e=>e&&e.contexts&&e.contexts.loading,C="CONTEXTS:SET_CONTEXTS_AVAILABLE",E="CONTEXTS:SEARCH_CONTEXTS",O="CONTEXTS:CONTEXTS_LIST_LOADED",S="CONTEXTS:LOADING",y=(e,t)=>({type:E,searchText:e,params:t}),M=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"loading";return{type:S,name:t,value:e}};var w=a(706558);const D=(0,l.compose)((0,c.connect)((0,p.P1)(x,b,T,v,f,(()=>!1),(function(e){let{start:t=0,limit:a=12}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;const n=Math.min(o||0,a||0),i=s&&n&&Math.ceil(t/n)||0;return{page:i,pageSize:a,items:s,total:o,searchText:e,loading:r}})),{searchContexts:y}),(0,l.renameProp)("searchContexts","loadPage"),(0,l.withHandlers)({onSelect:e=>{let{loadPage:t=(()=>{}),searchText:a,pageSize:s}=e;return e=>{t(a,{start:s*e,limit:s})}}}))(w.Z);var N=a(505261),P=a(372492),A=a(371714),X=a(504518);const F=(0,l.compose)((0,c.connect)((0,p.zB)({user:h.np}),{onEditData:P.ix,onDelete:P.D0,onUpdateAttribute:A.tC,reloadContexts:P.mE,invalidateFeaturedMaps:A.DG,onShowSuccessNotification:()=>(0,X.Vp)({title:"success",message:"resources.successSaved"})}))(N.Z);var Z=a(101092),R=a(970218),U=a(141919),_=a(49977),L=a.n(_),k=a(288287),I=a(426529),j=a(412961),H=a(622901);const V=(e,t)=>e.ofType(A.hU,C).switchMap((e=>{var a;let{searchText:s}=e;return null!==(a=t.getState().contexts)&&void 0!==a&&a.available?L().Observable.of(y(s)):L().Observable.empty()})),z=(e,t)=>{let{getState:a=(()=>{})}=t;return e.ofType(E).map((e=>{let{params:t,searchText:s,geoStoreUrl:o}=e;return{searchText:s,options:{params:t||b(a())||{start:0,limit:12},...o?{baseURL:o}:{}}}})).switchMap((e=>{let{searchText:t,options:a}=e;return L().Observable.defer((()=>k.Z.getResourcesByCategory("CONTEXT",t,a))).map((e=>((e,t)=>{let{results:a,success:s,totalCount:o}=e,{searchText:r,options:n}=t;return{type:O,results:a,success:s,totalCount:o,searchText:r,options:n}})(e,{searchText:t,options:a}))).let((0,I.hP)(M(!0,"loading"),M(!1,"loading"),(()=>L().Observable.of((0,X.vU)({title:"notification.error",message:"resources.contexts.errorLoadingContexts",autoDismiss:6,position:"tc"})))))}))},B=(e,t)=>e.ofType("CONTEXTS:CONTEXT_DELETED","CONTEXTS:RELOAD_CONTEXTS",A.vY,H.Ps,j.XP,j.Nv).delay(1e3).switchMap((()=>t.getState().contexts.available?L().Observable.of(y(x(t.getState()),(e=>{const t=v(e),{start:a,limit:s,...o}=b(e)||{};return a===t-1?{start:Math.max(0,a-s),limit:s}:{start:a,limit:s,...o}})(t.getState()))):L().Observable.empty()));var $=a(99866),G=a(980153),Y=a(275982),q=a(521923),J=a(984596),Q=a.n(J);var K=a(260817);function W(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const ee=(0,p.P1)(v,(e=>e&&e.contexts&&e.contexts.available),((e,t)=>({count:e,available:t})));class te extends r().Component{render(){return r().createElement(F,{resources:this.props.resources,fluid:this.props.fluid,title:this.props.title,colProps:this.props.colProps,viewerUrl:e=>this.context.router.history.push(`/context/${e.name}`),getShareUrl:e=>`context/${e.name}`,editDataEnabled:this.props.editDataEnabled,onEditData:this.props.onEditData,nameFieldFilter:e=>e.replace(/[^a-zA-Z0-9\-_]/,""),cardTooltips:{deleteResource:"resources.resource.deleteResource",editResource:"resources.resource.editResource",editResourceData:"contextManager.editContextTooltip",shareResource:"share.title",addToFeatured:"resources.resource.addToFeatured",showDetails:"resources.resource.showDetails",removeFromFeatured:"resources.resource.removeFromFeatured"},shareToolEnabled:this.props.shareToolEnabled,shareOptions:this.props.shareOptions,bottom:r().createElement(D,null)})}}W(te,"propTypes",{className:i().string,splitTools:i().bool,showOptions:i().bool,searchOptions:i().object,isSearchClickable:i().bool,hideOnBlur:i().bool,placeholderMsgId:i().string,typeAhead:i().bool,searchText:i().string,onSearch:i().func,onSearchReset:i().func,onSearchTextChange:i().func,onEditData:i().func,onMount:i().func,onUnmount:i().func,resources:i().array,colProps:i().object,fluid:i().bool,title:i().string,shareOptions:i().object,shareToolEnabled:i().bool,editDataEnabled:i().bool,emptyView:i().object}),W(te,"contextTypes",{router:i().object}),W(te,"defaultProps",{className:"user-search",hideOnBlur:!1,isSearchClickable:!0,showOptions:!1,splitTools:!1,placeholderMsgId:"contextManager.searchPlaceholder",title:r().createElement("h3",null,r().createElement(u.Z,{msgId:"resources.contexts.titleNoCount"})),typeAhead:!1,searchText:"",searchOptions:{params:{start:0,limit:12}},resources:[],colProps:{xs:12,sm:6,lg:3,md:4,className:"ms-map-card-col"},fluid:!0,editDataEnabled:!0,shareOptions:K.H4,shareToolEnabled:!0,emptyView:{},onEditData:()=>{}});const ae=(0,c.connect)(ee,{setContextsAvailable:function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return{type:C,available:e}}})((e=>{let{setContextsAvailable:t,count:a="",available:s}=e;return(0,o.useEffect)((()=>{!s&&t(!0)}),[]),r().createElement(u.Z,{msgId:"resources.contexts.title",msgParams:{count:a+""}})})),se=(0,p.P1)([Z.$v,x,g,T,f,R.fE,h.L3,m.versionSelector],(function(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,n=arguments.length>6?arguments[6]:void 0,i=arguments.length>7?arguments[7]:void 0;return{mapType:e,searchText:t,version:i,resources:s.map((e=>({...e,featuredEnabled:r&&"ADMIN"===n}))),loading:o}})),oe=(0,l.compose)((0,c.connect)(se,{loadMaps:A.MT}),(0,U.Z)((e=>{let{resources:t=[],loading:a}=e;return!a&&0===t.length}),(e=>({glyph:"map-context",title:r().createElement(u.Z,{msgId:"resources.contexts.noContextAvailable"}),iconFit:!0,imageStyle:{height:(null==e?void 0:e.iconHeight)??"200px"}}))))(te),re=(0,d.rx)("Contexts",{component:(0,c.connect)(se)(oe),containers:{ContentTabs:{name:"contexts",key:"contexts",TitleComponent:ae,position:4,tool:!0,priority:1}},reducers:{maps:G.Z,contexts:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enabled:!1,start:0,limit:12,errors:[],searchText:"",available:!1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:return(0,q.t8)("available",t.available,e);case Y.nk:return(0,q.t8)("showModal",{},e);case O:return{...e,results:""!==t.results?Q()(t.results):[],success:t.success,totalCount:t.totalCount,start:t.params&&t.params.start,limit:t.params&&t.params.limit,searchText:t.searchText,options:t.options};case A.hU:return{...e,start:t.params&&t.params.start,limit:t.params&&t.params.limit,searchText:t.searchText};case S:return(0,q.t8)("loading"===t.name?"loading":`loadFlags.${t.name}`,t.value,(0,q.t8)("loading",t.value,e));default:return e}}},epics:{...s,...$}})},505261:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});var s=a(867076),o=a(328062),r=a(770165),n=a(249461);const i=(0,s.compose)((0,s.withHandlers)({onSaveSuccess:e=>()=>{e.reloadContexts&&e.reloadContexts(),e.invalidateFeaturedMaps&&e.invalidateFeaturedMaps(),e.onShowSuccessNotification&&e.onShowSuccessNotification()}}),(0,s.defaultProps)({category:"CONTEXT"}),o.Z,(0,s.compose)((0,s.defaultProps)({shareOptions:{embedOptions:{showTOCToggle:!1},advancedSettingsVisibility:{bbox:!0}}}),r.Z))(n.Z)},853:(e,t,a)=>{"use strict";a.d(t,{e8:()=>o,bA:()=>r,Qq:()=>n,Mz:()=>i,_y:()=>c,VO:()=>l});var s=a(22222);const o=e=>e&&e.contextmanager&&e.contextmanager.searchText,r=e=>e&&e.contextmanager&&e.contextmanager.searchOptions,n=(0,s.P1)(r,(e=>e&&e.params)),i=e=>e&&e.contextmanager&&e.contextmanager.results,c=e=>e&&e.contextmanager&&e.contextmanager.totalCount,l=e=>e&&e.contextmanager&&e.contextmanager.loading}}]);