(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[7756],{890032:(e,t,o)=>{"use strict";o.d(t,{Z:()=>n});var s=o(867076);const a=o(49977),r=function(e,t,o){let{dataProp:s="items",initialStreamDebounce:r=0,throttleTime:n=500}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e.take(1).concat(e.debounceTime(r)).switchMap((e=>o(e,0).startWith({loading:!0}).concat(a.Observable.of({loading:!1})).concat(t.throttleTime(n).distinct().exhaustMap((t=>o(e,t).startWith({loading:!0}).concat(a.Observable.of({loading:!1}))))).scan(((e,t)=>{let{[s]:o,...a}=e,{[s]:r,...n}=t;return{[s]:r?[...o||[],...r]:o||[],...a,...n}})).map((e=>({...e}))))).catch((e=>a.Observable.of({loading:!1,error:e})))},n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>a.Observable.empty(),t=arguments.length>1?arguments[1]:void 0;return(0,s.mapPropsStream)((o=>{const{handler:a,stream:n}=(0,s.createEventHandler)(),{handler:l,stream:i}=(0,s.createEventHandler)();return o.combineLatest(r(i,n,e,t).startWith({}),((e,t)=>({...e,...t,onLoadMore:a,loadFirst:l})))}))}},185936:(e,t,o)=>{"use strict";o.d(t,{Z:()=>n});var s=o(890032),a=o(867076),r=o(274335);const n=e=>{let{loadPage:t,scrollSpyOptions:o,loadStreamOptions:n,loadMoreStreamOptions:l,hasMore:i,isScrolled:c}=e;return(0,a.compose)((0,s.Z)(t,l),(0,a.defaultProps)({hasMore:i,isScrolled:c}),(0,r.Z)(o,n))}},274335:(e,t,o)=>{"use strict";o.d(t,{Z:()=>p});var s=o(124852),a=o.n(s),r=o(45697),n=o.n(r),l=o(180307),i=o.n(l);function c(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o(49977);const p=function(){let{dataProp:e="items",querySelector:t,closest:o=!1,loadingProp:s="loading",skip:r=0,pageSize:l=10,offsetSize:p=200}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return d=>{var h;return h=class extends a().Component{constructor(){super(...arguments),c(this,"findScrollDomNode",(()=>{if(!this.isMounded)return null;let e=i().findDOMNode(this);return e&&o&&t?e.closest(t||"*"):e&&(t?e.querySelector(t):e)})),c(this,"onScroll",(()=>{const t={skip:r,pageSize:l,offsetSize:p,...this.props.scrollOptions},o=this.findScrollDomNode();o&&this.props.isScrolled({div:o,offset:t.offsetSize})&&(!e||this.props[e]&&this.props[e].length)&&(!s||!this.props[s])&&this.props.hasMore(this.props)&&this.props.onLoadMore(e?Math.ceil((this.props[e].length-t.skip)/t.pageSize):null)}))}componentDidMount(){this.isMounded=!0;const e=this.findScrollDomNode();e&&(this.listenerAdded=!0,e.addEventListener("scroll",this.onScroll,!1),this.onScroll())}componentDidUpdate(t){const o=this.findScrollDomNode();o&&!this.listenerAdded&&(o.addEventListener("scroll",this.onScroll,!1),this.listenerAdded=!0),!o||e&&this.props[e]&&this.props[e]===t[e]||setTimeout((()=>this.onScroll()),300)}componentWillUnmount(){this.isMounded=!1,this.listenerAdded=!1;const e=this.findScrollDomNode();e&&e.removeEventListener("scroll",this.onScroll,!1)}render(){return a().createElement(d,this.props)}},c(h,"propTypes",{hasMore:n().func,onLoadMore:n().func,isScrolled:n().func,scrollOptions:n().object}),c(h,"defaultProps",{onLoadMore:()=>{},hasMore:()=>!0,isScrolled:e=>{let{div:t,offset:o}=e;return t.scrollTop+t.clientHeight>=t.scrollHeight-o}}),h}}},477065:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>K});var s={};o.r(s),o.d(s,{checkContextsOnMapLoad:()=>$,createNewMapEpic:()=>X});var a=o(124852),r=o.n(a),n=o(45697),l=o.n(n),i=o(171703),c=o(804504),p=o(49977),d=o.n(p),h=o(252628),m=o.n(h),u=o(867076),g=o(630294),w=o(679426),y=o(185936),b=o(603754),E=o(283604),M=o(63101),f=o(89518),N=o(719648);const S=e=>{let{searchText:t,opts:o}=e;return(0,w.jh)({query:t||"*",category:"CONTEXT",options:o}).switchMap((e=>d().Observable.of({items:1===e.totalCount?[e.results]:m()(e.results),total:e.totalCount,loading:!1})))},v=(e,t)=>({title:t.name,description:t.description,preview:r().createElement("div",{className:"new-map-preview"},t.thumbnail&&"NODATA"!==t.thumbnail?r().createElement("img",{src:t.thumbnail}):r().createElement(g.Glyphicon,{glyph:"1-map"})),onClick:()=>e(t)}),C=(0,u.branch)((e=>{let{show:t}=e;return t}),(0,u.compose)((0,u.withState)("filterText","setFilterText",""),(0,u.getContext)({messages:l().object}),(0,y.Z)({loadPage:function(){let{searchText:e="",limit:t=12}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return S({searchText:e,opts:{params:{start:o*t,limit:t}}})},loadMoreStreamOptions:{initialStreamDebounce:300},scrollSpyOptions:{querySelector:".new-map-dialog-list-container",pageSize:12},hasMore:e=>{let{items:t=[],total:o=0}=e;return t.length<o}}),(0,u.lifecycle)({componentDidMount(){this.props.loadFirst&&this.props.loadFirst()}})))((e=>{let{loading:t,show:o,filterText:s="",loadFirst:a=(()=>{}),setFilterText:n=(()=>{}),onClose:l=(()=>{}),onSelect:i=(()=>{}),items:p=[],messages:d={}}=e;return r().createElement(E.Z,{show:o,loading:t&&p.length>0,title:r().createElement(c.Z,{msgId:"newMapDialog.title"}),fade:!0,clickOutEnabled:!1,buttons:[{text:r().createElement(c.Z,{msgId:"cancel"}),bsStyle:"primary",onClick:()=>l()}],onClose:l},r().createElement("div",{className:"new-map-dialog"},r().createElement("div",{className:"new-map-dialog-filter-container"},r().createElement(b.Z,{filterText:s,onFilter:e=>{n(e),a({searchText:e})},filterPlaceholder:(0,N.S$)(d,"newMapDialog.filterPlaceholder")})),r().createElement("div",{className:"new-map-dialog-list-container"},t&&0===p.length?r().createElement("div",{className:"new-map-loader"},r().createElement(f.Z,{size:100})):r().createElement(M.Z,{items:p.map(v.bind(null,i)),emptyStateProps:{glyph:"1-map",title:r().createElement(c.Z,{msgId:"newMapDialog.noContexts"})}}))))}));var T=o(23888),x=o(36549);const D="CREATENEWMAP:SHOW_NEW_MAP_DIALOG",O="CREATENEWMAP:CREATE_NEW_MAP",P="CREATENEWMAP:HAS_CONTEXTS",A="CREATENEWMAP:SET_NEW_MAP_CONTEXT",k="CREATENEWMAP:LOADING",I=e=>({type:D,show:e}),Z=e=>({type:P,value:e}),L=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"loading";return{type:k,name:t,value:e}},F=e=>e.createnewmap&&e.createnewmap.showNewMapDialog,W=e=>e.createnewmap&&e.createnewmap.hasContexts,G=e=>e.createnewmap&&e.createnewmap.loading,j=e=>e.createnewmap&&e.createnewmap.loadFlags;var R=o(101092),q=o(521923),_=o(275982),z=o(371714),H=o(426529);const $=e=>e.ofType(z.qy).switchMap((()=>(0,w.jh)({category:"CONTEXT",options:{params:{start:0,limit:1}}}).map((e=>e.totalCount)).switchMap((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return d().Observable.of(Z(e>0))})).let((0,H.hP)(L(!0,"newMapDialog"),L(!1,"newMapDialog"),(()=>d().Observable.empty()))))),X=(e,t)=>e.ofType(O).switchMap((e=>{let{context:o}=e;const s=t.getState(),a=(0,R.$v)(s);return d().Observable.of(I(!1),(0,_.VF)("/viewer/"+a+"/new"+(o?`/context/${o.id}`:"")))}));function B(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const U=(0,x.Z)(T.Z),V=(0,x.Z)(g.SplitButton);class J extends r().Component{constructor(){super(...arguments),B(this,"createNewEmptyMap",(()=>{this.context.router.history.push("/viewer/"+this.props.mapType+"/new")})),B(this,"isAllowed",(()=>this.props.isLoggedIn&&this.props.allowedRoles.indexOf(this.props.user&&this.props.user.role)>=0))}render(){const e=this.isAllowed()?null:"none";return r().createElement("div",{className:"create-new-map-container"},r().createElement(g.Grid,{fluid:this.props.fluid,style:{marginBottom:"30px",padding:0,display:e}},r().createElement(g.Col,this.props.colProps,r().createElement(g.ButtonToolbar,null,this.props.hasContexts&&r().createElement(V,{id:"split-button",tooltipId:"newMap",className:"square-button",bsStyle:"primary",title:r().createElement(g.Glyphicon,{glyph:"add-map"}),onClick:()=>this.createNewEmptyMap()},r().createElement(g.MenuItem,{onClick:()=>this.createNewEmptyMap()},r().createElement(c.Z,{msgId:"newMapEmpty"})),r().createElement(g.MenuItem,{onClick:()=>this.props.onShowNewMapDialog(!0)},r().createElement(c.Z,{msgId:"newMapContext"}))),!this.props.hasContexts&&r().createElement(U,{tooltipId:"newMap",className:"square-button",bsStyle:"primary",onClick:()=>this.createNewEmptyMap()},r().createElement(g.Glyphicon,{glyph:"add-map"})),this.props.showNewDashboard?r().createElement(U,{tooltipId:"resources.dashboards.newDashboard",className:"square-button",bsStyle:"primary",onClick:()=>{this.context.router.history.push("/dashboard")}},r().createElement(g.Glyphicon,{glyph:"add-dashboard"})):null,this.props.showNewGeostory?r().createElement(U,{tooltipId:"resources.geostories.newGeostory",className:"square-button",bsStyle:"primary",onClick:()=>{this.context.router.history.push("/geostory/newgeostory/")}},r().createElement(g.Glyphicon,{glyph:"add-geostory"})):null))),r().createElement(C,{show:this.props.showNewMapDialog,onClose:()=>this.props.onShowNewMapDialog(!1),onSelect:this.props.onNewMap}))}}B(J,"propTypes",{loading:l().bool,loadFlags:l().object,mapType:l().string,showNewDashboard:l().bool,showNewGeostory:l().bool,colProps:l().object,isLoggedIn:l().bool,allowedRoles:l().array,user:l().object,fluid:l().bool,hasContexts:l().bool,showNewMapDialog:l().bool,onShowNewMapDialog:l().func,onNewMap:l().func}),B(J,"contextTypes",{router:l().object}),B(J,"defaultProps",{loading:!1,loadFlags:{},mapType:"leaflet",showNewDashboard:!0,showNewGeostory:!0,isLoggedIn:!1,allowedRoles:["ADMIN","USER"],colProps:{xs:12,sm:12,lg:12,md:12},fluid:!1,hasContexts:!1,showNewMapDialog:!1,onShowNewMapDialog:()=>{},onNewMap:()=>{}});const K={CreateNewMapPlugin:(0,i.connect)((e=>({loading:G(e),loadFlags:j(e),mapType:(0,R.$v)(e),isLoggedIn:!(!(e&&e.security&&e.security.user&&e.security.user.enabled)||e.browser&&e.browser.mobile),user:e&&e.security&&e.security.user,hasContexts:W(e),showNewMapDialog:F(e)})),{onShowNewMapDialog:I,onNewMap:e=>({type:O,context:e})})(J),reducers:{createnewmap:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:return(0,q.t8)("showNewMapDialog",t.show,e);case A:return(0,q.t8)("newMapContext",t.context,e);case P:return(0,q.t8)("hasContexts",t.value,e);case k:return(0,q.t8)("loading"===t.name?"loading":`loadFlags.${t.name}`,t.value,(0,q.t8)("loading",t.value,e));default:return e}}},epics:s}}}]);