(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[3513],{994345:(e,t,o)=>{"use strict";o.d(t,{Z:()=>n});var a=o(867076),r=o(36549),l=o(832979);const n=(0,a.compose)((0,a.withProps)((e=>{let{renderPopover:t,popoverOptions:o,...a}=e;return t?{renderPopover:t,popoverOptions:o,...a}:{...a}})),(0,a.branch)((function(){let{renderPopover:e,popoverOptions:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e&&!!t}),l.Z,r.Z))},832979:(e,t,o)=>{"use strict";o.d(t,{Z:()=>u});var a=o(124852),r=o.n(a),l=o(118438),n=o(630294),s=o(957557),i=o.n(s),d=o(180307),p=o.n(d);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},c.apply(this,arguments)}const u=e=>class extends r().Component{render(){let t=null;const{popoverOptions:o,keyProp:a,...s}=this.props;return r().createElement("span",{className:"mapstore-info-popover"},r().createElement(e,c({},i()(s,["renderPopover","tooltipId"]),{key:a,ref:e=>{t=e}})),r().createElement(l.Z,{placement:o.placement,shouldUpdatePosition:!0,show:!0,target:()=>p().findDOMNode(t)},r().createElement(n.Popover,o.props,o.content)))}}},712845:(e,t,o)=>{"use strict";o.d(t,{Z:()=>c});var a=o(124852),r=o.n(a),l=o(630294),n=o(23888);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},s.apply(this,arguments)}const i={width:0,padding:0,borderWidth:0},d={},p=e=>e?d:i,c=(0,a.forwardRef)(((e,t)=>{let{disabled:o,id:a,visible:i,onClick:d,glyph:c,active:u,className:m="square-button-md",...g}=e;return r().createElement(n.Z,s({ref:t},g,{bsStyle:u?"success":"primary",disabled:o,id:`fg-${a}`,style:p(i),className:m,onClick:()=>!o&&d()}),r().createElement(l.Glyphicon,{glyph:c}))}))},81674:(e,t,o)=>{"use strict";o.d(t,{l:()=>i});var a=o(49977),r=o(470509),l=o.n(r),n=o(510810),s=o(474810);const i=(e,t)=>a.Observable.defer((()=>l().get((0,s.Jy)(e,{version:"1.0.0",REQUEST:"DescribeProcess",IDENTIFIER:t}),{timeout:5e3,headers:{Accept:"application/json","Content-Type":"application/xml"}}))).let(n.oB)},372236:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>Vt});var a={};o.r(a),o.d(a,{checkExportDataEntriesEpic:()=>Bt,checkWPSAvailabilityEpic:()=>kt,closeExportDownload:()=>Zt,fetchFormatsWFSDownload:()=>Wt,openDownloadTool:()=>Gt,resetExportDataResultsOnLogout:()=>jt,serializeCookieOnExportDataChange:()=>qt,setExportDataResultsOnLoginSuccessAndMapConfigLoaded:()=>Xt,showInfoBubbleMessageEpic:()=>_t,startFeatureExportDownload:()=>Mt});var r=o(171703),l=o(22222);const n="LAYERDOWNLOAD:CHECK_WPS_AVAILABILITY",s="LAYERDOWNLOAD:CHECKING_WPS_AVAILABILITY",i="LAYERDOWNLOAD:DOWNLOAD_FEATURES",d="LAYERDOWNLOAD:DOWNLOAD_FINISHED",p="LAYERDOWNLOAD:FORMAT_SELECTED",c="LAYERDOWNLOAD:CLEAR_DOWNLOAD_OPTIONS",u="LAYERDOWNLOAD:FORMAT_FETCH",m="LAYERDOWNLOAD:FORMAT_UPDATE",g="LAYERDOWNLOAD:SET_SERVICE",y="LAYERDOWNLOAD:SET_EXPORT_DATA_RESULTS",w="LAYERDOWNLOAD:ADD_EXPORT_DATA_RESULT",v="LAYERDOWNLOAD:UPDATE_EXPORT_DATA_RESULT",h="LAYERDOWNLOAD:REMOVE_EXPORT_DATA_RESULT",b="LAYERDOWNLOAD:REMOVE_EXPORT_DATA_RESULTS",f="LAYERDOWNLOAD:CHECK_EXPORT_DATA_ENTRIES",E="LAYERDOWNLOAD:CHECKING_EXPORT_DATA_ENTRIES",O="LAYERDOWNLOAD:SERIALIZE_COOKIE",S="LAYERDOWNLOAD:SHOW_INFO_BUBBLE_MESSAGE",D="LAYERDOWNLOAD:SHOW_INFO_BUBBLE",R="LAYERDOWNLOAD:SET_INFO_BUBBLE_MESSAGE",A=e=>({type:s,checking:e}),N=(e,t)=>({type:p,key:e,value:t}),C=()=>({type:d}),x=e=>({type:g,service:e}),P=e=>({type:y,results:e}),T=(e,t)=>({type:v,id:e,newProps:t}),F=e=>({type:E,checking:e}),L=(e,t,o,a)=>({type:S,msgId:e,msgParams:t,level:o,duration:a}),I=e=>({type:D,show:e}),k=(e,t,o)=>({type:R,msgId:e,msgParams:t,level:o});var G=o(687753),W=o(820709),M=o(612912),Z=o(254020);const _=e=>{var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.service},B=(0,l.P1)(W.Rd,Z.X1,M.Iz,((e,t,o)=>e?t:null!=o&&o.name?{featureTypeName:o.name,filterType:"OGC",ogcVersion:"1.1.0"}:null)),q=e=>{var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.results};var j=o(707366),X=o(124852),V=o.n(X),U=o(45697),H=o.n(U),Y=o(630998),z=o.n(Y),$=o(727418),K=o.n($),J=o(630294),Q=o(472986),ee=o.n(Q),te=o(89518),oe=o(590504),ae=o(466737),re=o(804504),le=o(747119),ne=o(743129),se=o(227361),ie=o.n(se),de=o(91175),pe=o.n(de),ce=o(747037),ue=o.n(ce),me=o(594239);const ge=e=>{let{cropDataSetVisible:t=!1,cropDataSetEnabled:o=!1,donwloadFilteredVisible:a=!1,downloadFilteredEnabled:r=!1,advancedOptionsVisible:l=!1,compressionOptions:n=["CCITT RLE","LZW","JPEG","ZLib","PackBits","Deflate"],selectedCompression:s,tileWidth:i,tileHeight:d,quality:p,onChange:c=(()=>{})}=e;const[u,m]=V().useState(!1);return V().createElement(V().Fragment,null,t&&V().createElement("div",{className:"mapstore-downloadwpsoptions-menuitem"},V().createElement(me.Z,{checked:o,onClick:e=>c("cropDataSet",e)}),V().createElement(re.Z,{msgId:"layerdownload.cropDataSet"})),a&&V().createElement("div",{className:"mapstore-downloadwpsoptions-menuitem"},V().createElement(me.Z,{checked:r,onClick:e=>c("downloadFilteredDataSet",e)}),V().createElement(re.Z,{msgId:"layerdownload.downloadFilteredDataSet"})),l&&V().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-options"},V().createElement(J.Button,{className:"no-border",onClick:()=>m(!u)},V().createElement(J.Glyphicon,{glyph:"chevron-"+(u?"down":"right")})),V().createElement(re.Z,{msgId:"layerdownload.advancedOptions"})),u&&l&&V().createElement("div",{className:"mapstore-downloadwpsoptions-advanced"},V().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},V().createElement(re.Z,{msgId:"layerdownload.compression"}),V().createElement(ne.ZP,{clearable:!0,value:s,options:n.map((e=>ue()(e)?{value:e,label:e}:e)),onChange:e=>c("compression",null==e?void 0:e.value)})),V().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},V().createElement(re.Z,{msgId:"layerdownload.quality"}),V().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem-control"},V().createElement(J.FormControl,{placeholder:"0.75",type:"number",min:"0",max:"1",value:p||"",onChange:e=>c("quality",e.target.value)}))),V().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},V().createElement(re.Z,{msgId:"layerdownload.tileWidth"}),V().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem-control"},V().createElement(J.FormControl,{placeholder:"256",type:"number",min:"0",value:i||"",onChange:e=>c("tileWidth",e.target.value&&e.target.value.length>0?`${parseInt(e.target.value,10)}`:"")}),V().createElement("span",null,"px"))),V().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},V().createElement(re.Z,{msgId:"layerdownload.tileHeight"}),V().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem-control"},V().createElement(J.FormControl,{placeholder:"256",type:"number",min:"0",value:d||"",onChange:e=>c("tileHeight",e.target.value&&e.target.value.length>0?`${parseInt(e.target.value,10)}`:"")}),V().createElement("span",null,"px")))))};function ye(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class we extends V().Component{constructor(){super(...arguments),ye(this,"getSelectedFormat",(()=>ie()(this.props,"downloadOptions.selectedFormat"))),ye(this,"getSelectedSRS",(()=>ie()(this.props,"downloadOptions.selectedSrs")||this.props.defaultSrs||ie()(pe()(this.props.srsList),"name")))}render(){var e;return V().createElement("form",null,V().createElement("label",null,V().createElement(re.Z,{msgId:"layerdownload.format"})),V().createElement(ne.ZP,{clearable:!1,isLoading:this.props.formatsLoading,onOpen:()=>this.props.formatOptionsFetch(this.props.layer),value:null===(e=this.props.downloadOptions)||void 0===e?void 0:e.selectedFormat,noResultsText:V().createElement(re.Z,{msgId:"layerdownload.format"}),onChange:e=>this.props.onChange("selectedFormat",e.value),options:this.props.formats.map((e=>({value:e.name,label:e.label||e.name})))}),V().createElement("label",null,V().createElement(re.Z,{msgId:"layerdownload.srs"})),V().createElement(ne.ZP,{clearable:!1,value:this.getSelectedSRS(),onChange:e=>this.props.onChange("selectedSrs",e.value),options:this.props.srsList.map((e=>({value:e.name,label:e.label||e.name})))}),this.props.wpsOptionsVisible&&V().createElement(ge,{cropDataSetVisible:!0,donwloadFilteredVisible:this.props.downloadFilteredVisible,advancedOptionsVisible:this.props.wpsAdvancedOptionsVisible,cropDataSetEnabled:this.props.downloadOptions.cropDataSet,downloadFilteredEnabled:this.props.downloadOptions.downloadFilteredDataSet,selectedCompression:this.props.downloadOptions.compression,quality:this.props.downloadOptions.quality,tileWidth:this.props.downloadOptions.tileWidth,tileHeight:this.props.downloadOptions.tileHeight,onChange:this.props.onChange}),this.props.virtualScroll?null:V().createElement(J.Checkbox,{checked:this.props.downloadOptions.singlePage,onChange:()=>this.props.onChange("singlePage",!this.props.downloadOptions.singlePage)},V().createElement(re.Z,{msgId:"layerdownload.downloadonlycurrentpage"})))}}ye(we,"propTypes",{downloadOptions:H().object,formatOptionsFetch:H().func,formats:H().array,srsList:H().array,onChange:H().func,defaultSrs:H().string,wpsOptionsVisible:H().bool,wpsAdvancedOptionsVisible:H().bool,downloadFilteredVisible:H().bool,layer:H().object,formatsLoading:H().bool,virtualScroll:H().bool}),ye(we,"defaultProps",{downloadOptions:{},formatsLoading:!1,formats:[],srsList:[],wpsOptionsVisible:!1,wpsAdvancedOptionsVisible:!1,downloadFilteredVisible:!1,virtualScroll:!0});const ve=we;var he=o(23888),be=o(112008);function fe(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class Ee extends V().Component{constructor(){super(...arguments),fe(this,"onClose",(()=>{this.props.onClose()})),fe(this,"renderIcon",(()=>this.props.loading?V().createElement("div",{style:{float:"left"}},V().createElement(ee(),{spinnerName:"circle",noFadeIn:!0})):V().createElement(J.Glyphicon,{glyph:"download"}))),fe(this,"handleExport",(()=>{const{url:e,filterObj:t,downloadOptions:o,defaultSrs:a,srsList:r,onExport:l,layer:n,attributes:s,customAttributeSettings:i}=this.props,d=o&&o.selectedSrs||a||(r[0]||{}).name,p=(0,be.Pf)(s,i);l(e||n.url,t,K()({},o,{selectedSrs:d},{propertyName:p}))}))}componentDidUpdate(e){this.props.enabled!==e.enabled&&this.props.enabled&&(this.props.onClearDownloadOptions(),"wms"===this.props.layer.type&&this.props.onCheckWPSAvailability(this.props.url||this.props.layer.url))}render(){var e,t,o;const a=e=>this.props.formats.filter((t=>{var o,a;let{validServices:r,type:l="vector"}=t;return(!r||z()(r,(t=>t===e))>-1)&&("vector"===l&&(null===(o=this.props.layer.search)||void 0===o?void 0:o.url)||"raster"===l&&!(null!==(a=this.props.layer.search)&&void 0!==a&&a.url))})),r=a("wfs"),l=a("wps"),n=r.length>0?r.filter((e=>this.props.wfsFormats.find((t=>t.name.toLowerCase()===e.name.toLowerCase())))):this.props.wfsFormats;return this.props.enabled?V().createElement(ae.Z,null,V().createElement(oe.Z,{id:"mapstore-export",draggable:!1,modal:!0},V().createElement("span",{role:"header"},V().createElement("span",{className:"about-panel-title"},V().createElement(re.Z,{msgId:"layerdownload.title"})),V().createElement("button",{onClick:this.onClose,className:"settings-panel-close close"},this.props.closeGlyph?V().createElement(J.Glyphicon,{glyph:this.props.closeGlyph}):V().createElement("span",null,"×"))),V().createElement("div",{role:"body"},this.props.checkingWPSAvailability?V().createElement(te.Z,{size:100,style:{margin:"0 auto"}}):"wfs"!==this.props.service||null!==(e=this.props.layer.search)&&void 0!==e&&e.url?V().createElement(ve,{downloadOptions:this.props.downloadOptions,onChange:this.props.onDownloadOptionChange,formatOptionsFetch:"wfs"===this.props.service?this.props.onFormatOptionsFetch:()=>{},formatsLoading:this.props.formatsLoading,formats:"wfs"===this.props.service?n:l,srsList:this.props.srsList,defaultSrs:this.props.defaultSrs,wpsOptionsVisible:"wps"===this.props.service,wpsAdvancedOptionsVisible:!(null!==(t=this.props.layer.search)&&void 0!==t&&t.url),downloadFilteredVisible:!(null===(o=this.props.layer.search)||void 0===o||!o.url),layer:this.props.layer,virtualScroll:this.props.virtualScroll,customAttributesSettings:this.props.customAttributeSettings,attributes:this.props.attributes}):V().createElement(le.Z,{title:V().createElement(re.Z,{msgId:"layerdownload.noSupportedServiceFound"})})),!this.props.checkingWPSAvailability&&V().createElement("div",{role:"footer"},V().createElement(he.Z,{bsStyle:"primary",className:"download-button",disabled:!this.props.downloadOptions.selectedFormat||this.props.loading,onClick:this.handleExport},this.renderIcon()," ",V().createElement(re.Z,{msgId:"layerdownload.export"}))))):null}}fe(Ee,"propTypes",{filterObj:H().object,closeGlyph:H().string,url:H().string,service:H().string,enabled:H().bool,loading:H().bool,checkingWPSAvailability:H().bool,onClose:H().func,onExport:H().func,onCheckWPSAvailability:H().func,onDownloadOptionChange:H().func,onClearDownloadOptions:H().func,onFormatOptionsFetch:H().func,downloadOptions:H().object,wfsFormats:H().array,formats:H().array,srsList:H().array,defaultSrs:H().string,layer:H().object,formatsLoading:H().bool,virtualScroll:H().bool,customAttributeSettings:H().object,attributes:H().array}),fe(Ee,"defaultProps",{onExport:()=>{},onClose:()=>{},onCheckWPSAvailability:()=>{},onDownloadOptionChange:()=>{},onClearDownloadOptions:()=>{},onFormatOptionsFetch:()=>{},checkingWPSAvailability:!1,layer:{},closeGlyph:"1-close",service:"wfs",wfsFormats:[],formats:[{name:"application/json",label:"GeoJSON",type:"vector",validServices:["wps"]},{name:"application/arcgrid",label:"ArcGrid",type:"raster",validServices:["wps"]},{name:"image/tiff",label:"TIFF",type:"raster",validServices:["wps"]},{name:"image/png",label:"PNG",type:"raster",validServices:["wps"]},{name:"image/jpeg",label:"JPEG",type:"raster",validServices:["wps"]},{name:"application/wfs-collection-1.0",label:"wfs-collection-1.0",type:"vector",validServices:["wps"]},{name:"application/wfs-collection-1.1",label:"wfs-collection-1.1",type:"vector",validServices:["wps"]},{name:"application/zip",label:"Shapefile",type:"vector",validServices:["wps"]},{name:"text/csv",label:"CSV",type:"vector",validServices:["wps"]}],formatsLoading:!1,srsList:[{name:"native",label:"Native"},{name:"EPSG:4326",label:"WGS84"}],virtualScroll:!0,downloadOptions:{}});const Oe=Ee;var Se=o(141919),De=o(401811),Re=o(399790);const Ae=V().createElement(J.Button,{bsStyle:"primary",bsSize:"small",className:"mapstore-exportdataresults-item-failed"},V().createElement(J.Glyphicon,{glyph:"exclamation-sign"})),Ne=(0,Se.Z)((e=>{let{results:t=[]}=e;return!t.length}),{title:V().createElement(re.Z,{msgId:"exportDataResults.emptyStateMessage"})})((e=>{let{loading:t=!1,results:o=[],currentLocale:a,onRemoveResult:r=(()=>{})}=e;return t?V().createElement(te.Z,{size:100,style:{margin:"0 auto",padding:"10px"}}):V().createElement("div",{className:"mapstore-exportdataresults-container"},o.map((e=>{let{id:t,layerName:o,layerTitle:l,startTime:n,status:s,result:i}=e;const d=(0,Re.in)({name:o,title:l},a),p=new Date(n),c=e=>e<10?`0${e}`:`${e}`,u=`${c(p.getDate())}/${c(p.getMonth()+1)}/${p.getFullYear()} ${c(p.getHours())}:${c(p.getMinutes())}`;return V().createElement("div",{key:t,className:"mapstore-exportdataresults-item"},V().createElement("div",{className:"mapstore-exportdataresults-item-name"},d),V().createElement("div",{className:"mapstore-exportdataresults-item-date"},u),V().createElement("div",{className:"mapstore-exportdataresults-item-buttons"},"pending"===s&&V().createElement(te.Z,{size:22,style:{marginLeft:"2px"}}),"failed"===s&&i&&i.msgId?V().createElement(De.Z,{placement:"top",overlay:V().createElement(J.Tooltip,{id:"exportresults-failure-tooltip"},V().createElement(re.Z,{msgId:i.msgId,msgParams:i.msgParams}))},Ae):null,"failed"!==s||i&&i.msgId?null:Ae,"completed"===s&&V().createElement("a",{href:i,target:"_blank",rel:"noopener noreferrer"},V().createElement(J.Button,{bsStyle:"primary",bsSize:"small"},V().createElement(J.Glyphicon,{glyph:"floppy-disk"}))),V().createElement(J.Button,{bsStyle:"primary",bsSize:"small",onClick:()=>r(t)},V().createElement(J.Glyphicon,{glyph:"trash"}))))})))}));var Ce=o(294184),xe=o.n(Ce);const Pe=e=>{let{show:t,arrowDirection:o="bottom",className:a,containerClassName:r,children:l}=e;return V().createElement("div",{className:xe()("mapstore-info-bubble",...t?["mapstore-info-bubble-visible"]:[],a)},V().createElement("div",{className:xe()("mapstore-info-bubble-container",r)},V().createElement("div",{className:xe()("mapstore-info-bubble-arrow-container",`arrow-${o}`)},V().createElement("div",{className:"mapstore-info-bubble-arrow"})),V().createElement("div",{className:"mapstore-info-bubble-inner"},l)))},Te=e=>{let{msgId:t,msgParams:o,level:a="normal",className:r}=e;return V().createElement("div",{className:xe()("mapstore-info-bubble-default-inner",`mapstore-info-bubble-default-inner-level-${a}`,r)},t?V().createElement(re.Z,{msgId:t,msgParams:o}):null)};var Fe=o(994345),Le=o(712845);const Ie=(0,Fe.Z)(Le.Z);var ke=o(49977),Ge=o.n(ke),We=o(313311),Me=o.n(We),Ze=o(478718),_e=o.n(Ze),Be=o(493220),qe=o.n(Be),je=o(984596),Xe=o.n(je),Ve=o(178598),Ue=o(505055),He=o(507526),Ye=o(423570),ze=o.n(Ye),$e=o(275982),Ke=o(333101),Je=o(612132),Qe=o(504518),et=o(412961),tt=o(926854),ot=o(119008),at=o(274363),rt=o(510644),lt=o(141520),nt=o(81674),st=o(3674),it=o.n(st),dt=o(957557),pt=o.n(dt),ct=o(474810),ut=o(735075);const mt=e=>{let{type:t,data:o}=e;return"TEXT"===t?(0,ct.XA)((0,ct.p5)((0,ct.Rr)(o.data),o.mimeType)):(0,ct.fA)(o.mimeType,o.href,o.method,(0,ct.Rr)(o.requestBodyData))},gt=e=>{let{layerName:t,ROI:o,roiCRS:a,dataFilter:r,targetCRS:l}=e;return(0,ut.Uh)("gs:DownloadEstimator",[(0,ct.qP)("layerName",(0,ct.XA)((0,ct.gN)(t))),...o?[(0,ct.qP)("ROI",mt(o))]:[],...a?[(0,ct.qP)("RoiCRS",(0,ct.XA)((0,ct.gN)(a)))]:[],...r?[(0,ct.qP)("filter",mt(r))]:[],...l?[(0,ct.qP)("targetCRS",(0,ct.XA)((0,ct.gN)(l)))]:[]])},yt=e=>{let{layerName:t,dataFilter:o,outputFormat:a,targetCRS:r,roiCRS:l,ROI:n,cropToROI:s,asynchronous:i,outputAsReference:d,resultOutput:p,writeParameters:c}=e;return(0,ut.Uh)("gs:Download",[(0,ct.qP)("layerName",(0,ct.XA)((0,ct.gN)(t))),(0,ct.qP)("outputFormat",(0,ct.XA)((0,ct.gN)(a))),...n?[(0,ct.qP)("ROI",mt(n))]:[],...o?[(0,ct.qP)("filter",mt(o))]:[],...r?[(0,ct.qP)("targetCRS",(0,ct.XA)((0,ct.gN)(r)))]:[],...l?[(0,ct.qP)("RoiCRS",(0,ct.XA)((0,ct.gN)(l)))]:[],(0,ct.qP)("cropToROI",(0,ct.XA)((0,ct.gN)(s?"true":"false"))),...c&&it()(c).length>0?[(0,ct.XJ)(qe()(c).map((e=>{let[t,o]=e;return(0,ct.Dx)(t,o)})).join(""))]:[]],(0,ct.DK)(i?(0,ct.Tr)(!0,!0,d?(0,ct.t$)(p,!0,"result"):(0,ct.En)("result",p)):(0,ct.En)("result",p)))},wt=(e,t,o)=>{if(e&&t){const a=(0,ut.mG)(e,gt({layerName:t.layerName,ROI:t.ROI,roiCRS:t.roiCRS,dataFilter:t.dataFilter,targetCRS:t.targetCRS}),{outputsExtractor:(0,ut.dr)(ut.ai)}),r=t.resultOutput||t.outputFormat||"application/zip",l=(0,ut.mG)(e,yt({...pt()(t,"notifyDownloadEstimatorSuccess","attribute"),outputAsReference:!!t.asynchronous&&t.outputAsReference,resultOutput:r}),o,{headers:{"Content-Type":"application/xml",Accept:`application/xml, ${r}`}});return a.catch((()=>{throw new Error("DownloadEstimatorException")})).mergeMap((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length>0&&"result"===e[0].identifier&&"true"===e[0].data)return t.notifyDownloadEstimatorSuccess?ke.Observable.of("DownloadEstimatorSuccess").concat(l):l;throw new Error("DownloadEstimatorFailed")}))}return ke.Observable.empty()},vt=(e,t,o)=>{if(e&&t){const a=(0,ut.mG)(e,gt({layerName:t.layerName,ROI:t.ROI,roiCRS:t.roiCRS,dataFilter:t.dataFilter,targetCRS:t.targetCRS}),{outputsExtractor:(0,ut.dr)(ut.ai)}),r=t.resultOutput||t.outputFormat||"application/zip",l=(0,ut.mG)(e,yt({...pt()(t,"notifyDownloadEstimatorSuccess","attribute","asynchronous","outputFormat"),asynchronous:!0,outputAsReference:!0,resultOutput:"application/wfs-collection-1.0",outputFormat:"application/wfs-collection-1.0"}),o,{headers:{"Content-Type":"application/xml",Accept:"application/xml, application/wfs-collection-1.0"}});return a.catch((()=>{throw new Error("DownloadEstimatorException")})).mergeMap((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length>0&&"result"===e[0].identifier&&"true"===e[0].data)return t.notifyDownloadEstimatorSuccess?ke.Observable.of("DownloadEstimatorSuccess").concat(l):l;throw new Error("DownloadEstimatorFailed")})).mergeMap((a=>{if("DownloadEstimatorSuccess"===a)return ke.Observable.of("DownloadEstimatorSuccess");if(a&&1===(null==a?void 0:a.length))return(0,ut.mG)(e,(e=>{let{input:t,attribute:o,filter:a,asynchronous:r,outputAsReference:l,resultOutput:n}=e;return(0,ut.Uh)("vec:Query",[(0,ct.qP)("features",(0,ct.fA)(t.mimeType,t.href.replace(/&/g,"&amp;"),"GET")),...o?o.map((e=>(0,ct.qP)("attribute",(0,ct.XA)((0,ct.gN)(e))))):[],...a?[(0,ct.qP)("filter",mt(a))]:[]],(0,ct.DK)(r?(0,ct.Tr)(!0,!0,l?(0,ct.t$)(n,!0,"result"):(0,ct.En)("result",n)):(0,ct.En)("result",n)))})({...pt()(t,"notifyDownloadEstimatorSuccess"),input:a[0],filter:null,outputAsReference:!!t.asynchronous&&t.outputAsReference,resultOutput:r}),o,{headers:{"Content-Type":"application/xml",Accept:`application/xml, ${r}`}});throw new Error("DownloadFailed")}))}return ke.Observable.empty()};var ht=o(191332),bt=o(475897),ft=o(351546),Et=o(510810),Ot=o(388826),St=o.n(Ot),Dt=o(988594);const Rt={gml3:"GML3.1",GML2:"GML2","DXF-ZIP":"DXF-ZIP","application/vnd.google-earth.kml+xml":"KML","OGR-CSV":"OGR-CSV","OGR-FileGDB":"OGR-GeoDatabase","OGR-GPKG":"OGR-GeoPackage","OGR-KML":"OGR-KML","OGR-MIF":"OGR-MIF","OGR-TAB":"OGR-TAB","SHAPE-ZIP":"Shapefile",gml32:"GML3.2","application/json":"GeoJSON",csv:"CSV","application/x-gpkg":"GeoPackage",excel:"excel",excel2007:"excel2007"},{getFeature:At,query:Nt,sortBy:Ct,propertyName:xt}=St()({wfsVersion:"1.1.0"}),Pt=function(){let{url:e,filterObj:t={},layerFilter:o,downloadOptions:a={},options:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sortOptions:l,propertyNames:n}=r,s=(0,ht.mergeFiltersToOGC)({ogcVersion:"1.1.0",addXmlnsToRoot:!0,xmlnsToAdd:['xmlns:ogc="http://www.opengis.net/ogc"','xmlns:gml="http://www.opengis.net/gml"']},o,t);return(0,lt.V6)(e,At(Nt(t.featureTypeName,[...l?[Ct(l.sortBy,l.sortOrder)]:[],...n?[xt(n)]:[],...s?Xe()(s):[]],{srsName:a.selectedSrs})),r,a.selectedFormat)},Tt=e=>{const t=ie()(e,"filterObj.featureTypeName"),o=(0,bt.y7)(ie()(e,"downloadOptions.selectedFormat"));return o&&o.extension?t+"."+o.extension:t},Ft=e=>e.query&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes&&e.query.featureTypes[e.query.typeName].attributes[0]&&e.query.featureTypes[e.query.typeName].attributes[0].attribute||null,Lt=e=>{switch(e.code){case"ProcessFailed":return{msgId:"layerdownload.wpsExecuteError.processFailed",msgParams:{exceptionReport:e.message}};case"NoStatusLocation":case"NoExecutionId":case"UnexpectedProcessStatus":return{msgId:"layerdownload.wpsExecuteError.badResponse",msgParams:{eCode:e.code}};case"ExecuteProcessXHRFailed":return{msgId:"layerdownload.wpsExecuteError.executeProcessXhrFailed"};case"GetExecutionStatusXHRFailed":return{msgId:"layerdonwload.wpsExecuteError.getExecutionStatusXhrFailed"};default:return{msgId:"layerdownload.wpsExecuteError.unexpectedError"}}},It=e=>{const t=(0,rt.np)(e);if(null!=t&&t.id){const e=document.cookie.split(";").filter((e=>e.indexOf(`exportDataResults_${t.id}=`)>-1))[0];if(e){const{results:t}=JSON.parse(decodeURIComponent(e.split("=")[1]));return Ge().Observable.of(P(t.filter((e=>{let{status:t}=e;return"pending"!==t}))))}}return Ge().Observable.empty()},kt=e=>e.ofType(n).switchMap((e=>{let{url:t}=e;return(0,nt.l)(t,"gs:DownloadEstimator,gs:Download").switchMap((e=>Ge().Observable.defer((()=>new Promise(((t,o)=>(0,Ue.parseString)(e.data,{tagNameProcessors:[He.stripPrefix]},((e,a)=>e?o(e):t(a))))))))).flatMap((e=>{var t,o,a,r,l,n,s,i;const d=[null==e||null===(t=e.ProcessDescriptions)||void 0===t||null===(o=t.ProcessDescription)||void 0===o||null===(a=o[0])||void 0===a||null===(r=a.Identifier)||void 0===r?void 0:r[0],null==e||null===(l=e.ProcessDescriptions)||void 0===l||null===(n=l.ProcessDescription)||void 0===n||null===(s=n[1])||void 0===s||null===(i=s.Identifier)||void 0===i?void 0:i[0]];return Ge().Observable.of(x(z()(d,(e=>"gs:DownloadEstimator"===e))>-1&&z()(d,(e=>"gs:Download"===e))>-1?"wps":"wfs"),A(!1))})).catch((()=>Ge().Observable.of(x("wfs"),A(!1)))).startWith(A(!0))})),Gt=e=>e.ofType(Ke.HN).switchMap((e=>{var t;return Ge().Observable.from([(0,G.Xi)("layerdownload"),N("singlePage",!1),...null!==(t=e.layer.search)&&void 0!==t&&t.url?[(0,Je.rP)(e.layer.url,{featureTypeName:e.layer.name})]:[]])})),Wt=e=>e.ofType(u).switchMap((e=>(0,lt.ED)(e).map((e=>{return t=(e=>{const t=ie()(e,"WFS_Capabilities.OperationsMetadata.Operation"),o=Me()(t,(function(e){return"GetFeature"===e.name})),a=ie()(o,"Parameter"),r=Me()(a,(function(e){return"outputFormat"===e.name})).Value,l=_e()(Rt,r);return qe()(l).map((e=>{let[t,o]=e;return{name:t,label:o}}))})(e),{type:m,wfsFormats:t};var t})))),Mt=(e,t)=>e.ofType(i).switchMap((o=>{const a=t.getState(),{virtualScroll:r=!1}=a.featuregrid||{},l=_(a),n=(0,M.Iz)(a),s=(0,at.pQ)(a),i=(0,j.Pz)(a),d=o.downloadOptions.propertyName?[(0,Dt.dm)((0,Z.qj)(a,n.name)),...o.downloadOptions.propertyName]:null,{layerFilter:p}=n;return"wps"===l?(()=>{var t;const a=!(null===(t=n.search)||void 0===t||!t.url),r=o.downloadOptions.cropDataSet&&!!s&&!!s.bounds,l={layerName:n.name,outputFormat:o.downloadOptions.selectedFormat,asynchronous:!0,outputAsReference:!0,targetCRS:o.downloadOptions.selectedSrs&&"native"!==o.downloadOptions.selectedSrs?o.downloadOptions.selectedSrs:void 0,cropToROI:r,dataFilter:o.downloadOptions.downloadFilteredDataSet?{type:"TEXT",data:{mimeType:"text/xml; subtype=filter/1.1",data:(0,ht.mergeFiltersToOGC)({ogcVersion:"1.1.0",addXmlnsToRoot:!0,xmlnsToAdd:['xmlns:ogc="http://www.opengis.net/ogc"','xmlns:gml="http://www.opengis.net/gml"']},n.layerFilter,o.filterObj)}}:void 0,ROI:r?{type:"TEXT",data:{mimeType:"application/json",data:JSON.stringify((0,ft.bboxToFeatureGeometry)(s.bounds))}}:void 0,roiCRS:r?s.crs||"EPSG:4326":void 0,writeParameters:{...o.downloadOptions.tileWidth?{tilewidth:o.downloadOptions.tileWidth}:{},...o.downloadOptions.tileHeight?{tileheight:o.downloadOptions.tileHeight}:{},...o.downloadOptions.compression?{compression:o.downloadOptions.compression,...o.downloadOptions.quality?{quality:o.downloadOptions.quality}:{}}:{}},notifyDownloadEstimatorSuccess:!0,attribute:d},p={id:ze()(),layerName:n.name,layerTitle:n.title,status:"pending"},c={outputsExtractor:(0,ut.dr)(ut.RW)};return(a&&d?vt:wt)(o.url,l,c).takeUntil(e.ofType(h).filter((e=>{let{id:t}=e;return t===p.id})).take(1)).flatMap((e=>{return"DownloadEstimatorSuccess"===e?Ge().Observable.of((t={...p,startTime:(new Date).getTime()},{type:w,result:t}),L("layerdownload.exportResultsMessages.newExport"),C(),(0,G.Xi)("layerdownload","enabled")):Ge().Observable.of(...e&&e.length>0&&e[0].href?[T(p.id,{status:"completed",result:e[0].href}),L("layerdownload.exportResultsMessages.exportSuccess",{layerTitle:(0,Re.in)(n,i)},"success")]:[T(p.id,{status:"failed",result:{msgId:"layerdonwload.exportResultsMessages.invalidHref"}}),L("layerdownload.exportResultsMessages.exportFailure",{layerTitle:(0,Re.in)(n,i)},"danger")]);var t})).catch((e=>Ge().Observable.of(...e.message&&e.message.indexOf("DownloadEstimator")>-1?[(0,Qe.vU)({error:e,title:"layerdownload.error.downloadEstimatorTitle",message:"layerdownload.error.downloadEstimatorFailed"}),C()]:[T(p.id,{status:"failed",result:Lt(e)}),L("layerdownload.exportResultsMessages.exportFailure",{layerTitle:(0,Re.in)(n,i)},"danger")])))})():Pt({url:o.url,downloadOptions:o.downloadOptions,filterObj:o.filterObj,layerFilter:p,options:{pagination:!r&&ie()(o,"downloadOptions.singlePage")?o.filterObj&&o.filterObj.pagination:null,propertyNames:d}}).do((e=>{let{data:t,headers:o}=e;if("application/xml"===o["content-type"]){let e=String.fromCharCode.apply(null,new Uint8Array(t));if(0===e.indexOf("<ows:ExceptionReport"))throw e}})).catch((()=>{return Pt({url:o.url,downloadOptions:o.downloadOptions,filterObj:o.filterObj,layerFilter:p,options:{pagination:!r&&ie()(o,"downloadOptions.singlePage")?o.filterObj&&o.filterObj.pagination:null,sortOptions:(e=Ft(t.getState()),e?{sortBy:e,sortOrder:"A"}:{}),propertyNames:o.downloadOptions.propertyName?[...o.downloadOptions.propertyName,(0,Dt.dm)((0,Z.qj)(a,n.name))]:null}}).do((e=>{let{data:t,headers:a}=e;if("application/xml"===a["content-type"]){let e=String.fromCharCode.apply(null,new Uint8Array(t));if(0===e.indexOf("<ows:ExceptionReport"))throw e}(0,Ve.saveAs)(new Blob([t],{type:a&&a["content-type"]}),Tt(o))}));var e})).do((e=>{let{data:t,headers:a}=e;(0,Ve.saveAs)(new Blob([t],{type:a&&a["content-type"]}),Tt(o))})).map((()=>C())).catch((e=>Ge().Observable.of((0,Qe.vU)({error:e,title:"layerdownload.error.title",message:"layerdownload.error.invalidOutputFormat",autoDismiss:5,position:"tr"}),C())))})),Zt=(e,t)=>e.ofType(G.kM).filter((e=>"queryPanel"===e.control&&!(0,ot._d)(t.getState())&&(0,ot.lI)(t.getState()))).switchMap((()=>Ge().Observable.of((0,G.Xi)("layerdownload")))),_t=e=>e.ofType(S).concatMap((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ge().Observable.of(k(e.msgId,e.msgParams,e.level),I(!0)).delay(10).concat(Ge().Observable.of(I(!1)).delay(e.duration||3e3)).concat(Ge().Observable.empty().delay(1e3))})),Bt=(e,t)=>e.ofType(f).exhaustMap((()=>{const e=t.getState(),o=(q(e)||[]).filter((e=>{let{status:t}=e;return"completed"===t}));return o.length>0?Ge().Observable.forkJoin(o.map((e=>{const{result:t}=e,o=t.indexOf("executionId="),a=t.slice(o),r=a.indexOf("&"),l=(r>-1?a.slice(0,r):a).slice(12),n=t.indexOf("?"),s=t.slice(0,n);return(0,ut.W5)(s,l).let(Et.oB).catch((()=>Ge().Observable.of(null))).map((t=>t?null:e.id))}))).flatMap((e=>{return Ge().Observable.of((t=e.filter((e=>!!e)),{type:b,ids:t}),{type:O},F(!1));var t})).startWith(F(!0)):Ge().Observable.empty()})),qt=(e,t)=>e.ofType(w,h,v,O).filter((()=>(0,rt.jl)(t.getState()))).do((()=>{const e=t.getState(),o=q(e),{id:a}=(0,rt.np)(e),r=JSON.stringify({results:o});document.cookie=`exportDataResults_${a}=${encodeURIComponent(r)}`})).flatMap((()=>Ge().Observable.empty())),jt=e=>e.ofType(tt.ok).switchMap((()=>e.ofType(et.Nv).switchMap((()=>Ge().Observable.of(P([])))).takeUntil(e.ofType($e.nk)))),Xt=(e,t)=>e.ofType(tt.ok).switchMap((()=>It(t.getState()).concat(e.ofType(et.XP).switchMap((()=>It(t.getState()))).takeUntil(e.ofType($e.nk))))),Vt=(0,o(152543).rx)("LayerDownload",{component:(0,r.connect)((0,l.zB)({url:Z.Bu,filterObj:B,enabled:e=>{var t,o;return null==e||null===(t=e.controls)||void 0===t||null===(o=t.layerdownload)||void 0===o?void 0:o.enabled},downloadOptions:e=>{var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.downloadOptions},loading:e=>{var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.loading},wfsFormats:e=>{var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.wfsFormats},formatsLoading:e=>{var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.formatsLoading},layer:M.Iz,service:_,checkingWPSAvailability:e=>{var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.checkingWPSAvailability},virtualScroll:e=>e&&e.featuregrid&&e.featuregrid.virtualScroll,customAttributeSettings:W.Xh,attributes:Z.L}),{onExport:(e,t,o)=>({type:i,url:e,filterObj:t,downloadOptions:o}),onDownloadOptionChange:N,onClearDownloadOptions:()=>({type:c}),onFormatOptionsFetch:e=>({type:u,layer:e}),onCheckWPSAvailability:e=>({type:n,url:e}),onClose:()=>(0,G.Xi)("layerdownload")})(Oe),containers:{TOC:{doNotHide:!0,name:"LayerDownload"},FeatureEditor:{doNotHide:!0,name:"LayerDownload",position:20,target:"toolbar",Component:(0,r.connect)((0,l.zB)({isDownloadOpen:e=>{var t,o;return null==e||null===(t=e.controls)||void 0===t||null===(o=t.layerdownload)||void 0===o?void 0:o.enabled}}),{onClick:()=>(0,G.Xi)("layerdownload")})((e=>{let{disabled:t,results:o=[],mode:a,isDownloadOpen:r,onClick:l=(()=>{})}=e;return V().createElement(Ie,{id:"download-grid",keyProp:"download-grid",tooltipId:"featuregrid.toolbar.downloadGridData",disabled:t||0===o.length,active:r,visible:"VIEW"===a,onClick:l,glyph:"download"})}))},MapFooter:{doNotHide:!0,name:"LayerDownload",position:1,tool:(0,r.connect)((0,l.zB)({active:e=>{var t,o;return null==e||null===(t=e.controls)||void 0===t||null===(o=t.exportDataResults)||void 0===o?void 0:o.enabled},showInfoBubble:e=>{var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.showInfoBubble},infoBubbleMessage:e=>{var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.infoBubbleMessage},checkingExportDataEntries:e=>{var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.checkingExportDataEntries},results:q,currentLocale:j.Pz}),{onToggle:G.Xi.bind(null,"exportDataResults","enabled"),onActive:()=>({type:f}),onRemoveResult:e=>({type:h,id:e})})((e=>{let{active:t=!1,showInfoBubble:o=!1,infoBubbleMessage:a={},checkingExportDataEntries:r,results:l=[],currentLocale:n,onToggle:s=(()=>{}),onActive:i=(()=>{}),onRemoveResult:d}=e;return V().useEffect((()=>{t&&i()}),[t]),V().createElement(V().Fragment,null,l.length>0?V().createElement("div",{id:"mapstore-export-data-results-button-container"},V().createElement(De.Z,{placement:"left",overlay:V().createElement(J.Tooltip,{id:"mapstore-export-data-results-tooltip"},V().createElement(re.Z,{msgId:"exportDataResults.title"}))},V().createElement(J.Button,{bsStyle:"primary",bsSize:"small",onClick:()=>s()},V().createElement(J.Glyphicon,{glyph:"download"}))),V().createElement(Pe,{show:o,className:"mapstore-export"},V().createElement(Te,a))):null,V().createElement("div",null,t&&V().createElement(ae.Z,null,V().createElement(oe.Z,{id:"mapstore-export-data-results",draggable:!1,modal:!0},V().createElement("span",{role:"header"},V().createElement("span",{className:"about-panel-title"},V().createElement(re.Z,{msgId:"exportDataResults.title"})),V().createElement("button",{onClick:()=>s(),className:"settings-panel-close close"},V().createElement(J.Glyphicon,{glyph:"1-close"}))),V().createElement("div",{role:"body"},V().createElement(Ne,{loading:r,results:l,currentLocale:n,onRemoveResult:d}))))))}))}},epics:a,reducers:{layerdownload:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{downloadOptions:{singlePage:!0}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i:return{...e,loading:!0};case p:return{...e,downloadOptions:{...e.downloadOptions,[t.key]:t.value}};case c:return{...e,downloadOptions:{singlePage:!0}};case u:return{...e,layer:t.layer,wfsFormats:[],formatsLoading:!0};case d:return{...e,loading:!1};case m:return{...e,wfsFormats:t.wfsFormats,formatsLoading:!1};case g:return{...e,service:t.service};case s:return{...e,checkingWPSAvailability:t.checking};case y:return{...e,results:t.results};case w:return{...e,results:[...e.results||[],t.result]};case v:{const o=z()(e.results||[],{id:t.id});return{...e,results:o>-1?[...e.results.slice(0,o),{...e.results[o],...t.newProps||{}},...e.results.slice(o+1)]:e.results}}case h:return{...e,results:(e.results||[]).filter((e=>e.id!==t.id))};case b:return{...e,results:(e.results||[]).filter((e=>-1===z()(t.ids,(t=>t===e.id))))};case D:return{...e,showInfoBubble:t.show};case R:return{...e,infoBubbleMessage:{msgId:t.msgId,msgParams:t.msgParams,level:t.level}};case E:return{...e,checkingExportDataEntries:t.checking};default:return e}}}})}}]);