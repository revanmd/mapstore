(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[9373],{452412:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>le});var l={};r.r(l),r.d(l,{layerInfoSetupLayersEpic:()=>te,layerInfoSyncLayersEpic:()=>re});var a=r(124852),n=r.n(a),s=r(171703),o=r(22222),i=r(630294),c=r(500711),d=r.n(c),y=r(23888),u=r(63101),m=r(89518),p=r(804504),v=r(401811),g=r(399790);const f=e=>{let{loading:t=!1,loadFlags:r={},error:l,layers:a=[],currentLocale:s="default",onSelectLayers:o=(()=>{})}=e;const c=a.map((e=>{let{id:t}=e;return t})),f=a.filter((e=>{let{selected:t}=e;return t})).map((e=>{let{id:t}=e;return t})),E=a.map((e=>{let{title:t,name:r,type:l,selected:a,id:c,syncStatus:d}=e;return{title:(0,g.in)({title:t,name:r},s),description:n().createElement(p.Z,{msgId:"layerInfo.layerType",msgParams:{type:l}}),cardSize:"sm",selected:a,tools:d&&"none"!==d?[{tooltipId:"success"===d?"layerInfo.tooltips.syncSuccess":"error"===d?"layerInfo.tooltips.syncError":void 0,glyph:"success"===d?"ok-sign":"error"===d?"exclamation-mark":void 0,Element:e=>"updating"===d?n().createElement(m.Z,{size:16}):n().createElement(v.Z,{placement:"top",overlay:n().createElement(i.Tooltip,{id:"layerinfo-syncstatus-tooltip"},n().createElement(p.Z,{msgId:e.tooltipId}))},n().createElement(i.Glyphicon,{glyph:e.glyph}))}]:[],preview:n().createElement("div",{className:"layerinfo-layeritem-preview"},n().createElement(i.Glyphicon,{glyph:a?"check":"unchecked"})),onClick:()=>o(a?f.filter((e=>e!==c)):[...f,c])}})),b=d()(a,{selected:!0});return n().createElement("div",{className:"layerinfo-content"},!t&&l?n().createElement("div",{className:"layerinfo-error-box alert-danger"},n().createElement("div",{className:"layerinfo-error-title"},n().createElement(p.Z,{msgId:l.title})),n().createElement("div",{className:"layerinfo-error-message"},n().createElement(p.Z,{msgId:l.message}))):null,(!t||r.syncingLayers)&&a.length>0?n().createElement("div",{className:"layerinfo-selectbutton-container"},n().createElement(y.Z,{className:"no-border",onClick:()=>o(b?[]:c)},n().createElement(i.Glyphicon,{glyph:b?"check":"unchecked"}),n().createElement(p.Z,{msgId:`layerInfo.${b?"deselect":"select"}All`}))):null,!t||r.syncingLayers?n().createElement("div",{className:"layerinfo-layerlist"+(a.length>0?"":"-empty")},n().createElement(u.Z,{items:E,emptyStateProps:{glyph:"1-layer",title:n().createElement(p.Z,{msgId:"layerInfo.noLayers"})}})):null,t&&!r.syncingLayers?n().createElement(m.Z,{size:100}):null)};var E=r(283604),b=r(152543),L=r(687753);const S=e=>{var t,r;return null===(t=e.controls)||void 0===t||null===(r=t.layerinfo)||void 0===r?void 0:r.enabled},I=e=>{var t;return null===(t=e.layerinfo)||void 0===t?void 0:t.layers};var h=r(707366);const C="LAYERINFO:SYNC_LAYERS",O="LAYERINFO:SELECT_LAYERS",N="LAYERINFO:SET_LAYERS",A="LAYERINFO:UPDATE_LAYER",R="LAYERINFO:RESET_SYNC_STATUS",k="LAYERINFO:UPDATE_SYNC_STATUS",T="LAYERINFO:SET_ERROR",Z="LAYERINFO:LOADING",w=e=>({type:A,layer:e}),Y=e=>({type:T,error:e}),F=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"loading";return{type:Z,name:t,value:e}};var _=r(630998),P=r.n(_),U=r(521923),z=r(49977),G=r(3674),x=r.n(G),M=r(478718),B=r.n(M),$=r(984596),j=r.n($),D=r(313311),H=r.n(D),V=r(513218),X=r.n(V),q=r(333101),J=r(612912),K=r(943650),Q=r(742178),W=r(797678);const ee=e=>B()(e,"id","name","title","description","type"),te=(e,t)=>e.ofType(L.dc,L.At,L.kM).filter((e=>{let{type:r,control:l,property:a,properties:n=[]}=e;return!!S(t.getState())&&"layerinfo"===l&&("enabled"===a||P()(x()(n),(e=>"enabled"===e))>-1||r===L.kM)})).switchMap((()=>{const e=t.getState(),r=(0,J.l2)(e);return z.Observable.of(F(!0),Y(),(e=>({type:N,layers:e}))(r.filter((e=>{let{type:t,group:r}=e;return("wms"===t||"wmts"===t)&&"background"!==r})).map((e=>({layerObj:e,...ee(e),selected:!1,syncStatus:"none"}))).reverse()),F(!1))})),re=(e,t)=>e.ofType(C).switchMap((e=>{let{layers:r}=e;const l={wms:e=>e.catalogURL?z.Observable.defer((()=>Q.ZP.getRecordById(e.catalogURL))):(0,K.kB)(e),wmts:e=>z.Observable.defer((()=>W.Z.getCapabilities(e.capabilitiesURL||e.url))).map((t=>{var r,l;const a=j()((null===(r=t.Capabilities)||void 0===r||null===(l=r.Contents)||void 0===l?void 0:l.Layer)??[]),n=H()(a,{"ows:Identifier":e.name});return{title:null==n?void 0:n["ows:Title"],_abstract:null==n?void 0:n["ows:Abstract"]}}))};return z.Observable.of((a=r.length,{type:R,totalCount:a}),F(!0,"syncingLayers"),Y(),...I(t.getState()).map((e=>w({id:e.id,syncStatus:"none"}))),...r.map((e=>w({id:e.id,selected:!1,syncStatus:"updating"})))).concat(z.Observable.merge(...r.map((e=>{let{layerObj:t}=e;return l[t.type](t).map((e=>{var r;const l=e.title??(null===(r=e.dc)||void 0===r?void 0:r.title);var a,n;return l?["success",{...t,title:X()(t.title)?{...t.title,default:l}:l,description:e._abstract??(null===(a=e.dc)||void 0===a?void 0:a.abstract)??(null===(n=e.dc)||void 0===n?void 0:n.description)}]:["error",t]})).catch((e=>(console.error(e),z.Observable.of(["error",t]))))}))).flatMap((e=>{let[t,r]=e;return z.Observable.of(w({layerObj:r,...ee(r),syncStatus:t}),(0,q.tV)(r.id,"layer",B()(r,"title","description")),{type:k})})).concat(z.Observable.of(F(!1,"syncingLayers"))).catch((()=>z.Observable.of(Y({title:"layerInfo.syncingLayersGeneralError.title",message:"layerInfo.syncingLayersGeneralError.message"}),F(!1,"syncingLayers")))));var a})),le=(0,b.rx)("LayerInfo",{component:(0,s.connect)((0,o.zB)({enabled:S,layers:I,currentLocale:h.Pz,loading:e=>{var t;return null===(t=e.layerinfo)||void 0===t?void 0:t.loading},loadFlags:e=>{var t;return null===(t=e.layerinfo)||void 0===t?void 0:t.loadFlags},syncStatus:e=>{var t;return null===(t=e.layerinfo)||void 0===t?void 0:t.syncStatus},error:e=>{var t;return null===(t=e.layerinfo)||void 0===t?void 0:t.error}}),{onSyncLayers:e=>({type:C,layers:e}),onSelectLayers:e=>({type:O,layers:e}),onClose:L.Xg.bind(null,"layerinfo","enabled",!1)})((e=>{let{enabled:t=!1,layers:r=[],currentLocale:l,loading:a=!1,loadFlags:s={},syncStatus:o={},error:i,onSyncLayers:c=(()=>{}),onSelectLayers:d,onClose:y=(()=>{})}=e;const u=a&&s.syncingLayers,m=r.filter((e=>{let{selected:t}=e;return t}));return n().createElement(E.Z,{bodyClassName:"layerinfo-dialog-body",loading:u,loadingText:a&&n().createElement(p.Z,{msgId:"layerInfo.updatingLayers",msgParams:o}),size:"sm",show:t,clickOutEnabled:!u,showClose:!u,onClose:()=>y(),title:n().createElement(p.Z,{msgId:"layerInfo.title"}),buttons:[{text:n().createElement(p.Z,{msgId:"layerInfo.syncButton"}),disabled:u||!m.length,onClick:()=>c(m)}]},n().createElement(f,{loading:a,loadFlags:s,error:i,layers:r,currentLocale:l,onSelectLayers:d}))})),containers:{TOC:{name:"LayerInfo",doNotHide:!0}},reducers:{layerinfo:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:var r;return(0,U.t8)("layers",null===(r=e.layers)||void 0===r?void 0:r.map((e=>({...e,selected:P()(t.layers,(t=>t===e.id))>-1}))),e);case N:return(0,U.t8)("layers",t.layers,e);case A:{var l;const r=e.layers||[],a=null!==(l=t.layer)&&void 0!==l&&l.id?P()(r,{id:t.layer.id}):-1;return(0,U.t8)("layers",r.map(((e,r)=>r===a?{...e,...t.layer}:e)),e)}case R:return(0,U.t8)("syncStatus",{updatedCount:"0",totalCount:`${t.totalCount}`},e);case k:{var a;const t=parseInt(null===(a=e.syncStatus)||void 0===a?void 0:a.updatedCount,10);return(0,U.t8)("syncStatus",{...e.syncStatus,updatedCount:`${t+1}`},e)}case T:return(0,U.t8)("error",t.error,e);case Z:return(0,U.t8)("loading"===t.name?"loading":`loadFlags.${t.name}`,t.value,(0,U.t8)("loading",t.value,e));default:return e}}},epics:l})}}]);