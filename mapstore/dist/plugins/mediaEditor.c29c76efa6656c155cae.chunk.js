(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[8249],{768977:(e,t,r)=>{"use strict";r.d(t,{Z:()=>p});var i=r(45697),a=r.n(i),d=r(124852),o=r.n(d),n=r(630294),s=r(222777);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},l.apply(this,arguments)}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class m extends o().Component{render(){const{cardComponent:e,items:t,colProps:r,onItemClick:i,size:a}=this.props,d=e||s.Z;return o().createElement("div",{className:"msSideGrid"+(this.props.className?" "+this.props.className:"")},o().createElement(n.Row,{className:"items-list"},t.map(((e,t)=>o().createElement(n.Col,l({key:e.id||t},r),o().createElement(d,l({onClick:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i(e,...r)},size:a},e)))))))}}c(m,"propTypes",{size:a().string,onItemClick:a().func,colProps:a().object,items:a().array,cardComponent:a().oneOfType([a().string,a().func]),className:a().string}),c(m,"defaultProps",{size:"",onItemClick:()=>{},colProps:{xs:12},className:"",items:[]});const p=m},274335:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var i=r(124852),a=r.n(i),d=r(45697),o=r.n(d),n=r(180307),s=r.n(n);function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r(49977);const c=function(){let{dataProp:e="items",querySelector:t,closest:r=!1,loadingProp:i="loading",skip:d=0,pageSize:n=10,offsetSize:c=200}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m=>{var p;return p=class extends a().Component{constructor(){super(...arguments),l(this,"findScrollDomNode",(()=>{if(!this.isMounded)return null;let e=s().findDOMNode(this);return e&&r&&t?e.closest(t||"*"):e&&(t?e.querySelector(t):e)})),l(this,"onScroll",(()=>{const t={skip:d,pageSize:n,offsetSize:c,...this.props.scrollOptions},r=this.findScrollDomNode();r&&this.props.isScrolled({div:r,offset:t.offsetSize})&&(!e||this.props[e]&&this.props[e].length)&&(!i||!this.props[i])&&this.props.hasMore(this.props)&&this.props.onLoadMore(e?Math.ceil((this.props[e].length-t.skip)/t.pageSize):null)}))}componentDidMount(){this.isMounded=!0;const e=this.findScrollDomNode();e&&(this.listenerAdded=!0,e.addEventListener("scroll",this.onScroll,!1),this.onScroll())}componentDidUpdate(t){const r=this.findScrollDomNode();r&&!this.listenerAdded&&(r.addEventListener("scroll",this.onScroll,!1),this.listenerAdded=!0),!r||e&&this.props[e]&&this.props[e]===t[e]||setTimeout((()=>this.onScroll()),300)}componentWillUnmount(){this.isMounded=!1,this.listenerAdded=!1;const e=this.findScrollDomNode();e&&e.removeEventListener("scroll",this.onScroll,!1)}render(){return a().createElement(m,this.props)}},l(p,"propTypes",{hasMore:o().func,onLoadMore:o().func,isScrolled:o().func,scrollOptions:o().object}),l(p,"defaultProps",{onLoadMore:()=>{},hasMore:()=>!0,isScrolled:e=>{let{div:t,offset:r}=e;return t.scrollTop+t.clientHeight>=t.scrollHeight-r}}),p}}},847911:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var i=r(124852),a=r.n(i),d=r(45697),o=r.n(d),n=r(23279),s=r.n(n);const l=(e,t)=>r=>{function d(d){const o=(0,i.useRef)(),[n,l]=(0,i.useState)(d[t]),c=(0,i.useRef)();c.current=n,(0,i.useEffect)((()=>{c.current!==d[t]&&l(d[t])}),[d[t]]),(0,i.useEffect)((()=>(o.current=s()((t=>{let{newProps:r,newValue:i}=t;r[e](i)}),d.debounceTime),()=>{o.current.cancel()})),[d.debounceTime]);const m={...d,[t]:n,[e]:function(e){l(e),o.current&&(o.current.cancel(),o.current({newProps:d,newValue:e}))}};return a().createElement(r,m)}return d.propTypes={debounceTime:o().number},d.defaultProps={debounceTime:300},d.displayName=r.displayName+"WithDebounceOnCallback",d}},500023:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var i=r(740292),a=r(867076);const d=(0,a.compose)((0,a.withHandlers)({onMapViewChanges:e=>{let{onChange:t=(()=>{})}=e;return e=>{t("maps",e),t("mapStateSource",e.mapStateSource)}}}))(i.Z)},294273:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>ht});var i={};r.r(i),r.d(i,{create:()=>C});var a={};r.r(a),r.d(a,{getData:()=>N,load:()=>A});var d={};r.r(d),r.d(d,{editRemoteMap:()=>Q,editorSaveUpdateMediaEpic:()=>H,importInLocalSource:()=>Y,loadMediaEditorDataEpic:()=>B,mediaEditorEditMap:()=>$,mediaEditorNewMap:()=>W,reloadMediaResources:()=>V,removeMediaEpic:()=>K,setMediaTypeOnDisable:()=>_,updateSelectedItem:()=>X});var o=r(171703),n=r(22222),s=r(152543),l=r(554915),c=r(49977),m=r(455877),p=r.n(m),u=r(270894),g=r.n(u),E=r(545542),h=r(694552),y=r(400043),v=r(927658),b=r(607739),f=r.n(b),T=r(219002),M=r(796205);const S=e=>{let{store:t}=e;return e=>{let{mediaType:r,source:i,data:a}=e;return c.Observable.of(p()()).do((e=>t.dispatch((0,T.rp)(e,r,a)))).map((e=>({id:e,mediaType:r,data:a,source:i})))}},I=e=>{let{store:t}=e;return e=>{let{mediaType:r,source:i,data:a}=e;const d=t.getState(),o=(0,h.jR)(d);return c.Observable.of(o).do((()=>t.dispatch((0,T.zJ)(o,r,a)))).map((()=>({id:o,mediaType:r,data:a,source:i})))}},P=e=>{let{store:t}=e;return e=>{let{mediaType:r,params:i}=e;const a=(0,M.jq)(t.getState()).length?f()((0,M.jq)(t.getState()),"type"):{},{page:d,pageSize:o}=i,n=d*o,s=i.q||"",l=(0,y.Aq)(a[r]||[],s);return c.Observable.of({resources:l.filter(((e,t)=>t>=0&&t<n)),totalCount:l.length})}},k=e=>{let{store:t}=e;return e=>{let{mediaType:r}=e;const i=t.getState(),a=(0,h.jR)(i);return c.Observable.of(a).do((()=>t.dispatch((0,T.ql)(a,r)))).map((()=>({id:a,type:r})))}},C=e=>({edit:I(e),save:S(e),load:P(e),remove:k(e)});var Z=r(984596),O=r.n(Z),w=r(399790),x=r(234228),R=r(679426);const A=e=>{let{params:t}=e;const{page:r,pageSize:i}=t,a={resources:[],totalCount:0};return(0,R.jh)({category:"MAP",query:t.q||"*",options:{params:{start:(r-1)*i,limit:i}}}).switchMap((e=>{let{results:t,totalCount:r}=e;return c.Observable.of({resources:(""!==t&&O()(t)||[]).map((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{data:{...e,thumbnail:decodeURIComponent(e.thumbnail||"")},id:p()(),type:"map"}})),totalCount:r||0})})).catch((()=>c.Observable.of(a)))},N=e=>{let{selectedItem:t}=e;return t&&"map"===t.type&&t.data&&t.data.id&&!t.data.layers?(0,R.RX)(t.data.id).switchMap((e=>{var t;let{id:r,data:i,attributes:a,creation:d,canCopy:o,canDelete:n,canEdit:s,name:l,description:m}=e;const p=i,u=p.version?(0,x.jS)(p.map):(0,x.pT)(p),g=(0,w.IK)(u.layers.map((e=>("background"!==e.group||"ol"!==e.type&&"OpenLayers.Layer"!==e.type||(e.type="empty"),e)))),E={...u&&u.map||{},id:r,groups:u&&u.groups||[],layers:null!=u&&null!==(t=u.map)&&void 0!==t&&t.sources?g.map((e=>{const t=(0,w.gv)(u.map.sources,e);return{...e,...t}})):g};return c.Observable.of({...E,...a,id:r,creation:d,canCopy:o,canDelete:n,canEdit:s,name:l,description:m,thumbnail:decodeURIComponent(a.thumbnail||""),type:"map"})})):c.Observable.of(null)};let G={geostory:i,geostore:a};const D=e=>{const t={load:()=>c.Observable.empty(),save:()=>c.Observable.empty(),edit:()=>c.Observable.empty(),remove:()=>c.Observable.empty(),getData:()=>c.Observable.of(null)},r=G[e.type];return null!=r&&r.create?{...t,...r.create(e)}:{...t,...r}};var L=r(313311),j=r.n(L),z=r(264721),q=r.n(z),F=r(441609),U=r.n(F);const B=(e,t)=>e.ofType(l.nr,l.V9,l.HP,l.ri).switchMap((e=>{var r;const i=t.getState(),a=e.sourceId||(0,h.IQ)(i),d=e.mediaType||(0,h.hb)(i),o=(0,h.Gi)(t.getState())||[],n=(0,h.jR)(i),s=null!==(r=e.params)&&void 0!==r&&r.page?e.params.page:1,m={...e.params,page:s,pageSize:10},p=1===s?[]:o,u={...(0,h.dq)(i),store:t};return D(u).load({mediaType:d,sourceId:a,params:m,selectedId:n}).switchMap((e=>e?c.Observable.of((0,l.Gr)({mediaType:d,sourceId:a,params:{...m,mediaType:d},resultData:{...e,resources:[...p,...e.resources]}})):c.Observable.empty())).startWith((0,l.Yt)())})),H=(e,t)=>e.ofType(l.ww).switchMap((e=>{let{mediaType:r="image",source:i,data:a}=e;const d=(0,h.cM)(t.getState()),o={...(0,h.dq)(t.getState()),store:t},n=d?D(o).edit({mediaType:r,source:i,data:a}):D(o).save({mediaType:r,source:i,data:a}),s=d?(0,l.Az)(!1):(0,l.I5)(!1);return n.switchMap((e=>{let{id:t}=e;return c.Observable.of((0,l.oo)({mediaType:r,source:i,data:a,id:t}),s,(0,l.Gh)(t))}))})),W=(e,t)=>{let{getState:r}=t;return e.ofType(E.nr).filter((e=>{let{owner:t,map:r}=e;return"mediaEditor"===t&&!r})).switchMap((()=>{const t=e.ofType(E.LE).switchMap((e=>{let{map:t}=e;const i=(0,h.Gi)(r())||[],a=p()();return c.Observable.from([(0,l.Gr)({mediaType:y.Tr.MAP,sourceId:v.r.GEOSTORY,params:{mediaType:y.Tr.MAP},resultData:{resources:[{id:a,type:"map",data:{type:"map",id:a,...t}},...i],totalCount:i.length+1}}),(0,l.Gh)(a),(0,E.Cp)()])})).takeUntil(e.ofType(E.B8)),i=e.ofType(E.B8).map((()=>(0,l.I5)(!1))).takeUntil(e.ofType(E.LE));return c.Observable.merge(i,t)}))},$=(e,t)=>{let{getState:r}=t;return e.ofType(E.nr).filter((e=>{let{owner:t,map:r}=e;return"mediaEditor"===t&&!!r})).switchMap((()=>e.ofType(E.LE).switchMap((e=>{let{map:t}=e;const i=(0,h.B6)(r());return c.Observable.from([(0,l.$G)({...i,data:{...t}},"replace"),(0,E.Cp)()])})).takeUntil(e.ofType(E.B8))))},V=(e,t)=>{let{getState:r}=t;return e.ofType(l.Gl,l.Ai).filter((e=>{let{editing:t=!0,adding:r=!0}=e;return!1===t||!1===r})).map((()=>(0,l.pW)(void 0,(0,h.hb)(r()),v.r.GEOSTORY)))},Y=(e,t)=>e.ofType(l.GZ).switchMap((e=>{let{resource:r,sourceType:i}=e;const a=(0,h.HL)(t.getState()),d=g()(a,(e=>{let{type:t}=e;return i===t})),o={...a[d],store:t};return D(o).save({mediaType:r.type,source:a[d],data:r}).switchMap((e=>{let{id:t}=e;return c.Observable.of((0,l.d8)(d),(0,l.oo)({mediaType:r.type,source:a[d],data:r,id:t}),(0,l.pW)(void 0,r.type,d),(0,l.Gh)(t))}))})),Q=(e,t)=>e.ofType(E.nr).filter((e=>{let{owner:t,map:r}=e;return"mediaEditorEditRemote"===t&&!!r})).switchMap((function(){let{map:{data:r}={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.ofType(E.LE).switchMap((e=>{let{map:i}=e;const a=(0,h.HL)(t.getState()),d=g()(a,(e=>{let{type:t}=e;return v.r.GEOSTORY===t})),o={...a[d],store:t};return D(o).save({mediaType:r.type,source:a[d],data:{...r,...i}}).switchMap((e=>{let{id:t}=e;return c.Observable.of((0,l.d8)(d),(0,l.oo)({mediaType:r.type,source:a[d],data:r,id:t}),(0,l.pW)(void 0,r.type,d),(0,l.Gh)(t),(0,E.Cp)())}))})).takeUntil(e.ofType(E.B8))})),K=(e,t)=>e.ofType(l.O6).switchMap((e=>{let{mediaType:r}=e;const i={...(0,h.dq)(t.getState()),store:t};return D(i).remove({mediaType:r}).switchMap((()=>c.Observable.of((0,l.pW)(void 0,(0,h.hb)(t.getState()),v.r.GEOSTORY))))})),X=(e,t)=>e.ofType(l.gd).switchMap((()=>{const e=t.getState(),r=(0,h.B6)(e),i={...(0,h.dq)(t.getState()),store:t};return D(i).getData({selectedItem:r}).switchMap((e=>null===e?c.Observable.of((0,l.E0)(!1)):c.Observable.of((0,l.$G)({...r,data:{...e}},"replace"),(0,l.E0)(!1)))).catch((()=>c.Observable.of((0,l.E0)(!1)))).startWith((0,l.E0)(!0))})),_=e=>e.ofType(l.Wp).filter((e=>{let{mediaTypes:t}=e;return!U()(t)})).switchMap((e=>{let{mediaTypes:t}=e;const r=j()(Object.values(y.Tr),(e=>!q()(t,e)));return r?c.Observable.of((0,l.y5)(r)):c.Observable.empty()}));var J=r(227361),ee=r.n(J),te=r(630998),re=r.n(te),ie=r(682492),ae=r.n(ie),de=r(275982),oe=r(521923);const ne="geostory",se={open:!1,data:{},settings:{mediaType:y.Tr.IMAGE,sourceId:ne,mediaTypes:{image:{defaultSource:ne,sources:[ne]},video:{defaultSource:ne,sources:[ne]},map:{defaultSource:ne,sources:[ne,"geostoreMap"]}},sources:{geostory:{name:"geostory.storyResources",type:v.r.GEOSTORY,addMediaEnabled:{image:!0,video:!0,map:!0},editMediaEnabled:{image:!0,video:!0,map:!0},removeMediaEnabled:{image:!0,video:!0,map:!0}},geostoreMap:{name:"geostory.geostoreMap",type:v.r.GEOSTORE,baseURL:"rest/geostore/",category:"MAP",editMediaEnabled:{map:!0}}}}};var le=r(124852),ce=r.n(le),me=r(867076),pe=r(6760),ue=r(804504);const ge=(0,me.compose)((0,me.defaultProps)({confirmContent:ce().createElement(ue.Z,{msgId:"mediaEditor.confirmExitContent"}),confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.confirmExitTitle"})}),(0,me.withPropsOnChange)(["adding"],(e=>{let{adding:t}=e;return{confirmPredicate:t}})),(0,me.withHandlers)({onClick:e=>{let{hide:t,owner:r}=e;return()=>t(r)}}),pe.Z,(0,me.withHandlers)({hide:e=>{let{onClick:t}=e;return function(){return t(...arguments)}}}));var Ee=r(283604),he=r(466737),ye=r(743129),ve=r(756435),be=r(486234),fe=r(8204),Te=r(141919);const Me=(0,Te.Z)((e=>{let{mediaType:t,selectedItem:r}=e;return t===y.Tr.IMAGE&&!r}),{style:{width:"100%",height:"100%",boxShadow:"inset 0px 0px 30px -5px rgba(0,0,0,0.16)"},iconFit:!0,glyph:"picture",imageStyle:{display:"flex",flexDirection:"column",justifyContent:"center"}})((e=>{let{selectedItem:t}=e;const r=t&&t.data&&t.data.src;return r&&ce().createElement("img",{src:r,style:{objectFit:"contain",width:"100%",height:"100%"}})}));var Se=r(279143);const Ie=(0,Te.Z)((e=>{let{mediaType:t,selectedItem:r}=e;return t===y.Tr.VIDEO&&!r}),{style:{width:"100%",height:"100%",boxShadow:"inset 0px 0px 30px -5px rgba(0,0,0,0.16)"},iconFit:!0,glyph:"play",imageStyle:{display:"flex",flexDirection:"column",justifyContent:"center"}})((e=>{var t,r;let{selectedItem:i}=e;const a=null==i||null===(t=i.data)||void 0===t?void 0:t.src,d=null==i||null===(r=i.data)||void 0===r?void 0:r.thumbnail;return ce().createElement("div",{key:"preview",className:"ms-video-preview",style:{width:"100%",height:"100%",boxShadow:"inset 0px 0px 30px -5px rgba(0,0,0,0.16)"}},a&&ce().createElement(Se.Z,{key:a,thumbnail:d,fit:"contain",src:a,inView:!0,mode:y.nl.VIEW}))}));var Pe=r(500023);const ke=(0,Te.Z)((e=>{let{mediaType:t,selectedItem:r}=e;return t===y.Tr.MAP&&(!r||U()(r))}),{iconFit:!0,glyph:"1-map",imageStyle:{display:"flex",flexDirection:"column",justifyContent:"center"}})((e=>{let{selectedItem:t}=e;const{layers:r=[],mapOptions:i,...a}=t.data?t.data:t;return[ce().createElement(Pe.Z,{key:a.id||a.mapId,styleMap:{height:"100%"},map:{...a,id:"map"+a.id},id:"preview"+t.id,layers:r||[v.D],options:(0,y.kn)({})})]})),Ce=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.mediaType&&ce().createElement("div",{className:"ms-media-preview",key:"preview",style:{width:"100%",height:"100%",boxShadow:"inset 0px 0px 30px -5px rgba(0,0,0,0.16)"}},e.mediaType===y.Tr.IMAGE&&ce().createElement(Me,e),e.mediaType===y.Tr.VIDEO&&ce().createElement(Ie,e),e.mediaType===y.Tr.MAP&&ce().createElement(ke,e))||null},Ze=(0,be.Z)(["placeholder","clearValueText","noResultsText"])(ye.ZP);var Oe=r(414293),we=r.n(Oe);const xe=(0,me.compose)((0,o.connect)(null,{openMapEditor:E.$Z,importInLocal:l.Ul}),(0,me.withHandlers)({setAddingMedia:e=>{let{setAddingMedia:t,openMapEditor:r,mediaType:i}=e;return(e,a)=>{i===y.Tr.MAP&&r("mediaEditor",a),t(e)}},editRemoteMap:function(){let{openMapEditor:e,selectedItem:t={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return()=>{e("mediaEditorEditRemote",t)}}})),Re=(0,me.compose)((0,o.connect)((e=>({isUsed:(0,M._O)(e,(0,h.jR)(e))})),{removeMedia:l.TU}),(0,me.withHandlers)({onClick:e=>{let{removeMedia:t,mediaType:r}=e;return()=>{t(r)}}}),(0,me.withProps)((e=>{let{isUsed:t}=e;return{confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaList.removeResourceTitle"}),confirmContent:ce().createElement(ue.Z,{msgId:t?"mediaEditor.mediaList.confirmRemoveUsedResource":"mediaEditor.mediaList.confirmRemoveResource"})}})),pe.Z,(0,me.renameProp)("onClick","removeMedia"));var Ae=r(603754),Ne=r(89518),Ge=r(768977),De=r(867517),Le=r(847911),je=r(274335),ze=r(281563);const qe=(0,je.Z)()(Ge.Z),Fe=(0,be.Z)("filterPlaceholder")((0,Le.Z)("onFilter","filterText")(Ae.Z)),Ue={[y.Tr.IMAGE]:{glyph:"image",emptyMessageId:"mediaEditor.imageList.emptyList",filterPlaceholderMessageId:"mediaEditor.mediaPicker.imageFilter"},[y.Tr.VIDEO]:{glyph:"play",emptyMessageId:"mediaEditor.videoList.emptyList",filterPlaceholderMessageId:"mediaEditor.mediaPicker.videoFilter"},[y.Tr.MAP]:{glyph:"1-map",emptyMessageId:"mediaEditor.mapList.emptyList",filterPlaceholderMessageId:"mediaEditor.mediaPicker.mapFilter"}},Be=(0,me.compose)(xe,Re)((e=>{var t,r,i,a,d;let{resources:o=[],services:n=[],selectedItem:s,selectedSource:l={},selectedService:c,mediaType:m,selectItem:p=(()=>{}),setAddingMedia:u=(()=>{}),setEditingMedia:g=(()=>{}),editRemoteMap:E=(()=>{}),removeMedia:h=(()=>{}),params:b,totalCount:f,onLoad:T,loadingSelected:M,loading:S,buttons:I=[{glyph:"plus",tooltipId:"mediaEditor.mediaPicker.add",visible:!(null==l||null===(t=l.addMediaEnabled)||void 0===t||!t[m]),onClick:()=>u(!0)},{glyph:"pencil",tooltipId:"mediaEditor.mediaPicker.edit",visible:!(void 0!==(null==s||null===(r=s.data)||void 0===r?void 0:r.sourceId)&&(null==s||null===(i=s.data)||void 0===i?void 0:i.sourceId)!==c||null==l||null===(a=l.editMediaEnabled)||void 0===a||!a[m]||we()(s)),onClick:()=>{l.type===v.r.GEOSTORY?g(!0):l.type===v.r.GEOSTORE&&E()}},{glyph:"trash",tooltipId:"mediaEditor.mediaPicker.trash",visible:!(null==l||null===(d=l.removeMediaEnabled)||void 0===d||!d[m]||we()(s)),onClick:h}]}=e;const P=(null==b?void 0:b.q)||"";function k(e){T({...b,...e},m,c)}const{glyph:C,emptyMessageId:Z,filterPlaceholderMessageId:O}=Ue[m]||{},w=0===o.length&&S;return ce().createElement("div",{style:{position:"relative"},className:"ms-media-list"},I.filter((e=>!!we()(e.visible)||e.visible)).length>0&&ce().createElement("div",{className:"ms-media-toolbar",key:"toolbar"},ce().createElement(fe.Z,{btnDefaultProps:{bsStyle:"primary",className:"square-button-md"},buttons:I})),ce().createElement(Fe,{filterPlaceholder:O,filterText:P,onFilter:e=>{k({page:1,q:e})}}),o.length>0?ce().createElement(qe,{loading:S,scrollOptions:{pageSize:b.pageSize},items:o.map((e=>{let{id:t,data:r={}}=e;const i=null==n?void 0:n.find((e=>{let{id:t}=e;return t===r.sourceId}));return{preview:r.thumbnail||m===y.Tr.IMAGE&&r.src?ce().createElement("div",{style:{backgroundImage:`url("${r.thumbnail||r.src}")`,backgroundSize:"cover",backgroundPosition:"center",height:"100%",overflow:"hidden"}}):ce().createElement(ze.Z,{glyph:C,padding:20}),title:r.title||r.name,onClick:()=>p(t),selected:s&&s.id&&t===s.id,description:r.description,caption:i&&ce().createElement(ue.Z,{msgId:i.name})}})),hasMore:()=>f>o.length,onLoadMore:e=>{k({page:e+1})}}):!w&&ce().createElement("div",{className:"msEmptyListMessage"},ce().createElement(De.Z,{msgId:Z})),ce().createElement("div",{className:"ms-media-list-pagination"},ce().createElement("div",null,o.length&&f?ce().createElement(De.Z,{msgId:"mediaEditor.mediaList.resultsCount",msgParams:{count:o.length,total:f}}):null),S&&ce().createElement(Ne.Z,{size:20})),(M||w)&&ce().createElement("div",{className:"ms-media-list-loading"},ce().createElement(Ne.Z,{size:70})))}));var He=r(630294),We=r(719648);const $e=[{placeholder:"mediaEditor.mediaPicker.sourcePlaceholder",type:"text",id:"src",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.source"}),validation:e=>{let{src:t}=e;return void 0!==t&&""===t?"error":t?"success":void 0}},{placeholder:"mediaEditor.mediaPicker.titlePlaceholder",type:"text",id:"title",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.title"}),validation:e=>{let{title:t}=e;return void 0!==t&&""===t?"error":t?"success":void 0}},{placeholder:"mediaEditor.mediaPicker.altTextPlaceholder",type:"text",id:"alt",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.altText"})},{placeholder:"mediaEditor.mediaPicker.descriptionPlaceholder",type:"text",id:"description",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.description"})},{placeholder:"mediaEditor.mediaPicker.creditsPlaceholder",type:"text",id:"credits",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.credits"})}],Ve=(0,me.compose)((0,me.defaultProps)({confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitTitle"}),confirmContent:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitContent"}),getImageDimensionsFunc:function(e,t){const r=new Image;r.onload=()=>{t({imgWidth:r.naturalWidth,imgHeight:r.naturalHeight})},r.onerror=()=>{t({})},r.src=e}}),(0,me.withStateHandlers)((e=>{let{selectedItem:t={},editing:r}=e;return{properties:r?{...t.data}:{},confirmPredicate:!1}}),{setProperties:e=>t=>({properties:{...e.properties,...t},confirmPredicate:!0})}),(0,me.withHandlers)({onClick:e=>{let{setAddingMedia:t,setEditingMedia:r,editing:i}=e;return()=>{i&&r(!1)||t(!1)}}}),pe.Z,(0,me.getContext)({messages:{}}))((e=>{let{properties:t={},onClick:r=(()=>{}),setProperties:i=(()=>{}),onSave:a=(()=>{}),messages:d,getImageDimensionsFunc:o}=e;return ce().createElement(ve.Z,{className:"ms-imageForm",header:ce().createElement("div",{className:"text-center",key:"toolbar",style:{borderBottom:"1px solid #ddd",padding:8}},ce().createElement(fe.Z,{btnGroupProps:{style:{marginBottom:8}},btnDefaultProps:{bsStyle:"primary",className:"square-button-md"},buttons:[{glyph:"arrow-left",tooltipId:"mediaEditor.mediaPicker.back",onClick:r},{glyph:"floppy-disk",tooltipId:"mediaEditor.mediaPicker.save",disabled:!t.src||!t.title,onClick:()=>{o(t.src,(e=>a({...t,...e})))}}]}))},ce().createElement(He.Form,{style:{padding:8}},$e.map((e=>ce().createElement(He.FormGroup,{key:e.id,validationState:e.validation&&e.validation(t)},ce().createElement(He.ControlLabel,null,e.label),ce().createElement(He.FormControl,{type:e.type,placeholder:(0,We.S$)(d,e.placeholder),value:t[e.id]||"",onChange:r=>{i({...t,[e.id]:r.target.value})}}))))))}));var Ye=r(618446),Qe=r.n(Ye),Ke=r(59810),Xe=r(472704);function _e(){return _e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},_e.apply(this,arguments)}const Je=(0,pe.Z)(Ke.Z),et=e=>ce().createElement(Je,_e({confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.mapForm.confirmMapSaveTitle"}),confirmContent:ce().createElement(ue.Z,{msgId:"mediaEditor.mapForm.confirmMapSaveContent"})},e)),tt=[{placeholder:"mediaEditor.mediaPicker.titlePlaceholder",type:"text",id:"name",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.title"}),validation:e=>{let{name:t}=e;return void 0!==t&&""===t?"error":t?"success":void 0}},{placeholder:"mediaEditor.mediaPicker.descriptionPlaceholder",type:"text",id:"description",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.description"})}],rt=(0,me.compose)((0,o.connect)(((e,t)=>{const{selectedItem:{id:r,type:i}={}}=t||{};return{isResourceUsed:i===y.Tr.MAP&&(0,M._O)(e,r)}}),{openMapEditor:E.$Z}),(0,me.defaultProps)({confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitTitle"}),confirmContent:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitContent"})}),(0,me.withState)("properties","setProperties",(e=>{let{selectedItem:{data:{name:t,thumbnail:r,description:i}={}}={}}=e;return{name:t,thumbnail:r,description:i}})),(0,me.withState)("initialResource",null,(e=>{let{properties:t,selectedItem:{data:r={}}={}}=e;return{...r,...t}})),(0,me.withHandlers)({openMapEditor:e=>{let{selectedItem:t,openMapEditor:r}=e;return()=>{const{id:e,...i}=t.data;r("mediaEditor",{data:i,id:e})}},onSave:e=>{let{onSave:t,selectedItem:{data:r={}}={},properties:i}=e;return()=>t({...r,...i})},updateThumb:e=>{let{setProperties:t,properties:r}=e;return e=>t({...r,thumbnail:e})},onClick:e=>{let{setAddingMedia:t,setEditingMedia:r,editing:i}=e;return()=>{i&&r(!1)||t(!1)}}}),(0,me.withPropsOnChange)(["selectedItem","initialResource","properties"],(e=>{let{initialResource:t,selectedItem:{data:r={}}={},properties:i}=e;return{confirmPredicate:!Qe()(t,{...r,...i})}})),pe.Z,(0,me.defaultProps)({errorMessages:{FORMAT:ce().createElement(ue.Z,{msgId:"map.errorFormat"}),SIZE:ce().createElement(ue.Z,{msgId:"map.errorCustomSize",msgParams:{maxFileSize:"50kb"}})}}),(0,me.withState)("thumbnailErrors","setErrors",(()=>[])),(0,me.getContext)({messages:{}}))((e=>{let{properties:t={},setProperties:r=(()=>{}),onSave:i=(()=>{}),updateThumb:a=(()=>{}),messages:d,openMapEditor:o,setErrors:n,thumbnailErrors:s=[],errorMessages:l,onClick:c=(()=>{}),confirmPredicate:m,isResourceUsed:p=!1}=e;return ce().createElement(ve.Z,{className:"ms-mapForm",header:ce().createElement("div",{className:"text-center",key:"toolbar",style:{borderBottom:"1px solid #ddd",padding:8}},ce().createElement(fe.Z,{btnGroupProps:{style:{marginBottom:8}},btnDefaultProps:{bsStyle:"primary",className:"square-button-md"},buttons:[{glyph:"arrow-left",tooltipId:"mediaEditor.mediaPicker.back",onClick:c},{renderButton:ce().createElement(et,{glyph:"floppy-disk",tooltipId:"mediaEditor.mediaPicker.save",disabled:!t.name||!m,onClick:i,bsStyle:"primary",className:"square-button-md",confirmPredicate:m&&p})},{glyph:"pencil",tooltipId:"mediaEditor.mediaPicker.edit",onClick:o}]}))},ce().createElement(He.Form,{style:{padding:8}},ce().createElement(Xe.Z,{thumbnail:t.thumbnail,thumbnailOptions:{width:300,height:180,type:"image/jpeg",quality:.5},message:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.thumbnail"}),onUpdate:e=>{a(e),n(void 0)},onRemove:()=>{a(void 0),n(void 0)},onError:e=>n(e)}),s&&s.length>0&&ce().createElement(He.Alert,{bsStyle:"danger",className:"text-center"},ce().createElement("div",null,ce().createElement(ue.Z,{msgId:"map.error"})),s.map((e=>ce().createElement("div",null," ",l[e])))),tt.map((e=>ce().createElement(He.FormGroup,{key:e.id,validationState:e.validation&&e.validation(t)},ce().createElement(He.ControlLabel,null,e.label),ce().createElement(He.FormControl,{type:e.type,placeholder:(0,We.S$)(d,e.placeholder),value:t[e.id]||"",onChange:i=>{r({...t,[e.id]:i.target.value})}}))))))}));var it=r(45697),at=r.n(it),dt=r(666141);function ot(){return ot=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},ot.apply(this,arguments)}const nt=[{placeholder:"mediaEditor.mediaPicker.videoUrlPlaceholder",type:"text",id:"src",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.videoUrl"}),validation:e=>{let{src:t}=e;return void 0!==t&&""===t?"error":t?"success":void 0}},{placeholder:"mediaEditor.mediaPicker.titlePlaceholder",type:"text",id:"title",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.title"}),validation:e=>{let{title:t}=e;return void 0!==t&&""===t?"error":t?"success":void 0}},{placeholder:"mediaEditor.mediaPicker.descriptionPlaceholder",type:"text",id:"description",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.description"})},{placeholder:"mediaEditor.mediaPicker.creditsPlaceholder",type:"text",id:"credits",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.credits"})}],st=e=>{let{src:t,thumbnail:r,onUpdate:i}=e;const a=(0,le.useRef)();(0,le.useEffect)((()=>(a.current=!0,()=>{a.current=!1})),[]);const[d,o]=(0,le.useState)(),[n,s]=(0,le.useState)(),[l,c]=(0,le.useState)(!r);return(0,le.useEffect)((()=>{t&&l&&(o(void 0),s(!0),(0,dt.v9)(t,{width:640,height:360,type:"image/jpeg",quality:.5}).then((e=>{a.current&&(i(e),c(!1),s(!1))})).catch((()=>{a.current&&(c(!1),o(["CREATE"]),s(!1))})))}),[t,l]),ce().createElement(ce().Fragment,null,ce().createElement(Xe.Z,{thumbnail:r,thumbnailOptions:{width:640,height:360,type:"image/jpeg",quality:.5},loading:n,message:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.thumbnail"}),onUpdate:e=>{i(e),o(void 0)},onError:e=>o(e),toolbarButtons:[{glyph:"refresh",tooltipId:"mediaEditor.mediaPicker.createVideoThumbnail",visible:!r,onClick:e=>{e.stopPropagation(),c(!0)}},{glyph:"trash",tooltipId:"removeThumbnail",visible:!!r,onClick:e=>{e.stopPropagation(),i(void 0),o(void 0)}}]}),d&&d.length>0&&ce().createElement(He.Alert,{bsStyle:"danger",className:"text-center"},-1===d.indexOf("CREATE")&&ce().createElement("div",null,ce().createElement(ue.Z,{msgId:"map.error"})),-1!==d.indexOf("FORMAT")&&ce().createElement("div",null,ce().createElement(ue.Z,{msgId:"map.errorFormat"})),-1!==d.indexOf("SIZE")&&ce().createElement("div",null,ce().createElement(ue.Z,{msgId:"map.errorSize"})),-1!==d.indexOf("CREATE")&&ce().createElement("div",null,ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.thumbnailCreateError"}))))},lt=(e,t)=>{let{properties:r,setProperties:i=(()=>{}),onSave:a=(()=>{}),onClick:d=(()=>{})}=e;const{messages:o={}}=t||{},{src:n,thumbnail:s}=r;return ce().createElement(ve.Z,{className:"ms-video-form",header:ce().createElement("div",{className:"text-center",key:"toolbar",style:{borderBottom:"1px solid #ddd",padding:8}},ce().createElement(fe.Z,{btnGroupProps:{style:{marginBottom:8}},btnDefaultProps:{bsStyle:"primary",className:"square-button-md"},buttons:[{glyph:"arrow-left",tooltipId:"mediaEditor.mediaPicker.back",onClick:d},{glyph:"floppy-disk",tooltipId:"mediaEditor.mediaPicker.save",disabled:!r.src||!r.title,onClick:()=>a(r)}]}))},ce().createElement(He.Form,{style:{padding:8}},ce().createElement(st,{src:n,thumbnail:s,onUpdate:e=>i({...r,thumbnail:e})}),nt.map((e=>ce().createElement(He.FormGroup,{key:e.id,validationState:e.validation&&e.validation(r)},ce().createElement(He.ControlLabel,null,e.label),ce().createElement(He.FormControl,{type:e.type,placeholder:(0,We.S$)(o,e.placeholder),value:r[e.id]||"",onChange:t=>{i({...r,[e.id]:t.target.value})}}))))))};lt.contextTypes={messages:at().object};const ct=(0,pe.Z)(lt),mt={[y.Tr.IMAGE]:Ve,[y.Tr.MAP]:rt,[y.Tr.VIDEO]:e=>{const[t,r]=(0,le.useState)(!1),[i,a]=(0,le.useState)(null!=e&&e.editing?{...null==e?void 0:e.selectedItem.data}:{});return ce().createElement(ct,ot({},e,{confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitTitle"}),confirmContent:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitContent"}),confirmPredicate:t,properties:i,setProperties:e=>{a(e),r(!0)},onClick:()=>(null==e?void 0:e.editing)&&(null==e?void 0:e.setEditingMedia(!1))||(null==e?void 0:e.setAddingMedia(!1))}))}},pt=(0,me.compose)((0,me.withHandlers)({onSave:e=>{let{mediaType:t,source:r,saveMedia:i=(()=>{})}=e;return e=>i({type:t,source:r,data:e})}}),(0,me.branch)((e=>{let{addingMedia:t}=e;return t}),(0,me.renderComponent)((e=>{const t=mt[e.mediaType||y.Tr.IMAGE];return ce().createElement(t,e)}))))(Be),ut=(0,o.connect)((0,n.P1)([h.Gi,h.B6,h.IQ,h.dq,h.cM,h.ER,h.mA,h.mD,h.XG,h.TU,h.Iy],((e,t,r,i,a,d,o,n,s,l,c)=>({resources:e,selectedItem:t,selectedService:r,selectedSource:i,editing:a,services:c,params:d,totalCount:o,loadingSelected:n,loading:s,...l}))),{selectItem:l.Gh,setAddingMedia:l.I5,setEditingMedia:l.Az,saveMedia:l.gG,onLoad:l.pW,setMediaService:l.d8})(pt),gt=(0,o.connect)((0,n.zB)({selectedItem:h.B6,selectedService:h.IQ,services:h.Iy,editing:h.cM,saveState:h.TU,disabledMediaType:h.f5}),{setMediaService:l.d8,setMediaType:l.y5})((e=>{let{mediaType:t="image",saveState:r,selectedItem:i,selectedService:a,services:d=[{name:"Currently used",id:"geostory"},{name:"Geostore",id:"geostore"}],setMediaType:o=(()=>{}),setMediaService:n=(()=>{}),mediaSelector:s,disabledMediaType:l}=e;return ce().createElement(ve.Z,{className:"ms-mediaEditor",header:ce().createElement("div",{className:"ms-border-layout-header",style:{padding:4,zIndex:2}},ce().createElement(fe.Z,{btnDefaultProps:{bsSize:"sm"},buttons:[{text:ce().createElement(ue.Z,{msgId:"mediaEditor.images"}),active:"image"===t,bsStyle:"image"===t?"primary":"default",onClick:()=>{o("image")},disabled:r&&r.addingMedia||q()(l,"image")},{text:ce().createElement(ue.Z,{msgId:"mediaEditor.videos"}),active:"video"===t,bsStyle:"video"===t?"primary":"default",onClick:()=>{o("video")},disabled:r&&r.addingMedia||q()(l,"video")},{text:ce().createElement(ue.Z,{msgId:"mediaEditor.maps"}),active:"map"===t,bsStyle:"map"===t?"primary":"default",onClick:()=>{o("map")},disabled:r&&r.addingMedia||q()(l,"map")}]}),ce().createElement("div",{className:"ms-mediaEditor-services"},ce().createElement("div",{className:"ms-mediaEditor-label"},ce().createElement("strong",null,ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.services"}))),ce().createElement(Ze,{disabled:r&&r.addingMedia,noResultsText:"mediaEditor.mediaPicker.noResults",placeholder:"mediaEditor.mediaPicker.selectService",options:d.map((e=>({label:ce().createElement(ue.Z,{msgId:e.name}),value:e.id}))),onChange:n,value:a,clearable:!1}))),columns:[ce().createElement("div",{key:"selector",className:"ms-mediaSelector"},s)]},ce().createElement(Ce,{selectedItem:i,mediaType:t}))})),Et=ge((e=>{let{open:t,mediaType:r,chooseMedia:i,selectedItem:a,editing:d,adding:o,hide:n=(()=>{}),disableAddMedia:s,disableEditMedia:l}=e;return ce().createElement(he.Z,null,ce().createElement(Ee.Z,{title:ce().createElement(ue.Z,{msgId:"mediaEditor.modalTitle"}),show:t,clickOutEnabled:!1,onClose:n,size:"lg",modalClassName:"media-editor-modal",buttons:[{text:ce().createElement(ue.Z,{msgId:"mediaEditor.apply"}),bsSize:"sm",disabled:o||d,onClick:()=>i(a)}]},ce().createElement(gt,{mediaType:r,mediaSelector:ce().createElement(ut,{mediaType:r,disableAddMedia:s,disableEditMedia:l})})))})),ht=(0,s.rx)("MediaEditor",{component:(0,o.connect)((0,n.zB)({mediaType:h.hb,editing:e=>(0,h.cM)(e)||(0,h.gW)(e),adding:h.Qi,open:h.hp,selectedItem:h.B6}),{hide:l.Cp,chooseMedia:l.Ke})(Et),reducers:{mediaEditor:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case l.Ai:return(0,oe.qC)((0,oe.t8)("saveState.addingMedia",r.adding),(0,oe.t8)("selected",""))(t);case l.Gl:return(0,oe.qC)((0,oe.t8)("saveState.addingMedia",r.editing),(0,oe.t8)("saveState.editing",r.editing))(t);case l.B8:return(0,oe.qC)((0,oe.t8)("open",!1),(0,oe.t8)("owner",void 0),(0,oe.t8)("saveState.addingMedia",!1),(0,oe.t8)("saveState.editing",!1),(0,oe.t8)("settings",{...t.stashedSettings||se.settings,...(null===(e=t.settings)||void 0===e?void 0:e.mediaType)&&{mediaType:t.settings.mediaType}}),(0,oe.t8)("stashedSettings",void 0),(0,oe.zN)("selected"),(0,oe.t8)("disabledMediaType",[]))(t);case l.ih:{const{resultData:e,params:i,mediaType:a,sourceId:d}=r;return(0,oe.qC)((0,oe.t8)(`data["${a}"]["${d}"]`,{params:i,resultData:e}),(0,oe.t8)("loadingList",!1))(t)}case l.ty:{const{item:e,mode:i}=r,a=(0,h.IQ)({mediaEditor:t}),d=(0,h.hb)({mediaEditor:t}),o=(0,h.Qd)({mediaEditor:t}).resources,n=re()(o,{id:e.id}),s=j()(o,{id:e.id}),l="merge"===i?ae()({},ae()({},s),ae()({},e)):e;return(0,oe.t8)(`data["${d}"]["${a}"].resultData.resources[${n}]`,l,t)}case l.gd:return r.id===t.selected?(0,oe.t8)("selected","",t):(0,oe.t8)("selected",r.id,t);case l.HP:{const e=ee()(t,`settings.mediaTypes[${r.mediaType}].defaultSource`,"geostory");return(0,oe.qC)((0,oe.t8)("settings.sourceId",e),(0,oe.t8)("settings.mediaType",r.mediaType))(t)}case l.ri:return(0,oe.t8)("settings.sourceId",r.id,t);case l.nr:const i=r.settings&&{...r.settings,...t.settings.mediaType&&{mediaType:t.settings.mediaType}};return(0,oe.qC)((0,oe.t8)("open",!0),(0,oe.t8)("owner",r.owner),(0,oe.t8)("settings",i||t.settings),(0,oe.t8)("stashedSettings",t.settings))(t);case de.nk:return{...se,settings:{...t.settings,mediaType:se.settings.mediaType}};case l.Vt:return(0,oe.t8)("loadingSelected",r.loading,t);case l.Ug:return(0,oe.t8)("loadingList",!0,t);case l.Wp:return(0,oe.t8)("disabledMediaType",r.mediaTypes||[],t);default:return t}}},epics:d})},844174:e=>{e.exports=function(e,t,r,i){for(var a=-1,d=null==e?0:e.length;++a<d;){var o=e[a];t(i,o,r(o),e)}return i}},481119:(e,t,r)=>{var i=r(989881);e.exports=function(e,t,r,a){return i(e,(function(e,i,d){t(a,e,r(e),d)})),a}},435744:e=>{e.exports=function(e,t,r){var i;return r(e,(function(e,r,a){if(t(e,r,a))return i=r,!1})),i}},555189:(e,t,r)=>{var i=r(844174),a=r(481119),d=r(267206),o=r(701469);e.exports=function(e,t){return function(r,n){var s=o(r)?i:a,l=t?t():{};return s(r,e,d(n,2),l)}}},270894:(e,t,r)=>{var i=r(435744),a=r(247816),d=r(267206);e.exports=function(e,t){return i(e,d(t,3),a)}},607739:(e,t,r)=>{var i=r(789465),a=r(555189),d=Object.prototype.hasOwnProperty,o=a((function(e,t,r){d.call(e,r)?e[r].push(t):i(e,r,[t])}));e.exports=o}}]);