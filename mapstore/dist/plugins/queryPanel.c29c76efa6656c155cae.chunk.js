(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[8272,9412],{940711:(e,t,r)=>{"use strict";r.d(t,{b:()=>c});var o=r(727418),s=r.n(o);const a=e=>null===e?[]:e.map((e=>({properties:{...e},id:e.osm_id,type:"Feature",bbox:e.boundingbox.map((e=>parseFloat(e))).reduce(((e,t,r)=>(e[(e=>{switch(e){case 0:return 1;case 1:return 3;case 2:return 0;case 3:return 2;default:return-1}})(r)]=t,e)),[]),geometry:e.geojson||{type:"Point",coordinates:[parseFloat(e.lon),parseFloat(e.lat)]}})));var i=r(348660),l=r(487758);const n=e=>{let{searchText:t,staticFilter:r,blacklist:o,item:s,queriableAttributes:a,predicate:l}=e;const n=(0,i.generateTemplateString)(r||"")(s);let p,u=t.split(" ").filter((e=>e)).filter((e=>o.indexOf(e.toLowerCase())<0));return 0===u.length&&(u=t?[t]:[]),u.length>0&&(p="(".concat(u.map((e=>a.map((t=>`${t} ${l} '%${e.replace("'","''")}%'`)).join(" OR "))).join(") AND (")).concat(")")),p=p?p.concat(n):n||null,p};let p={nominatim:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{returnFullData:!1};return r(61427).Z.geocode(e,t).then((e=>t.returnFullData?e:a(e.data)))},wfs:(e,t)=>{let{url:r,typeName:o,queriableAttributes:a=[],outputFormat:i="application/json",predicate:p="ILIKE",staticFilter:u="",blacklist:c=[],item:d,fromTextToFilter:h=n,returnFullData:m=!1,...g}=t;const y=h({searchText:e,staticFilter:u,blacklist:c,item:d,queriableAttributes:a,predicate:p});return l.DH(r,s()({maxFeatures:10,typeName:o,outputFormat:i,cql_filter:y},g)).then((e=>m?e:e.features))}};const u={setService:(e,t)=>{p[e]=t},getService:e=>p[e]?p[e]:null},c={Services:p,Utils:u}},556382:(e,t,r)=>{"use strict";r.d(t,{Vd:()=>v,Vj:()=>w});var o=r(472500),s=r.n(o),a=r(666654),i=r.n(a),l=r(91175),n=r.n(l),p=r(414293),u=r.n(p),c=r(727418),d=r.n(c),h=r(49977),m=r.n(h),g=r(940711),y=r(470509),f=r.n(y),b=r(69090);const F=e=>{let{searchText:t="",queriableAttributes:r=[],predicate:o="ILIKE"}=e;const s=n()(r);let a=`strToLowerCase(${s}) ${o} '%${t.toLowerCase()}%'`;return u()(s)?"":"("+a+")"},v=e=>e.distinctUntilChanged((function(e){let{value:t,currentPage:r,attribute:o}=e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!(s.value!==t||s.currentPage!==r||s.attribute!==o)})).throttle((e=>m().Observable.timer(e.delayDebounce||0))).merge(e.debounce((e=>m().Observable.timer(e.delayDebounce||0)))).distinctUntilChanged().switchMap((e=>{if(e.performFetch){const t=(0,b.getWpsPayload)({attribute:e.attribute,layerName:e.typeName,maxFeatures:e.maxFeatures,startIndex:(e.currentPage-1)*e.maxFeatures,value:e.value});return m().Observable.fromPromise(f().post(e.url,t,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((e=>({fetchedData:e.data,busy:!1})))).catch((()=>m().Observable.of({fetchedData:{values:[],size:0},busy:!1}))).startWith({busy:!0})}return m().Observable.of({fetchedData:{values:[],size:0},busy:!1})})).startWith({}),w=e=>m().Observable.merge(e.distinctUntilChanged((function(){let{value:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{value:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e===t})).debounce((e=>m().Observable.timer(e.delayDebounce||0))),e.distinctUntilChanged((function(){let{filterProps:e,currentPage:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{filterProps:r,currentPage:o}=arguments.length>1?arguments[1]:void 0;return e===r&&t===o}))).switchMap((e=>{if(e.performFetch){let t=s().parse(e.url,!0),r="";(i()(t.pathname,"wfs")||i()(t.pathname,"wms")||i()(t.pathname,"ows")||i()(t.pathname,"wps"))&&(r=t.pathname.replace(/(wms|ows|wps|wfs)$/,"wfs")),t.query&&t.query.service&&delete t.query.service;const o=s().format(d()({},t,{search:null,pathname:r}));let a=d()({},{url:o,typeName:e.filterProps&&e.filterProps.typeName||"",predicate:e.filterProps&&e.filterProps.predicate||"ILIKE",blacklist:e.filterProps&&e.filterProps.blacklist||[],maxFeatures:e.filterProps&&e.filterProps.maxFeatures||3,queriableAttributes:e.filterProps&&e.filterProps.queriableAttributes||[],returnFullData:!0,startIndex:((e.currentPage||1)-1)*(e.filterProps&&e.filterProps.maxFeatures||3),outputFormat:"application/json",staticFilter:"",fromTextToFilter:F,item:{},timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"},srsName:e.filterProps&&e.filterProps.srsName||"EPSG:4326",...t.query});return m().Observable.fromPromise(g.b.Utils.getService("wfs")(e.value,a).then((t=>({fetchedData:{values:t.features.map((e=>e.properties)),size:t.totalFeatures,features:t.features,crs:e.filterProps&&e.filterProps.srsName||"EPSG:4326"},busy:!1})))).catch((()=>m().Observable.of({fetchedData:{values:[],size:0,features:[]},busy:!1}))).startWith({busy:!0})}return m().Observable.of({fetchedData:{values:[],size:0,features:[]},busy:!1})})).startWith({})},691718:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Dt});var o=r(618446),s=r.n(o),a=r(45697),i=r.n(a),l=r(124852),n=r.n(l),p=r(171703),u=r(506806),c=r(12838),d=r(22222),h=r(687753),m=r(296252),g=r(16075),y=r(564864),f=r(333101),b=r(859518),F=r(884757),v=r(612132),w=r(893379),E=r.n(w),x=r(768271);E()(x.Z,{insert:"head",singleton:!1}),x.Z.locals;var S=r(472986),C=r.n(S),P=r(756435),T=r(804504),O=r(569291),q=r(630294),N=r(743129),I=r(200020);const j=function(){let{item:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().createElement("span",null,e&&e.name?n().createElement(T.Z,{msgId:e.name}):null)},D=function(){let{spatialOperations:e=[],onChange:t=(()=>{}),value:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().createElement(I.DropdownList,{valueField:"id",className:"geometry-operation-selector",onChange:t,data:e,valueComponent:j,value:r,itemComponent:j})};var L=r(651493),M=r(959956),k=r(423214);const W=function(e){let{search:t,url:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,M.w0)(e,r)||(0,M.w0)(e,t&&t.url)},G=e=>(e||[]).filter((function(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"BBOX"!==e}));var B=r(227361),R=r.n(B),Z=r(313311),A=r.n(Z),V=r(49977),U=r.n(V),X=r(141520),_=r(452341);const z={"xsd:normalizedString":"string","xsd:string":"string","xsd:date":"date","xsd:dateTime":"date","xsd:date-time":"date-time","xsd:time":"time","xsd:decimal":"number","xsd:int":"number","xsd:integer":"number","xsd:long":"number","xsd:negativeInteger":"number","xsd:nonNegativeInteger":"number","xsd:nonPositiveInteger":"number","xsd:positiveInteger":"number","xsd:short":"number","xsd:unsignedLong":"number","xsd:unsignedInt":"number","xsd:unsignedShort":"number","xsd:number":"number","xsd:boolean":"boolean","xsd:double":"number","xsd:float":"number","xsd:array":"array"},H=e=>R()(e,"featureTypes[0].properties").filter((e=>0!==e.type.indexOf("gml:")&&z[e.type])).map((e=>({label:e.name,attribute:e.name,type:z[e.type],valueId:"id",valueLabel:"name",values:[]})));var Q=r(867076),$=r(509978);const Y=e=>e.distinctUntilChanged((function(){let{searchUrl:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{searchUrl:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e===t})).switchMap((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.crossLayerExpanded?V.Observable.of(t):e.filter((function(){let{crossLayerExpanded:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e})).take(1)})).switchMap((e=>{let{featureTypeName:t,searchUrl:r}=e;return(0,X.ED)({layer:{name:t,url:r,search:{type:"wfs",url:r}}}).do((e=>{if(!(e=>{const t=R()(e,"WFS_Capabilities.Filter_Capabilities.Scalar_Capabilities.ArithmeticOperators.Functions.FunctionNames.FunctionName");return!!A()(t,(function(){let{_:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"queryCollection"===e}))})(e))throw new Error("nocrosslayerfunctionalities")})).map((()=>({loadingCapabilities:!1}))).catch((e=>V.Observable.of({errorObj:e,loadingAttributes:!1,loadingCapabilities:!1,featureTypeProperties:[]}))).startWith({loadingCapabilities:!0})})).startWith({}),J=(e,t)=>e.distinctUntilChanged((function(){let{layer:e={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{layer:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&e.name===(t&&t.name)})).filter((function(){let{layer:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!e})).switchMap((function(){let{layer:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return V.Observable.defer((()=>(0,X.v$)({layer:e}))).do((e=>{const r=R()((0,_.findGeometryProperty)(e.data||{}),"name");r&&t("geometryName",r)})).map((function(){let{data:e={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return H(e)})).map((e=>({attributes:e,loadingAttributes:!1}))).startWith({loadingAttributes:!0}).catch((e=>V.Observable.of({errorObj:e,loadingAttributes:!1,featureTypeProperties:[]})))})).catch((e=>V.Observable.of({errorObj:e,loadingAttributes:!1,loadingCapabilities:!1,featureTypeProperties:[]}))).startWith({}),K=(0,Q.compose)((0,Q.withPropsOnChange)(["crossLayerFilter"],(function(){let{crossLayerFilter:e={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{queryCollection:R()(e,"collectGeometries.queryCollection"),operation:R()(e,"operation"),distance:R()(e,"distance")}})),(0,Q.withProps)((function(){let{layers:e=[],queryCollection:t={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{layer:A()(e,(function(){let{name:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e===t.typeName}))}})),(0,Q.withHandlers)({setQueryCollectionParameter:e=>{let{setCrossLayerFilterParameter:t=(()=>{})}=e;return(e,r)=>{t(`collectGeometries.queryCollection[${e}]`,r),"typeName"===e&&t("collectGeometries.queryCollection.filterFields",[])}},updateLogicCombo:e=>{let{setCrossLayerFilterParameter:t=(()=>{})}=e;return(e,r)=>t("collectGeometries.queryCollection.groupFields",[{id:e,logic:r,index:0}])},setOperation:e=>{let{setCrossLayerFilterParameter:t=(()=>{})}=e;return e=>t("operation",e)}}),(0,Q.defaultProps)({dataStreamFactory:function(e){let{setQueryCollectionParameter:t=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Y(e).combineLatest(J(e,t),(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{...t,...e}})).startWith({})}}),$.Z);var ee=r(697350),te=r(191332),re=r(23888),oe=r(8204);function se(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ae extends n().Component{constructor(e){super(e),se(this,"getCurrentFilter",(()=>({featureTypeName:this.props.featureTypeName,groupFields:this.props.groupFields,filterFields:this.props.sendFilters&&this.props.sendFilters.attributeFilter&&this.props.filterFields.filter((e=>(0,te.checkOperatorValidity)(e.value,e.operator)))||[],spatialField:this.props.sendFilters&&this.props.sendFilters.spatialFilter&&this.props.spatialField||{attribute:this.props.spatialField&&this.props.spatialField.attribute},pagination:this.props.pagination,filterType:this.props.filterType,ogcVersion:this.props.ogcVersion,sortOptions:this.props.sortOptions,crossLayerFilter:this.props.sendFilters&&this.props.sendFilters.crossLayerFilter&&(0,te.setupCrossLayerFilterDefaults)(this.props.crossLayerFilter)||null,hits:this.props.hits}))),se(this,"isCurrentFilterChanged",(()=>{const e=this.getCurrentFilter(),t={groupFields:e.groupFields,filterFields:e.filterFields,spatialField:e.spatialField,crossLayerFilter:e.crossLayerFilter},r=this.props.appliedFilter||{},o={groupFields:r.groupFields,filterFields:r.attributePanelExpanded&&r.filterFields||[],spatialField:r.spatialPanelExpanded&&r.spatialField||{attribute:this.props.spatialField&&this.props.spatialField.attribute},crossLayerFilter:r.crossLayerExpanded&&r.crossLayerFilter&&r.crossLayerFilter.operation?(0,te.setupCrossLayerFilterDefaults)(r.crossLayerFilter):null};return!s()(t,o)})),se(this,"search",(()=>{let e=this.getCurrentFilter();this.props.actions.onQuery(this.props.searchUrl,e,this.props.params),this.props.advancedToolbar&&this.props.actions.storeAppliedFilter()})),se(this,"reset",(()=>{if(this.props.actions.onChangeDrawingStatus("clean","","queryform",[]),this.props.actions.onReset(),this.props.advancedToolbar){let e={featureTypeName:this.props.featureTypeName,groupFields:[],filterFields:[],spatialField:{attribute:this.props.spatialField&&this.props.spatialField.attribute},pagination:this.props.pagination,filterType:this.props.filterType,ogcVersion:this.props.ogcVersion,sortOptions:this.props.sortOptions,crossLayerFilter:null,hits:this.props.hits};this.props.actions.onQuery(this.props.searchUrl,e,this.props.params),this.props.advancedToolbar&&this.props.actions.storeAppliedFilter()}})),se(this,"restorePersistedFilter",(()=>{this.props.actions.onRestoreFilter()}))}render(){let e=this.props.filterFields.filter((e=>e.exception)).length>0;const t=this.props.allowEmptyFilter&&!this.props.advancedToolbar;let r=this.props.filterFields.filter((e=>e.value||0===e.value)).length>0;const o=(0,te.isFilterEmpty)(this.props),a=(0,te.isFilterEmpty)(this.props.appliedFilter),i=this.isCurrentFilterChanged(),l=r||this.props.spatialField.geometry||(0,te.isCrossLayerFilterValid)(this.props.crossLayerFilter),p=!s()(this.props.appliedFilter,this.props.storedFilter),u=t||o&&this.props.appliedFilter&&!a;let c=e||!this.props.toolbarEnabled||o&&!u||!o&&(!l||!i);const d=this.props.emptyFilterWarning&&o&&i,h=this.props.advancedToolbar?"queryform.apply":this.props.queryBtnMsgId;let m=[{tooltipId:d?"queryform.emptyfilter":h,disabled:c,noTooltipWhenDisabled:!0,glyph:this.props.advancedToolbar?"ok":this.props.queryBtnGlyph,className:d?"square-button-md showWarning":"square-button-md",id:"query-toolbar-query",onClick:this.search}];if(this.props.advancedToolbar){const e=!p||this.props.loadingError||i,t=!p||!this.props.storedFilter||!this.props.toolbarEnabled,r=!this.props.appliedFilter||this.props.appliedFilter&&a||!this.props.toolbarEnabled;m=m.concat([{tooltipId:"queryform.save",disabled:e,noTooltipWhenDisabled:!0,glyph:"floppy-disk",id:"query-toolbar-save",onClick:this.props.actions.onSaveFilter},{tooltipId:"queryform.discard",disabled:t,noTooltipWhenDisabled:!0,glyph:"undo",id:"query-toolbar-discard",onClick:this.restorePersistedFilter},{tooltipId:"queryform.reset",glyph:"clear-filter",noTooltipWhenDisabled:!0,id:"reset",disabled:r,onClick:this.reset}])}else m=[{tooltipId:"queryform.reset",glyph:"clear-filter",noTooltipWhenDisabled:!0,id:"reset",disabled:!this.props.toolbarEnabled,onClick:this.reset}].concat(m);return n().createElement("div",{className:"container-fluid query-toolbar"},n().createElement(oe.Z,{btnDefaultProps:{bsStyle:"primary",className:"square-button-md",tooltipPosition:"bottom"},className:"queryFormToolbar row-fluid pull-right",buttons:m}),n().createElement(ee.Z,{show:!!this.props.showGeneratedFilter,bsSize:"large"},n().createElement(ee.Z.Header,null,n().createElement(ee.Z.Title,null,this.props.resultTitle)),n().createElement(ee.Z.Body,null,n().createElement("textarea",{style:{width:"862px",maxWidth:"862px",height:"236px",maxHeight:"236px"}},this.props.showGeneratedFilter)),n().createElement(ee.Z.Footer,null,n().createElement(re.Z,{style:{float:"right"},onClick:()=>this.props.actions.onQuery(null,null)},"Close"))))}}se(ae,"propTypes",{filterType:i().string,params:i().object,filterFields:i().array,groupFields:i().array,spatialField:i().object,sendFilters:i().object,crossLayerFilter:i().object,toolbarEnabled:i().bool,searchUrl:i().string,showGeneratedFilter:i().oneOfType([i().bool,i().string]),featureTypeName:i().string,actions:i().object,ogcVersion:i().string,titleMsgId:i().string,queryBtnMsgId:i().string,resultTitle:i().string,queryBtnGlyph:i().string,pagination:i().object,sortOptions:i().object,hits:i().bool,allowEmptyFilter:i().bool,emptyFilterWarning:i().bool,appliedFilter:i().object,storedFilter:i().object,advancedToolbar:i().bool,loadingError:i().bool}),se(ae,"defaultProps",{sendFilters:{attributeFilter:!0,spatialFilter:!0,crossLayerFilter:!0},filterType:"OGC",params:{},groupFields:[],filterFields:[],spatialField:{},toolbarEnabled:!0,searchUrl:null,showGeneratedFilter:!1,featureTypeName:null,titleMsgId:"queryform.title",queryBtnMsgId:"queryform.query",resultTitle:"Generated Filter",queryBtnGlyph:"search",pagination:null,sortOptions:null,hits:!1,allowEmptyFilter:!1,emptyFilterWarning:!1,advancedToolbar:!1,loadingError:!1,actions:{onQuery:()=>{},onReset:()=>{},onChangeDrawingStatus:()=>{},onSaveFilter:()=>{},onRestoreFilter:()=>{},storeAppliedFilter:()=>{}}});const ie=ae;var le=r(414293),ne=r.n(le),pe=r(556382),ue=r(719648),ce=r(131400),de=r(481330),he=r(701469),me=r.n(he),ge=r(828878),ye=r(348660),fe=r(91175),be=r.n(fe),Fe=r(401811),ve=r(157155);function we(){return we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},we.apply(this,arguments)}function Ee(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class xe extends n().Component{constructor(){super(...arguments),Ee(this,"state",{}),Ee(this,"renderWithTooltip",(e=>{if(this.props.tooltip.customizedTooltip){const t=this.props.tooltip.customizedTooltip;return n().createElement(t,null,e)}const t=n().createElement(q.Tooltip,{id:this.props.tooltip.id},"this.props.tooltip.message");return n().createElement(Fe.Z,{key:this.props.tooltip.overlayTriggerKey,placement:this.props.tooltip.placement,overlay:t},e)})),Ee(this,"renderPagination",(()=>{const e=this.props.pagination.firstPage,t=this.props.pagination.lastPage;return n().createElement("div",{className:"autocomplete-toolbar"},!e&&n().createElement(q.Glyphicon,{className:this.props.prevPageIcon,glyph:this.props.prevPageIcon,onClick:()=>this.props.pagination.loadPrevPage()}),!t&&n().createElement(q.Glyphicon,{className:this.props.nextPageIcon,glyph:this.props.nextPageIcon,onClick:()=>this.props.pagination.loadNextPage()}))})),Ee(this,"renderField",(()=>{const e={emptyList:()=>this.props.busy?"Loading...":(0,ue.S$)(this.context.messages,"queryform.attributefilter.autocomplete.emptyList"),open:(0,ue.S$)(this.context.messages,"queryform.attributefilter.autocomplete.open"),emptyFilter:(0,ue.S$)(this.context.messages,"queryform.attributefilter.autocomplete.emptyFilter")};let t=[];this.props.data&&this.props.data.length>0&&(t=this.props.data.map((e=>e))),this.props.pagination&&this.props.pagination.paginated&&t.length>0&&t.push({[this.props.textField]:"",[this.props.valueField]:"",disabled:!0,pagination:this.renderPagination()});let r=!1;const o=this.props.loading?[]:t,s=this.props.itemComponent,a=n().createElement(I.Combobox,{dropUp:this.props.dropUp,busy:this.props.busy,data:o,disabled:this.props.disabled,itemComponent:e=>n().createElement(s,we({textField:this.props.textField,valueField:this.props.valueField},e)),messages:this.props.messages||e,open:this.props.open,filter:!1,onChange:e=>{this.props.onChange(e,this.props.valueField),r=!0},onFocus:()=>this.props.onFocus(this.props.data),onSelect:e=>{const t=be()(this.props.features.filter((t=>t.properties[this.props.valueField].toLowerCase()===e[this.props.valueField].toLowerCase())));this.props.onSelect(e,t,this.props.srsName,this.props.style)},onToggle:e=>{const t=be()(this.props.features.filter((e=>e.properties[this.props.valueField].toLowerCase()===this.props.selectedValue.toLowerCase())));!e||this.props.selectedValue||this.props.selectedValue||r||this.props.onChange("",this.props.valueField),this.props.onToggle(e,t,this.props.pagination.currentPage),t&&!e&&this.props.onSelect(this.props.selectedValue,t,this.props.srsName,this.props.style),r=!1},textField:this.props.textField,valueField:this.props.valueField,value:this.props.selectedValue});return this.props.tooltip&&this.props.tooltip.enabled?this.renderWithTooltip(a):a}))}render(){let e=this.props.label?n().createElement("label",null,this.props.label):n().createElement("span",null);return n().createElement("div",{className:"autocompleteField"},e,this.renderField())}}Ee(xe,"propTypes",{busy:i().bool,data:i().array,disabled:i().bool,dropUp:i().bool,features:i().array,filter:i().string,itemComponent:i().oneOfType([i().object,i().func]),label:i().string,loading:i().bool,messages:i().object,onChange:i().func,onFocus:i().func,onSelect:i().func,onToggle:i().func,onChangeDrawingStatus:i().func,style:i().style,open:i().bool,pagination:i().object,nextPageIcon:i().string,prevPageIcon:i().string,selectedValue:i().string,srsName:i().string,textField:i().string,tooltip:i().object,valueField:i().string}),Ee(xe,"contextTypes",{messages:i().object}),Ee(xe,"defaultProps",{dropUp:!1,features:[],filter:"",itemComponent:ve.Z,loading:!1,label:null,pagination:{paginated:!0,firstPage:!1,lastPage:!1,loadPrevPage:()=>{},loadNextPage:()=>{}},nextPageIcon:"chevron-right",prevPageIcon:"chevron-left",onFocus:()=>{},onToggle:()=>{},onChange:()=>{},onChangeDrawingStatus:()=>{},onSelect:()=>{},srsName:"EPSG:4326",textField:"label",tooltip:{customizedTooltip:void 0,enabled:!1,id:"",message:void 0,overlayTriggerKey:"",placement:"top"},valueField:"value"});const Se=xe;(0,Q.setObservableConfig)(ge.Z);const Ce=(0,Q.mapPropsStreamWithConfig)(ge.Z)((e=>e.take(1).switchMap((t=>t.autocompleteStreamFactory(e))).combineLatest(e,((e,t)=>({...t,data:me()(e&&e.fetchedData&&e.fetchedData.values)?e.fetchedData.values:[],features:me()(e&&e.fetchedData&&e.fetchedData.features)?e.fetchedData.features:[],valuesCount:e&&e.fetchedData&&e.fetchedData.size,srsName:e&&e.fetchedData&&e.fetchedData.crs,busy:e.busy})))))((e=>{let{open:t,toggle:r,select:o,focus:s,change:a,changed:i,originalValue:l,value:p,valuesCount:u,onChangeDrawingStatus:c,loadNextPage:d,loadPrevPage:h,maxFeatures:m,currentPage:g,itemComponent:y,features:f,busy:b,data:F,loading:v=!1,valueField:w,textField:E,filter:x,srsName:S,style:C}=e;const P=Math.ceil(u/m);return n().createElement(Se,{pagination:{firstPage:1===g,lastPage:P<=g,paginated:!0,loadPrevPage:h,loadNextPage:d,currentPage:g},srsName:S,busy:b,dropUp:!1,data:F,open:t,onChangeDrawingStatus:c,valueField:w,textField:E,itemComponent:y,filter:x,onFocus:s,onToggle:r,onChange:a,onSelect:o,features:f,style:C,selectedValue:i?p:l||p,loading:v})})),Pe=(0,Q.compose)((0,Q.withPropsOnChange)(["valueField"],(()=>({value:void 0}))),(0,Q.withStateHandlers)((e=>({delayDebounce:0,performFetch:!1,open:!1,currentPage:1,maxFeatures:5,changed:e.value,value:e.value,onChangeDrawingStatus:e.onChangeDrawingStatus,itemComponent:e.itemComponent})),{select:()=>e=>({selected:e}),change:e=>(t,r)=>(e.selected||e.open||e.onChangeDrawingStatus("clean","","queryform",[],{}),{delayDebounce:500,selected:!1,changingPage:!1,changed:!0,performFetch:!(e.selected&&!e.changingPage),value:e.selected&&e.changingPage&&e.value||("string"==typeof t?t:t[r]),currentPage:e.changingPage?e.currentPage:1}),focus:e=>t=>t&&0===t.length&&""===e.value?{delayDebounce:0,currentPage:1,performFetch:!0,isToggled:!1,open:!0}:e,toggle:e=>()=>({open:!!e.changingPage||!e.open}),loadNextPage:e=>()=>({currentPage:e.currentPage+1,performFetch:!0,changingPage:!0,delayDebounce:0}),loadPrevPage:e=>()=>({currentPage:e.currentPage-1,performFetch:!0,changingPage:!0,delayDebounce:0})}),(0,Q.withHandlers)({select:function(){let{options:e,onChangeSpatialFilterValue:t=(()=>{}),select:r=(()=>{})}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(o,s,a,i)=>{s&&t({geometry:s.geometry,value:o,feature:s,srsName:a,style:i,options:e,collectGeometries:e&&e.crossLayer?{queryCollection:{typeName:e.crossLayer.typeName,geometryName:e.crossLayer.geometryName,cqlFilter:(0,ye.generateTemplateString)(e.crossLayer.cqlTemplate||"",te.escapeCQLStrings)(s)}}:void 0}),r(!0)}}})),Te=Pe(Ce);var Oe=r(581368),qe=r(267721),Ne=r(727418),Ie=r.n(Ne),je=r(351546);function De(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Le extends n().Component{constructor(){var e;super(...arguments),e=this,De(this,"onUpdateBBOX",(function(t,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace";"replace"===o&&(e.tempExtent[r]=!isNaN(parseFloat(t))&&parseFloat(t)||0);let s=[];for(let t in e.tempExtent)t&&s.push(e.tempExtent[t]);let a=(0,je.reprojectBbox)(s,"EPSG:4326",e.props.projection),i={type:e.props.geometry.type,coordinates:[[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]],[a[0],a[1]]]],projection:e.props.geometry.projection};e.props.onChangeDrawingStatus(o,void 0,"queryform",[i])})),De(this,"onUpdateCircle",(function(t,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace";"replace"===o&&(e.tempCircle[r]=parseFloat(t));let s=isNaN(parseFloat(e.tempCircle.x))||isNaN(parseFloat(e.tempCircle.y))?[e.tempCircle.x,e.tempCircle.y]:(0,je.reproject)([e.tempCircle.x,e.tempCircle.y],"EPSG:4326",e.props.projection);s=void 0===s.x?{x:s[0],y:s[1]}:s;const a={x:isNaN(s.x)?0:s.x,y:isNaN(s.y)?0:s.y};let i={type:e.props.geometry.type,center:a,coordinates:[a.x,a.y],radius:isNaN(e.tempCircle.radius)?0:e.tempCircle.radius,projection:e.props.geometry.projection};e.props.onChangeDrawingStatus(o,void 0,"queryform",[i],{geodesic:e.props.enableGeodesic})})),De(this,"onModifyGeometry",(()=>{"BBOX"===this.props.type?this.onUpdateBBOX(null,null,"endDrawing"):"Circle"===this.props.type&&this.onUpdateCircle(null,null,"endDrawing"),this.props.onShowPanel(!1)})),De(this,"onClosePanel",(()=>{this.resetGeom(),this.props.onShowPanel(!1)})),De(this,"getStep",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Math.min(1/Math.pow(10,Math.ceil(Math.min(e,21)/3)-2),1)})),De(this,"getStepCircle",((e,t)=>{const r=this.getStep(e);return"radius"===t&&!this.isWGS84()&&1e4*r||r})),De(this,"getBBOXDimensions",(e=>{const t=(0,je.reprojectBbox)(e.extent,e.projection,"EPSG:4326");return{west:t[0],sud:t[1],est:t[2],north:t[3]}})),De(this,"getCircleDimensions",(e=>{const t=(0,je.reproject)(e.center,e.projection,"EPSG:4326"),r=(0,je.reproject)(e.center,e.projection,this.props.projection),o=(0,je.reproject)([e.center[0]+e.radius,e.center[1]],e.projection,this.props.projection),s=Math.sqrt((o.x-r.x)*(o.x-r.x)+(o.y-r.y)*(o.y-r.y));return{x:t.x,y:t.y,radius:s}})),De(this,"renderCoordinateField",((e,t)=>n().createElement("div",null,n().createElement("div",{className:"detail-field-title"},t),n().createElement(de.Z,{style:{minWidth:"105px",margin:"auto"},type:"number",id:"queryform_bbox_"+t,step:this.getStep(this.props.zoom),defaultValue:this.roundValue(e,1e6),onChange:e=>this.onUpdateBBOX(e,t)})))),De(this,"renderCircleField",((e,t)=>n().createElement(de.Z,{type:"number",id:"queryform_circle_"+t,defaultValue:this.roundValue(e,"radius"!==t||this.isWGS84()?1e6:100),step:this.getStepCircle(this.props.zoom,t),onChange:e=>this.onUpdateCircle(e,t)}))),De(this,"renderDetailsContent",(()=>{let e,t=this.props.geometry;if("BBOX"===this.props.type){const r=this.getBBOXDimensions(t);e=n().createElement("div",null,n().createElement("div",{className:"container-fluid"},n().createElement(q.Row,null,n().createElement(q.Col,{xs:4},n().createElement("span",null)),n().createElement(q.Col,{xs:4},this.renderCoordinateField(r.north,"north")),n().createElement(q.Col,{xs:4},n().createElement("span",null))),n().createElement(q.Row,null,n().createElement(q.Col,{xs:4},this.renderCoordinateField(r.west,"west")),n().createElement(q.Col,{xs:4},n().createElement("span",null)),n().createElement(q.Col,{xs:4},this.renderCoordinateField(r.est,"est"))),n().createElement(q.Row,null,n().createElement(q.Col,{xs:4},n().createElement("span",null)),n().createElement(q.Col,{xs:4},this.renderCoordinateField(r.sud,"sud")),n().createElement(q.Col,{xs:4},n().createElement("span",null)))),n().createElement("span",null,n().createElement("hr",{width:"90%"}),n().createElement("div",null,n().createElement("h5",null,n().createElement(ce.ZP.Message,{msgId:"queryform.spatialfilter.details.details_bbox_label"})))))}else if("Circle"===this.props.type){const r=this.getCircleDimensions(t),o=(0,je.getUnits)(this.props.projection);e=n().createElement("div",null,n().createElement("div",{className:"container-fluid"},n().createElement(q.Row,null,n().createElement(q.Col,{xs:2},n().createElement("span",null)),n().createElement(q.Col,{xs:2},n().createElement("span",{className:"details-circle-attribute-name"},"x:")),n().createElement(q.Col,{xs:4},this.renderCircleField(r.x,"x")),n().createElement(q.Col,{xs:4},n().createElement("span",null))),n().createElement(q.Row,null,n().createElement(q.Col,{xs:2},n().createElement("span",null)),n().createElement(q.Col,{xs:2},n().createElement("span",{className:"details-circle-attribute-name"},"y:")),n().createElement(q.Col,{xs:4},this.renderCircleField(r.y,"y")),n().createElement(q.Col,{xs:4},n().createElement("span",null))),n().createElement(q.Row,null,n().createElement(q.Col,{xs:2},n().createElement("span",null)),n().createElement(q.Col,{xs:2},n().createElement("span",{className:"details-circle-attribute-name"},n().createElement(ce.ZP.Message,{msgId:"queryform.spatialfilter.details.radius",msgParams:{unit:"degrees"===o?"°":o}}),":")),n().createElement(q.Col,{xs:4},this.renderCircleField(r.radius,"radius")),n().createElement(q.Col,{xs:4},n().createElement("span",null)))),n().createElement("span",null,n().createElement("hr",{width:"90%"}),n().createElement("div",null,n().createElement("h5",null,n().createElement(ce.ZP.Message,{msgId:"queryform.spatialfilter.details.details_circle_label"})))))}return e})),De(this,"isWGS84",(()=>"EPSG:4326"===this.props.projection)),De(this,"roundValue",(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e6;return Math.round(e*t)/t})),De(this,"resetGeom",(()=>{"BBOX"===this.props.type?this.resetBBOX():"Circle"===this.props.type&&this.resetCircle()})),De(this,"resetBBOX",(()=>{for(let e in this.extent)e&&(document.getElementById("queryform_bbox_"+e).value=this.roundValue(this.extent[e],1e6),this.onUpdateBBOX(this.extent[e],e))})),De(this,"resetCircle",(()=>{document.getElementById("queryform_circle_radius").value=this.roundValue(this.circle.radius,100),this.onUpdateCircle(this.circle.radius,"radius"),document.getElementById("queryform_circle_x").value=this.roundValue(this.circle.x,this.isWGS84()?1e6:100),this.onUpdateCircle(this.circle.x,"x"),document.getElementById("queryform_circle_y").value=this.roundValue(this.circle.y,this.isWGS84()?1e6:100),this.onUpdateCircle(this.circle.y,"y")}))}componentDidMount(){const e=this.props.geometry;"BBOX"===this.props.type?(this.extent=this.getBBOXDimensions(e),this.tempExtent=Ie()({},this.extent)):"Circle"===this.props.type&&(this.circle=this.getCircleDimensions(e),this.tempCircle=Ie()({},this.circle))}render(){return n().createElement(O.Z,{buttons:[{key:"confirm",glyph:"ok",tooltipId:"confirm",onClick:()=>this.onModifyGeometry()},{key:"reset",tooltipId:"queryform.reset",glyph:"clear-filter",onClick:()=>this.resetGeom()},{key:"close",glyph:"1-close",onClick:()=>this.onClosePanel(!1)}],title:n().createElement(ce.ZP.Message,{msgId:"queryform.spatialfilter.details.details_header"}),locked:!0,expanded:!0,className:"details-panel",bsStyle:"primary"},this.renderDetailsContent())}}De(Le,"propTypes",{useMapProjection:i().bool,geometry:i().object,type:i().string,onShowPanel:i().func,onChangeDrawingStatus:i().func,zoom:i().number,projection:i().string,enableGeodesic:i().bool}),De(Le,"defaultProps",{useMapProjection:!0,geometry:null,type:null,onShowPanel:()=>{},onChangeDrawingStatus:()=>{}});const Me=Le;function ke(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class We extends n().Component{constructor(){var e;super(...arguments),e=this,ke(this,"state",{open:!1}),ke(this,"getFilter",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"=",o={filterFields:[{attribute:e.props.searchAttribute,operator:r,value:t,type:"list"}]};e.props.dependsOn&&(o.groupFields=[{id:1,logic:"AND",index:0}],o.filterFields[0].groupId=1,e.props.multivalue?(o.groupFields.push({id:2,logic:"OR",groupId:1,index:1}),e.props.dependsOn.value instanceof Array?e.props.dependsOn.value.forEach((t=>{o.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:t,groupId:2,type:"list"})})):o.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:e.props.dependsOn.value,groupId:2,type:"list"})):o.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:e.props.dependsOn.value,groupId:1,type:"list"}));const s=(0,te.toOGCFilter)(e.props.typeName,o,e.props.wfs,e.props.sort||{sortBy:e.props.searchAttribute,sortOrder:"ASC"});return s})),ke(this,"changeZoneValue",((e,t,r)=>{let o;this.setState({open:!1}),o=this.props.multivalue?{value:r.map((e=>e.id)),feature:r.map((e=>e.feature))}:{value:[r],feature:[this.values.filter((e=>e.id===r))[0].feature]},this.props.onChange(this.props.zoneId,o)}))}UNSAFE_componentWillReceiveProps(e){e.values&&!s()(this.props.values,e.values)&&e.values.length>0&&this.setState({open:!0})}render(){this.values=[],this.props.values&&this.props.values.length>0&&(this.values=this.props.values.map((e=>{let t=e;this.props.valueField.split(".").forEach((e=>{t=t?t[e]:null}));let r=e;return this.props.textField.split(".").forEach((e=>{r=r?r[e]:null})),{id:t,name:r,feature:e}})));let e=this.props.label?n().createElement("label",null,this.props.label):n().createElement("span",null),t=this.props.error;return t&&(t="object"!=typeof t?t:t.status+" "+t.statusText+": "+t.data),n().createElement("div",{className:"zone-combo"},e,n().createElement(Oe.Z,{key:(new Date).getTime(),busy:this.props.busy,disabled:this.props.disabled,fieldRowId:this.props.zoneId,valueField:"id",textField:"name",fieldOptions:this.values,fieldValue:this.props.value,fieldName:"zone",fieldException:t,options:{defaultOpen:this.state.open},groupBy:this.props.groupBy?e=>e.feature.properties[this.props.groupBy]:()=>{},multivalue:this.props.multivalue,comboFilter:this.props.comboFilter,onSelect:this.props.onSelect,onUpdateField:this.changeZoneValue,onToggle:e=>{if(e&&(!this.props.values||this.props.values.length<1)){const e=this.getFilter(this.props.searchText,this.props.searchMethod);this.props.onSearch(!0,this.props.zoneId),this.props.onFilter(this.props.url,e,this.props.zoneId)}}}))}}ke(We,"propTypes",{zoneId:i().number,url:i().string,typeName:i().string,wfs:i().string,busy:i().bool,values:i().array,value:i().oneOfType([i().object,i().number,i().string,i().array]),label:i().string,searchText:i().string,searchMethod:i().string,searchAttribute:i().string,sort:i().object,error:i().oneOfType([i().object,i().string]),comboFilter:i().oneOfType([i().bool,i().string,i().func]),groupBy:i().oneOfType([i().string,i().func]),multivalue:i().bool,open:i().bool,disabled:i().bool,dependsOn:i().object,valueField:i().string,textField:i().string,onSearch:i().func,onFilter:i().func,onChange:i().func,onSelect:i().func}),ke(We,"contextTypes",{messages:i().object}),ke(We,"defaultProps",{open:!1,zoneId:null,url:null,typeName:null,wfs:"1.1.0",busy:!1,values:[],value:null,valueField:null,textField:null,label:null,disabled:!1,error:null,searchText:"*",searchMethod:"ilike",searchAttribute:null,comboFilter:"contains",multivalue:!0,groupBy:null,onSearch:()=>{},onFilter:()=>{},onChange:()=>{},onSelect:()=>{}});const Ge=We;function Be(){return Be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},Be.apply(this,arguments)}function Re(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ze extends n().Component{constructor(){var e;super(...arguments),e=this,Re(this,"getMethodFromId",(e=>A()(this.props.spatialMethodOptions,(t=>t&&t.id===e))||null)),Re(this,"renderHeader",(()=>{const e=(0,ue.S$)(this.context.messages,"queryform.spatialfilter.spatial_filter_header");return n().createElement("span",null,n().createElement("span",{style:{cursor:"pointer"},onClick:this.props.actions.onExpandSpatialFilterPanel.bind(null,!this.props.spatialPanelExpanded)},e))})),Re(this,"renderSpatialHeader",(()=>{const e=this.getMethodFromId(this.props.spatialField.method);return n().createElement("div",null,n().createElement(q.Row,{className:"logicHeader inline-form filter-field-row filter-field-fixed-row"},n().createElement(q.Col,{xs:6},n().createElement("div",null,n().createElement(ce.ZP.Message,{msgId:"queryform.spatialfilter.filterType"}))),n().createElement(q.Col,{xs:6},n().createElement(Oe.Z,{itemComponent:e=>n().createElement(qe.Z,Be({customItemClassName:this.getMethodFromId(e.item)&&this.getMethodFromId(e.item).customItemClassName||""},e)),fieldOptions:this.props.spatialMethodOptions.map((e=>(0,ue.S$)(this.context.messages,e.name)||e.name)),placeholder:(0,ue.S$)(this.context.messages,"queryform.spatialfilter.combo_placeholder"),fieldName:"method",fieldRowId:(new Date).getTime(),fieldValue:(0,ue.S$)(this.context.messages,e?e.name:"")||e&&e.name||"",onUpdateField:this.updateSpatialMethod}))))})),Re(this,"renderDwithin",(()=>n().createElement(q.Row,{className:"container-fluid filter-field-fixed-row"},n().createElement(q.Col,{xs:6,className:"filter-text-desc"},n().createElement(ce.ZP.Message,{msgId:"queryform.spatialfilter.dwithin_label"})),n().createElement(q.Col,{xs:6},n().createElement(de.Z,{type:"number",min:"0",defaultValue:"0",disabled:!this.props.spatialField.geometry,id:"queryform_dwithin_field",onChange:e=>this.props.actions.onChangeDwithinValue(e,name)}))))),Re(this,"renderZoneFields",(()=>this.props.spatialField.method&&"ZONE"===this.props.spatialField.method&&this.props.spatialField.zoneFields&&this.props.spatialField.zoneFields.length>0?this.props.spatialField.zoneFields.map((e=>n().createElement(Ge,{key:e.id,open:e.open,zoneId:e.id,url:e.url,typeName:e.typeName,wfs:e.wfs,busy:e.busy,label:e.label,values:e.values,value:e.value,valueField:e.valueField,textField:e.textField,searchText:e.searchText,searchMethod:e.searchMethod,searchAttribute:e.searchAttribute,sort:e.sort,error:e.error,disabled:e.disabled,dependsOn:e.dependson,groupBy:e.groupBy,multivalue:e.multivalue,onSearch:this.props.actions.zoneSearch,onFilter:this.props.actions.zoneFilter,onChange:this.props.actions.zoneChange}))):null)),Re(this,"renderRoiPanel",(()=>{const t=this.getMethodFromId(this.props.spatialField.method),r=t&&t.filterProps&&t.filterProps.valueField&&this.props.spatialField&&this.props.spatialField.value&&this.props.spatialField.value[t.filterProps.valueField];return n().createElement(q.Panel,null,n().createElement("div",{className:"container-fluid"},n().createElement(q.Row,{className:"filter-field-row filter-field-fixed-row"},n().createElement(q.Col,{xs:6},n().createElement("span",null,t&&t.name||t.id)),n().createElement(q.Col,{xs:6},n().createElement(Te,{originalValue:r,key:this.props.spatialField.method,options:t,autocompleteStreamFactory:pe.Vj,valueField:t&&t.filterProps&&t.filterProps.valueField,textField:t&&t.filterProps&&t.filterProps.valueField,url:t&&t.url,filter:"contains",onChangeSpatialFilterValue:this.props.actions.onChangeSpatialFilterValue,onChangeDrawingStatus:function(){e.props.actions.onChangeDrawingStatus(...arguments)},filterProps:t&&t.filterProps})))))})),Re(this,"renderSpatialPanel",((e,t,r)=>n().createElement(q.Panel,{className:"spatial-panel"},this.props.spatialMethodOptions.length>1?this.renderSpatialHeader():n().createElement("span",null),this.renderZoneFields(),this.props.spatialField.method&&this.getMethodFromId(this.props.spatialField.method)&&"wfsGeocoder"===this.getMethodFromId(this.props.spatialField.method).type?this.renderRoiPanel():null,this.props.spatialOperations.length>1?n().createElement(q.Panel,null,n().createElement("div",null,e),r&&"DWITHIN"===r.id?this.renderDwithin():null,n().createElement(q.Row,null,n().createElement(q.Col,{xs:12},t))):n().createElement("span",null)))),Re(this,"renderButtons",(()=>{const e=[],t=this.props.showDetailsButton&&this.props.spatialField.geometry&&(this.props.spatialField.method&&"BBOX"===this.props.spatialField.method||"Circle"===this.props.spatialField.method),r=this.props.spatialField.geometry&&this.props.spatialField.geometry.coordinates;return t&&e.push({glyph:"pencil",onClick:()=>this.props.actions.onShowSpatialSelectionDetails(!0),tooltipId:"queryform.spatialfilter.details.detail_button_label"}),r&&e.push({glyph:"clear-filter",tooltipId:"queryform.spatialfilter.remove",bsStyle:this.props.clearFilterOptions.buttonStyle,className:this.props.clearFilterOptions.className,onClick:()=>this.resetSpatialFilter()}),e})),Re(this,"updateSpatialMethod",((e,t,r)=>{this.props.actions.onShowSpatialSelectionDetails(!1);const o=this.props.spatialMethodOptions.filter((e=>r===((0,ue.S$)(this.context.messages,e.name)||e.name)))[0].id,s=this.getMethodFromId(o);if(this.props.actions.onSelectSpatialMethod(o,t),"wfsGeocoder"!==this.getMethodFromId(o).type)switch(o){case"ZONE":this.changeDrawingStatus("clean","","queryform",[]);break;case"Viewport":this.changeDrawingStatus("clean","","queryform",[]),this.props.actions.onSelectViewportSpatialMethod();break;default:this.changeDrawingStatus("start",o,"queryform",[],{geodesic:!!ne()(s.geodesic)||s.geodesic,stopAfterDrawing:!0})}else this.changeDrawingStatus("clean","","queryform",[])})),Re(this,"updateSpatialOperation",((e,t,r)=>{const o=this.props.spatialOperations.filter((e=>r===(0,ue.S$)(this.context.messages,e.name)))[0].id;this.props.actions.onSelectSpatialOperation(o,t)})),Re(this,"resetSpatialFilter",(()=>{this.changeDrawingStatus("clean","","queryform",[]),this.props.actions.onRemoveSpatialSelection(),this.props.actions.onShowSpatialSelectionDetails(!1)})),Re(this,"changeDrawingStatus",((e,t,r,o,s)=>{this.props.actions.onChangeDrawingStatus(e,void 0!==t?t:this.props.spatialField.method,r,o,s)}))}render(){const e=this.props.spatialOperations.filter((e=>this.props.spatialField.operation===e.id))[0];let t=n().createElement("span",null);"ZONE"!==this.props.spatialField.method&&"Viewport"!==this.props.spatialField.method&&this.getMethodFromId(this.props.spatialField.method)&&"wfsGeocoder"!==this.getMethodFromId(this.props.spatialField.method).type&&(t=this.props.spatialField.geometry?null:n().createElement("span",null,n().createElement("div",{className:"m-label m-caption text-center"},n().createElement(ce.ZP.Message,{msgId:"queryform.spatialfilter.draw_start_label"}))));const r=this.getMethodFromId(this.props.spatialField.method),o=this.props.showDetailsPanel?n().createElement(Me,{useMapProjection:this.props.useMapProjection,enableGeodesic:!!ne()(r.geodesic)||r.geodesic,geometry:this.props.spatialField.geometry,type:this.props.spatialField.method,onShowPanel:this.props.actions.onShowSpatialSelectionDetails,onChangeDrawingStatus:this.changeDrawingStatus,zoom:this.props.zoom,projection:this.props.projection}):n().createElement("span",null),s=n().createElement(q.Row,{className:"filter-field-row inline-form filter-field-fixed-row"},n().createElement(q.Col,{xs:6},n().createElement(ce.ZP.Message,{msgId:"queryform.spatialfilter.geometric_operation"})),n().createElement(q.Col,{xs:6},n().createElement(Oe.Z,{fieldOptions:this.props.spatialOperations.map((e=>(0,ue.S$)(this.context.messages,e.name))),fieldName:"operation",fieldRowId:(new Date).getTime(),fieldValue:(0,ue.S$)(this.context.messages,e?e.name:""),onUpdateField:this.updateSpatialOperation})));return n().createElement("div",{className:"query-filter-container"},this.props.withContainer?n().createElement(O.Z,{id:"spatialFilterPanel",header:this.renderHeader(),buttons:this.renderButtons(),collapsible:!0,expanded:this.props.spatialPanelExpanded,onSwitch:e=>this.props.actions.onExpandSpatialFilterPanel(e)},this.renderSpatialPanel(s,t,e)):this.renderSpatialPanel(s,t,e),o)}}Re(Ze,"propTypes",{useMapProjection:i().bool,spatialField:i().object,spatialOperations:i().array,spatialMethodOptions:i().array,spatialPanelExpanded:i().bool,showDetailsButton:i().bool,clearFilterOptions:i().object,showDetailsPanel:i().bool,withContainer:i().bool,actions:i().object,zoom:i().number,projection:i().string}),Re(Ze,"contextTypes",{messages:i().object}),Re(Ze,"defaultProps",{useMapProjection:!0,spatialField:{},spatialPanelExpanded:!0,showDetailsButton:!0,clearFilterOptions:{className:"square-button-sm no-border",buttonStyle:"default"},showDetailsPanel:!1,withContainer:!0,spatialMethodOptions:[],spatialOperations:[],actions:{onExpandSpatialFilterPanel:()=>{},onSelectSpatialMethod:()=>{},onSelectSpatialOperation:()=>{},onChangeSpatialFilterValue:()=>{},onChangeDrawingStatus:()=>{},onRemoveSpatialSelection:()=>{},onShowSpatialSelectionDetails:()=>{},onSelectViewportSpatialMethod:()=>{},onChangeRegion:()=>{},onChangeDwithinValue:()=>{},zoneFilter:()=>{},zoneSearch:()=>{},zoneChange:()=>{}}});const Ae=Ze;function Ve(){return Ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},Ve.apply(this,arguments)}const Ue=(0,r(389073).Z)((e=>n().createElement("div",Ve({className:"square-button pull-right no-border",style:{display:"flex"}},e),n().createElement(q.Glyphicon,{glyph:"exclamation-mark",className:"text-danger"})))),Xe=function(){let{loadingError:e,onToggleQuery:t=(()=>{}),buttonStyle:r="default"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().createElement("div",{className:"mapstore-block-width"},n().createElement(re.Z,{id:"toc-query-close-button",key:"menu-button",className:"square-button no-border",bsStyle:r,onClick:()=>t()},n().createElement(q.Glyphicon,{glyph:"arrow-left"})),e&&n().createElement(Ue,{popover:{text:n().createElement(T.Z,{msgId:"queryform.loadingError"})}})||n().createElement("div",{className:"square-button pull-right no-border",style:{display:"flex"}},n().createElement(q.Glyphicon,{glyph:"filter",className:"text-primary"})))};function _e(){return _e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},_e.apply(this,arguments)}function ze(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const He=K((function(){let{crossLayerExpanded:e=!0,spatialOperations:t,expandCrossLayerFilterPanel:r=(()=>{}),layers:o=[],errorObj:s,loadingAttributes:a,loadingCapabilities:i,searchUrl:l,queryCollection:p={},attributes:u=[],operation:c,updateLogicCombo:d=(()=>{}),resetCrossLayerFilter:h=(()=>{}),setOperation:m=(()=>{}),setQueryCollectionParameter:g=(()=>{}),addCrossLayerFilterField:y=(()=>{}),updateCrossLayerFilterField:f=(()=>{}),removeCrossLayerFilterField:b=(()=>{}),toggleMenu:F=(()=>{})}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{typeName:v,geometryName:w,filterFields:E,groupFields:x=[{id:1,logic:"OR",index:0}]}=p,S=o.filter((e=>!W(l,e))),C=()=>o.length&&S.length?n().createElement(k.Z,{bsStyle:"link",text:n().createElement(T.Z,{msgId:"queryform.crossLayerFilter.errors.layersExcluded"})}):null;return n().createElement(O.Z,{loading:i,expanded:e&&!i&&!s,error:s,errorMsgId:"queryPanel",buttons:[...v?[{glyph:"clear-filter",tooltipId:"queryform.crossLayerFilter.clear",onClick:()=>h()}]:[]],onSwitch:r,title:n().createElement(T.Z,{msgId:"queryform.crossLayerFilter.title"})},n().createElement(q.Row,{className:"inline-form filter-field-fixed-row"},n().createElement(q.Col,{xs:6},n().createElement("div",null,n().createElement(T.Z,{msgId:"queryform.crossLayerFilter.targetLayer"})," ",C())),n().createElement(q.Col,{xs:6},n().createElement(N.ZP,{clearable:!1,disabled:i||!!s,isLoading:a,options:o.filter((e=>W(l,e))).map((e=>({label:e.title||e.name,value:e.name}))),placeholder:n().createElement(T.Z,{msgId:"queryform.crossLayerFilter.placeholder"}),filter:"contains",value:v,onChange:e=>{g("typeName",e&&e.value)}}))),v&&w?n().createElement(q.Row,{className:"inline-form filter-field-fixed-row"},n().createElement(q.Col,{xs:6},n().createElement("div",null,n().createElement(T.Z,{msgId:"queryform.crossLayerFilter.operation"}))),n().createElement(q.Col,{xs:6},n().createElement(D,{value:c,onChange:function(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m(e)},spatialOperations:G(t)}))):null,v&&w&&c?n().createElement(q.Row,{className:"filter-field-fixed-row"},n().createElement(q.Col,{xs:12},n().createElement(L.Z,{dropUp:!0,autocompleteEnabled:!0,withContainer:!1,attributes:u,groupLevels:-1,filterFields:E,actions:{onUpdateLogicCombo:d,onAddFilterField:y,onUpdateFilterField:f,onRemoveFilterField:b,toggleMenu:F},groupFields:x,filterField:!0}))):null)}));class Qe extends n().Component{render(){if(""!==this.props.featureTypeError)return n().createElement("div",null,n().createElement(Xe,{onToggleQuery:this.props.controlActions.onToggleQuery}),n().createElement("div",{style:{margin:"0 auto","text-align":"center"}},this.props.featureTypeErrorText));const e=n().createElement("div",{className:"m-header"},this.props.header,n().createElement(ie,{sendFilters:{attributeFilter:this.props.attributePanelExpanded,spatialFilter:this.props.spatialPanelExpanded,crossLayerFilter:this.props.crossLayerExpanded},params:this.props.params,filterFields:this.props.filterFields,groupFields:this.props.groupFields,spatialField:this.props.spatialField,toolbarEnabled:this.props.toolbarEnabled,searchUrl:this.props.searchUrl,showGeneratedFilter:this.props.showGeneratedFilter,featureTypeName:this.props.featureTypeName,ogcVersion:this.props.ogcVersion,filterType:this.props.filterType,actions:this.props.queryToolbarActions,resultTitle:this.props.resultTitle,pagination:this.props.pagination,sortOptions:this.props.sortOptions,crossLayerFilter:this.props.crossLayerFilterOptions.crossLayerFilter,hits:this.props.hits,allowEmptyFilter:this.props.allowEmptyFilter,emptyFilterWarning:this.props.emptyFilterWarning,appliedFilter:this.props.appliedFilter,storedFilter:this.props.storedFilter,advancedToolbar:this.props.advancedToolbar,loadingError:this.props.loadingError}));return this.props.attributes.length>0?n().createElement(P.Z,{header:e,className:"mapstore-query-builder",id:"query-form-panel"},n().createElement(L.Z,{buttonStyle:this.props.buttonStyle,removeGroupButtonIcon:this.props.removeGroupButtonIcon,autocompleteEnabled:this.props.autocompleteEnabled,maxFeaturesWPS:this.props.maxFeaturesWPS,attributes:this.props.attributes,groupLevels:this.props.groupLevels,filterFields:this.props.filterFields,groupFields:this.props.groupFields,removeButtonIcon:this.props.removeButtonIcon,addButtonIcon:this.props.addButtonIcon,attributePanelExpanded:this.props.attributePanelExpanded,actions:this.props.attributeFilterActions}),this.props.toolsOptions.hideSpatialFilter?null:n().createElement(Ae,{useMapProjection:this.props.useMapProjection,spatialField:this.props.spatialField,clearFilterOptions:this.props.clearFilterOptions,spatialOperations:this.props.spatialOperations,spatialMethodOptions:this.props.spatialMethodOptions,showDetailsButton:this.props.showDetailsButton,spatialPanelExpanded:this.props.spatialPanelExpanded,showDetailsPanel:this.props.showDetailsPanel,actions:this.props.spatialFilterActions,zoom:this.props.zoom,projection:this.props.projection}),this.props.toolsOptions.hideCrossLayer?null:n().createElement(He,_e({spatialOperations:this.props.spatialOperations,crossLayerExpanded:this.props.crossLayerExpanded,searchUrl:this.props.searchUrl,featureTypeName:this.props.featureTypeName},this.props.crossLayerFilterOptions,this.props.crossLayerFilterActions))):n().createElement("div",{style:{margin:"0 auto",width:"60px"}},n().createElement(C(),{spinnerName:"three-bounce",overrideSpinnerClassName:"spinner"}))}}ze(Qe,"propTypes",{params:i().object,featureTypeConfigUrl:i().string,useMapProjection:i().bool,attributes:i().array,featureTypeError:i().string,featureTypeErrorText:i().node,groupLevels:i().number,maxFeaturesWPS:i().number,filterFields:i().array,groupFields:i().array,spatialField:i().object,removeButtonIcon:i().string,addButtonIcon:i().string,attributePanelExpanded:i().bool,showDetailsButton:i().bool,spatialPanelExpanded:i().bool,crossLayerExpanded:i().bool,showDetailsPanel:i().bool,toolbarEnabled:i().bool,searchUrl:i().string,showGeneratedFilter:i().oneOfType([i().bool,i().string]),filterType:i().string,featureTypeName:i().string,ogcVersion:i().string,attributeFilterActions:i().object,spatialFilterActions:i().object,queryToolbarActions:i().object,resultTitle:i().string,pagination:i().object,sortOptions:i().object,spatialOperations:i().array,spatialMethodOptions:i().array,crossLayerFilterOptions:i().object,crossLayerFilterActions:i().object,hits:i().bool,clearFilterOptions:i().object,buttonStyle:i().string,removeGroupButtonIcon:i().string,maxHeight:i().number,allowEmptyFilter:i().bool,autocompleteEnabled:i().bool,emptyFilterWarning:i().bool,header:i().node,zoom:i().number,projection:i().string,toolsOptions:i().object,appliedFilter:i().object,storedFilter:i().object,advancedToolbar:i().bool,loadingError:i().bool,controlActions:i().object}),ze(Qe,"defaultProps",{params:{},featureTypeConfigUrl:null,useMapProjection:!0,groupLevels:1,buttonStyle:"default",removeGroupButtonIcon:"trash",groupFields:[],filterFields:[],attributes:[],spatialMethodOptions:[],spatialOperations:[],featureTypeError:"",spatialField:{},crossLayerFilter:null,removeButtonIcon:"trash",addButtonIcon:"glyphicon glyphicon-plus",attributePanelExpanded:!0,spatialPanelExpanded:!0,showDetailsPanel:!1,toolbarEnabled:!0,searchUrl:"",showGeneratedFilter:!1,featureTypeName:null,pagination:null,sortOptions:null,hits:!1,maxHeight:830,allowEmptyFilter:!1,autocompleteEnabled:!0,emptyFilterWarning:!1,advancedToolbar:!1,loadingError:!1,attributeFilterActions:{onAddGroupField:()=>{},onAddFilterField:()=>{},onRemoveFilterField:()=>{},onUpdateFilterField:()=>{},onUpdateExceptionField:()=>{},onUpdateLogicCombo:()=>{},onRemoveGroupField:()=>{},onChangeCascadingValue:()=>{},onExpandAttributeFilterPanel:()=>{}},spatialFilterActions:{onExpandSpatialFilterPanel:()=>{},onSelectSpatialMethod:()=>{},onSelectSpatialOperation:()=>{},onChangeDrawingStatus:()=>{},onRemoveSpatialSelection:()=>{},onShowSpatialSelectionDetails:()=>{},onSelectViewportSpatialMethod:()=>{},onChangeDwithinValue:()=>{}},crossLayerFilterOptions:{},crossLayerFilterActions:{},queryToolbarActions:{onQuery:()=>{},onReset:()=>{},onChangeDrawingStatus:()=>{},onSaveFilter:()=>{},onRestoreFilter:()=>{}},toolsOptions:{},controlActions:{onToggleQuery:()=>{}}});const $e=Qe;var Ye=r(466737),Je=r(283604),Ke=r(410240),et=r.n(Ke),tt=r(470509),rt=r.n(tt),ot=r(504518),st=r(69090),at=r(234228),it=r(254020),lt=r(127608),nt=r(134479);const pt={isAutoCompleteEnabled:(e,t)=>e.ofType(v.S0).switchMap((e=>{const r=(0,at.y9)(e.url,{version:"1.0.0",REQUEST:"DescribeProcess",IDENTIFIER:"gs:PagedUnique"},(0,nt.kS)(t.getState()));return null===r?U().Observable.of((0,F.NV)(!1)):U().Observable.fromPromise(rt().post(r,null,{timeout:5e3,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((e=>e.data))).switchMap((e=>et()(e,"<ows:ExceptionReport")?U().Observable.of((0,F.NV)(!1)):U().Observable.of((0,F.NV)(!0)))).catch((()=>U().Observable.of((0,F.NV)(!1))))})),fetchAutocompleteOptionsEpic:(e,t)=>e.ofType(F.l1,F.nh).debounce((e=>U().Observable.timer(e.fieldOptions.delayDebounce||0))).filter((e=>"value"===e.fieldName&&"string"===e.fieldType&&t.getState().queryform.autocompleteEnabled)).switchMap((e=>{var r,o;const s=t.getState(),a=(0,lt.Vx)(s);let i={};var l,n,p,u;if(i=e.type===F.nh?(null===(l=s.queryform.crossLayerFilter)||void 0===l||null===(n=l.collectGeometries)||void 0===n||null===(p=n.queryCollection)||void 0===p||null===(u=p.filterFields)||void 0===u?void 0:u.filter((t=>t.rowId===e.rowId))[0])||{}:s.queryform&&s.queryform.filterFields&&s.queryform.filterFields.filter((t=>t.rowId===e.rowId))[0],"selected"===e.fieldOptions.selected)return U().Observable.from([e.type===F.nh?(0,F.ln)(i,[],0):(0,F.$J)(i,[],0)]);const c=(0,st.getWpsPayload)({attribute:i.attribute,layerName:e.type===F.nh?null===(r=s.queryform.crossLayerFilter)||void 0===r||null===(o=r.collectGeometries)||void 0===o?void 0:o.queryCollection.typeName:(0,it.HY)(s),layerFilter:(0,lt.Vc)(s)||(0,lt.hI)(s),maxFeatures:a,startIndex:e.fieldOptions.currentPage?e.fieldOptions.currentPage-1:1*a,value:e.fieldValue}),d=(0,at.y9)(s.query.url,{outputFormat:"json"},(0,nt.kS)(t.getState()));return null===d?U().Observable.of((0,F.NV)(!1)):U().Observable.fromPromise(rt().post(d,c,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((e=>e.data))).switchMap((t=>{let r=me()(t.values)?t.values:[t.values],o=t.size;return U().Observable.from(e.type===F.nh?[(0,F.ln)(i,r,o),(0,F.js)(e.rowId,!0,"crossLayer")]:[(0,F.$J)(i,r,o),(0,F.js)(e.rowId,!0,"filterField")])})).startWith((0,F.jR)(!0,i,e.type===F.nh?"crossLayer":"filterField")).catch((()=>U().Observable.from([e.type===F.nh?(0,F.ln)(i,[],0):(0,F.$J)(i,[],0),(0,ot.vU)({title:"warning",message:"warning",action:{label:"warning"},autoDismiss:3,position:"tr"}),(0,F.js)(e.rowId,!0,e.type===F.nh?"crossLayer":"filterField")]))).concat([(0,F.jR)(!1,i,e.type===F.nh?"crossLayer":"filterField")])}))};var ut=r(275982),ct=r(612912);const dt={handleLayerFilterPanel:(e,t)=>{let{getState:r}=t;return e.ofType(y.Xs).switchMap((()=>{const t=(0,ct.Iz)(r()),{url:o,name:s,layerFilter:a}=t||{},i=t&&t.search&&t.search.url;return U().Observable.of((0,v.gT)(i||o,s),(0,F.F)(a),(0,y.HH)(a),(0,h.Xg)("queryPanel","enabled",!0)).merge(U().Observable.of((0,v.jG)()).filter((()=>!R()(r(),"query.isLayerFilter"))),e.ofType(F.Wm).switchMap((e=>{let{filterObj:o}=e,s=function(){let{crossLayerFilter:e,spatialField:t,filterFields:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!(r&&be()(r)||t&&t.method&&t.operation&&t.geometry||e&&e.collectGeometries&&e.operation)}(o)?{...R()(r(),"queryform",{})}:void 0;return s&&(s.filterFields=s.attributePanelExpanded&&s.filterFields||[],s.spatialField=s.spatialPanelExpanded&&s.spatialField||null,s.crossLayerFilter=s.crossLayerExpanded&&(0,te.setupCrossLayerFilterDefaults)(s.crossLayerFilter)||null),U().Observable.of(((e,t)=>(0,f.He)(e,{layerFilter:t}))(t.id,s))}))).let((e=>t=>t.takeUntil(e.ofType(h.kM).filter((function(){let{control:e,property:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"queryPanel"===e&&(!t||"enabled"===t)})).merge(e.ofType(ut.nk))))(e)).concat(U().Observable.from([(0,v.jG)(),(0,F.mc)(),(0,m.Yf)("clean","","queryform",[],{})]))}))},restoreSavedFilter:(e,t)=>{let{getState:r}=t;return e.ofType(y.H1).switchMap((()=>{const e={typeName:R()(r(),"state.query.typeName")},t=R()(r(),"state.query.url"),o=R()(r(),"layerFilter.persisted");return U().Observable.of((0,m.Yf)("clean","","queryform",[]),(0,F.F)(o),(0,F.yC)(t,o,e),(0,v.Xc)())}))},onApplyFilter:(e,t)=>{let{getState:r}=t;return e.ofType(y.MY).map((()=>{const e={...R()(r(),"queryform",{})};return(0,y.Xr)(e)}))}};var ht=r(813292),mt=r.n(ht);const gt={updateSpatialFilterValue:e=>e.ofType(F.Wi).switchMap((e=>{let{feature:t,srsName:r,style:o,options:s}=e;return V.Observable.of((0,m.Yf)("drawOrEdit",t.geometry.type,"queryform",[t],{editEnabled:!1,stopAfterDrawing:!0,featureProjection:r},o)).concat(t&&s&&s.autoZoom?[(0,b.Px)(mt()(t),r)]:[])}))};var yt=r(274363),ft=r(472500),bt=r(820709),Ft=r(833517);const vt=e=>({geometry:e.featureTypes[0].properties.filter((e=>0===e.type.indexOf("gml:"))).map((e=>({label:e.name,attribute:e.name,type:"geometry",valueId:"id",valueLabel:"name",values:[]}))),original:e,attributes:H(e)}),wt={};var Et=r(698183),xt=r(13316),St=r(641259),Ct=r(350126),Pt=r(399790),Tt=r(488400);function Ot(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const qt=F.mc.bind(null,"query"),Nt=(0,p.connect)((e=>({useMapProjection:e.queryform.useMapProjection,groupLevels:e.queryform.groupLevels,groupFields:e.queryform.groupFields,filterFields:e.queryform.filterFields,attributes:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes,featureTypeError:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].error,spatialField:e.queryform.spatialField,showDetailsPanel:e.queryform.showDetailsPanel,toolbarEnabled:e.queryform.toolbarEnabled,attributePanelExpanded:e.queryform.attributePanelExpanded,autocompleteEnabled:e.queryform.autocompleteEnabled,crossLayerExpanded:e.queryform.crossLayerExpanded,crossLayerFilterOptions:{layers:(0,lt.GK)(e),crossLayerFilter:(0,lt.qh)(e),...e.queryform.crossLayerFilterOptions||{}},maxFeaturesWPS:e.queryform.maxFeaturesWPS,spatialPanelExpanded:e.queryform.spatialPanelExpanded,featureTypeConfigUrl:e.query&&e.query.url,searchUrl:e.query&&e.query.url,featureTypeName:e.query&&e.query.typeName,ogcVersion:"1.1.0",params:{typeName:e.query&&e.query.typeName},resultTitle:"Query Result",showGeneratedFilter:!1,allowEmptyFilter:!0,emptyFilterWarning:!0,maxHeight:e.map&&e.map.present&&e.map.present.size&&e.map.present.size.height,zoom:((0,yt.Od)(e)||{}).zoom,projection:((0,yt.Od)(e)||{}).projection})),(e=>({attributeFilterActions:(0,c.DE)({onAddGroupField:F.kQ,onAddFilterField:F.jW,onRemoveFilterField:F.JG,onUpdateFilterField:F.q$,onUpdateExceptionField:F.OZ,onUpdateLogicCombo:F.Nc,onRemoveGroupField:F.I5,onChangeCascadingValue:F.QL,toggleMenu:F.js,onExpandAttributeFilterPanel:F.I},e),spatialFilterActions:(0,c.DE)({onChangeSpatialFilterValue:F.uo,onExpandSpatialFilterPanel:F.ku,onSelectSpatialMethod:F.HT,onSelectViewportSpatialMethod:F.lg,onSelectSpatialOperation:F.VF,onChangeDrawingStatus:m.Yf,onRemoveSpatialSelection:F.Ry,onShowSpatialSelectionDetails:F.ZH,onChangeDwithinValue:F.AQ,zoneFilter:F.eJ,zoneSearch:F.uM,zoneChange:F.uP},e),queryToolbarActions:(0,c.DE)({onQuery:F.yC,onReset:qt,onSaveFilter:y.no,onRestoreFilter:y.Nd,storeAppliedFilter:y.Rb,onChangeDrawingStatus:m.Yf},e),crossLayerFilterActions:(0,c.DE)({expandCrossLayerFilterPanel:F.EU,setCrossLayerFilterParameter:F.IV,addCrossLayerFilterField:F.N5,updateCrossLayerFilterField:F.bn,removeCrossLayerFilterField:F.Bm,resetCrossLayerFilter:F.F2,toggleMenu:(e,t)=>(0,F.js)(e,t,"crossLayer")},e),controlActions:(0,c.DE)({onToggleQuery:h.Xi.bind(null,"queryPanel",null)},e)})))($e),It=(0,d.P1)([e=>e.controls&&e.controls.toolbar&&"toc"===e.controls.toolbar.active,ct.Bt,e=>e.layers&&e.layers.settings||{expanded:!1,options:{opacity:1}},e=>e.controls&&e.controls.queryPanel&&e.controls.queryPanel.enabled||!1,e=>(0,Ct.ic)(e,{height:!0}),St.Wy,lt.Vc,lt.hI,e=>e&&e.query&&e.query.isLayerFilter,ct.P_],((e,t,r,o,s,a,i,l,n,p)=>({enabled:e,groups:t,settings:r,querypanelEnabled:o,layout:a?{}:s,appliedFilter:i,storedFilter:l,advancedToolbar:n,loadingError:p})));class jt extends n().Component{constructor(e){super(e),Ot(this,"getNoBackgroundLayers",(e=>"background"!==e.name)),Ot(this,"renderSidebar",(()=>n().createElement(u.Z,{open:this.props.querypanelEnabled,sidebar:this.renderQueryPanel(),sidebarClassName:"query-form-panel-container",touch:!1,styles:{sidebar:{...this.props.layout,zIndex:1024,width:600},overlay:{zIndex:1023,width:0},root:{right:this.props.querypanelEnabled?0:"auto",width:"0",overflow:"visible"},content:{overflowY:"auto"}}},n().createElement("div",null)))),Ot(this,"onToggle",(()=>{this.props.advancedToolbar&&!s()(this.props.appliedFilter,this.props.storedFilter)?this.setState((()=>({showModal:!0}))):this.props.onToggleQuery()})),Ot(this,"restoreAndClose",(()=>{this.setState((()=>({showModal:!1}))),this.props.onRestoreFilter(),this.props.onToggleQuery()})),Ot(this,"storeAndClose",(()=>{this.setState((()=>({showModal:!1}))),this.props.onSaveFilter(),this.props.onToggleQuery()})),Ot(this,"renderQueryPanel",(()=>n().createElement("div",{className:"mapstore-query-builder"},n().createElement(Nt,{header:n().createElement(Xe,{loadingError:this.props.loadingError,onToggleQuery:this.onToggle}),spatialOperations:this.props.spatialOperations,spatialMethodOptions:this.props.spatialMethodOptions,toolsOptions:this.props.toolsOptions,featureTypeErrorText:n().createElement(Tt.Z,{msgId:"layerProperties.featureTypeError"}),appliedFilter:this.props.appliedFilter,storedFilter:this.props.storedFilter,advancedToolbar:this.props.advancedToolbar,loadingError:this.props.loadingError}),n().createElement(Ye.Z,null,n().createElement(Je.Z,{fade:!0,show:this.state.showModal,title:n().createElement(Tt.Z,{msgId:"queryform.changedFilter"}),size:"xs",onClose:()=>this.setState((()=>({showModal:!1}))),buttons:[{bsStyle:"primary",text:n().createElement(Tt.Z,{msgId:"yes"}),onClick:this.storeAndClose},{bsStyle:"primary",text:n().createElement(Tt.Z,{msgId:"no"}),onClick:this.restoreAndClose}]},n().createElement("div",{className:"ms-alert"},n().createElement("div",{className:"ms-alert-center"},n().createElement(Tt.Z,{msgId:this.props.loadingError?"queryform.changedFilterWithErrorAlert":"queryform.changedFilterAlert"})))))))),this.state={showModal:!1}}UNSAFE_componentWillReceiveProps(e){!0===e.querypanelEnabled&&!1===this.props.querypanelEnabled&&this.props.onInit()}render(){return this.renderSidebar()}}Ot(jt,"propTypes",{id:i().number,buttonContent:i().node,groups:i().array,settings:i().object,querypanelEnabled:i().bool,groupStyle:i().object,groupPropertiesChangeHandler:i().func,layerPropertiesChangeHandler:i().func,onToggleGroup:i().func,onToggleLayer:i().func,onToggleQuery:i().func,onZoomToExtent:i().func,retrieveLayerData:i().func,onSort:i().func,onInit:i().func,onSettings:i().func,hideSettings:i().func,updateSettings:i().func,updateNode:i().func,removeNode:i().func,activateRemoveLayer:i().bool,activateLegendTool:i().bool,activateZoomTool:i().bool,activateSettingsTool:i().bool,visibilityCheckType:i().string,settingsOptions:i().object,layout:i().object,toolsOptions:i().object,appliedFilter:i().object,storedFilter:i().object,advancedToolbar:i().bool,onSaveFilter:i().func,onRestoreFilter:i().func}),Ot(jt,"defaultProps",{groupPropertiesChangeHandler:()=>{},layerPropertiesChangeHandler:()=>{},retrieveLayerData:()=>{},onToggleGroup:()=>{},onToggleLayer:()=>{},onToggleQuery:()=>{},onZoomToExtent:()=>{},onSettings:()=>{},onInit:()=>{},updateNode:()=>{},removeNode:()=>{},activateLegendTool:!0,activateZoomTool:!0,activateSettingsTool:!0,activateRemoveLayer:!0,visibilityCheckType:"checkbox",settingsOptions:{},querypanelEnabled:!1,layout:{},toolsOptions:{},onSaveFilter:()=>{},onRestoreFilter:()=>{}});const Dt={QueryPanelPlugin:(0,p.connect)(It,{groupPropertiesChangeHandler:f.WO,layerPropertiesChangeHandler:f.He,retrieveLayerData:g.k,onToggleGroup:(0,Pt.$0)("groups",f.bh),onToggleLayer:(0,Pt.$0)("layers",f.bh),onToggleQuery:h.Xi.bind(null,"queryPanel",null),onSort:(0,Pt.dD)(Pt.lD,f.MK),onSettings:f.RP,onInit:v.Xc,onZoomToExtent:b.Px,hideSettings:f.sF,updateSettings:f.VP,updateNode:f.tV,removeNode:f.ZF,onSaveFilter:y.no,onRestoreFilter:y.Nd})(jt),reducers:{queryform:xt.Z,query:Et.Z,layerFilter:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y.y6:return{...wt,persisted:t.filter,applied:t.filter};case y.H1:return{...e,applied:e.persisted};case y.g$:return{...e,applied:t.filter};case y.Xk:return{...e,persisted:e.applied};case F.Eg:return{...e,applied:void 0};default:return e}}},epics:{featureTypeSelectedEpic:(e,t)=>e.ofType(v.S0).filter((e=>e.url&&e.typeName)).switchMap((e=>{const r=t.getState();if((0,it.hk)(r,e.typeName)){const t=vt((0,it.qj)(r,e.typeName)),o=t.geometry[0]&&t.geometry[0].attribute?t.geometry[0].attribute:"the_geom";return U().Observable.of((0,v.rG)(e.typeName,t),(0,F.DD)(o),U().Scheduler.async)}const o=(0,bt.Li)(r);return o&&"vector"===o.type?U().Observable.defer((()=>rt().get(e.url))).map((t=>{var r={featureTypes:[t.data.featureTypes[0]]},o={geometry:r.featureTypes[0].properties.filter((e=>0===e.name.indexOf("geometry"))).map((e=>e)),original:r,attributes:H(r)};const s=o.geometry[0]&&o.geometry[0].attribute?o.geometry[0].attribute:"the_geom";var a=new Promise((e=>{e((0,F.DD)(s))})).then((()=>new Promise((t=>{t((0,v.rG)(e.typeName,o))}))));return U().Observable.defer((()=>a))})).mergeAll():U().Observable.defer((()=>rt().get(at.ZP.filterUrlParams(e.url,(0,nt.kS)(t.getState()))+"?service=WFS&version=1.1.0&request=DescribeFeatureType&typeName="+e.typeName+"&outputFormat=application/json"))).map((t=>{if("object"==typeof t.data&&t.data.featureTypes&&t.data.featureTypes[0]){const r=vt(t.data),o=r.geometry[0]&&r.geometry[0].attribute?r.geometry[0].attribute:"the_geom";return U().Observable.from([(0,F.DD)(o),(0,v.rG)(e.typeName,r)])}try{JSON.parse(t.data)}catch(t){return U().Observable.from([(0,v.t3)(e.typeName,"Error from WFS: "+t.message),ot.vU({title:"warning",message:"layerProperties.featureTypeErrorInvalidJSON",autoDismiss:3,position:"tc"})])}return U().Observable.from([(0,v.t3)(e.typeName,"Error: feature types are empty")])})).mergeAll().catch((t=>U().Observable.of((0,v.t3)(e.typeName,t.message||t.statusText))))})),wfsQueryEpic:(e,t)=>e.ofType(v.Qq).switchMap((r=>{var o;const s=(a=(i=t.getState()).query&&i.query.featureTypes&&i.query.featureTypes[i.query.typeName]&&i.query.featureTypes[i.query.typeName].attributes&&i.query.featureTypes[i.query.typeName].attributes[0]&&i.query.featureTypes[i.query.typeName].attributes[0].attribute||null)?{sortBy:a,sortOrder:"A"}:{};var a,i;const l=(null==r||null===(o=r.filterObj)||void 0===o?void 0:o.sortOptions)||s,n=it.b0.totalFeatures(t.getState()),p=at.ZP.filterUrlParams(r.searchUrl,(0,nt.kS)(t.getState())),u=(0,bt.Li)(t.getState()),c=(0,bt.lg)(t.getState()),{layerFilter:d,params:h={}}=u??{},m=null==h?void 0:h[A()(Object.keys(h||{}),(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"cql_filter"===e.toLowerCase()}))],g="vector"===(null==u?void 0:u.type)?r.filterObj:(0,te.mergeFiltersToOGC)({ogcVersion:"1.1.0"},m,c?d:null,r.filterObj),{url:y,options:b}=((e,t,r)=>{const o=(0,bt.u$)(r),s=(0,Ft.jo)({id:o},"time")(r),a=(0,ct.CA)(r,o)||{},i=R()(a,'params["time"]');if((0,bt.DK)(r)&&s&&i){const r=(0,ft.parse)(e)||{};return{url:(0,ft.format)({...r,query:{...r.query,time:i}}),options:t}}return{url:e,options:t}})(p,r.queryOptions||{},t.getState()),F={...r.filterObj.pagination,totalFeatures:n,sortOptions:l,...b,layer:u};return U().Observable.merge((0,X.Mc)({...u,name:r.filterObj.featureTypeName||(null==u?void 0:u.name),search:{...(null==u?void 0:u.search)??{},url:y}},g,F).map((e=>(0,v.w_)(e,r.searchUrl,r.filterObj,r.queryOptions,r.reason))).catch((e=>U().Observable.of((0,v.Lm)(e)))).startWith((0,v.Fs)(!0)).concat(U().Observable.of((0,v.Fs)(!1)),U().Observable.of((0,f.kI)(null==u?void 0:u.id)))).takeUntil(e.ofType(v.VN))})),viewportSelectedEpic:(e,t)=>e.ofType(F.On,b.pP).switchMap((e=>{const r=e.type===b.pP?e:(0,yt.Od)(t.getState());if((e.type===F.On||e.type===b.pP&&"Viewport"===(0,lt.BU)(t.getState()))&&r.bbox&&r.bbox.bounds&&r.bbox.crs){const e=Object.keys(r.bbox.bounds).reduce(((e,t)=>Ie()({},e,{[t]:parseFloat(r.bbox.bounds[t])})),{});return U().Observable.of((0,F.ds)(je.default.getViewportGeometry(e,r.bbox.crs)))}return U().Observable.empty()})),redrawSpatialFilterEpic:(e,t)=>e.ofType(v.R1).switchMap((()=>{const e=t.getState(),r=(0,lt.vE)(e),o={type:"Feature",geometry:{type:(0,lt.a8)(e),coordinates:(0,lt.G$)(e)}};let s=(0,lt.Nl)(e)?(0,m.Yf)("drawOrEdit",r.method||"","queryform",[o],{featureProjection:(0,lt.IM)(e),drawEnabled:!1,editEnabled:!1}):(0,m.Yf)("clean",r.method||"","queryform",[],{drawEnabled:!1,editEnabled:!1});return U().Observable.of(s)})),...pt,...gt,...dt}}},488400:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var o=r(171703),s=r(804504);const a=(0,o.connect)((e=>({locale:e.locale&&e.locale.currentLocale,messages:e.locale&&e.locale.messages||[]})))(s.Z)},127608:(e,t,r)=>{"use strict";r.d(t,{qh:()=>p,GK:()=>u,Nl:()=>c,vE:()=>d,gC:()=>h,hI:()=>m,Vc:()=>g,BU:()=>y,Vx:()=>f,a8:()=>b,IM:()=>F,G$:()=>v});var o=r(227361),s=r.n(o),a=r(22222),i=r(612912),l=r(707366),n=r(719648);const p=e=>s()(e,"queryform.crossLayerFilter"),u=e=>((0,i.l2)(e)||[]).filter((function(){let{type:e,group:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"wms"===e&&"background"!==t})).map((t=>{let{title:r,...o}=t;return{...o,title:(0,n.MZ)((0,l.Pz)(e),r)}})),c=e=>s()(e,"queryform.spatialField.geometry"),d=e=>s()(e,"queryform.spatialField"),h=(0,a.P1)((e=>s()(e,"queryform.attributePanelExpanded")),(e=>s()(e,"queryform.spatialPanelExpanded")),(e=>s()(e,"queryform.crossLayerExpanded")),((e,t,r)=>({attributePanelExpanded:e,spatialPanelExpanded:t,crossLayerExpanded:r}))),m=e=>s()(e,"layerFilter.persisted"),g=e=>s()(e,"layerFilter.applied"),y=e=>s()(e,"queryform.spatialField.method"),f=e=>s()(e,"queryform.maxFeaturesWPS"),b=e=>c(e)&&c(e).type||"Polygon",F=e=>c(e)&&c(e).projection||"EPSG =4326",v=e=>c(e)&&c(e).coordinates||[]},69090:(e,t,r)=>{const{isFilterValid:o,toOGCFilterParts:s}=r(191332),a=r(883796),{and:i}=a({});e.exports={getWpsPayload:e=>{let{layerName:t,layerFilter:r,attribute:a,maxFeatures:l,startIndex:n,value:p}=e;const u=p?'<ogc:PropertyIsLike matchCase="false" wildCard="*" singleChar="." escapeChar="!">   <ogc:PropertyName>'+a+"</ogc:PropertyName>   <ogc:Literal>*"+p+"*</ogc:Literal></ogc:PropertyIsLike>":"",c=r&&!r.disabled&&o(r)?s(r,"1.1.0","ogc"):[];return'<wps:Execute xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0.0" service="WPS" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">  <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">gs:PagedUnique</ows:Identifier>  <wps:DataInputs>    <wps:Input>      <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">features</ows:Identifier>      <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">features</ows:Title>      <wps:Data />      <wps:Reference xmlns:xlink="http://www.w3.org/1999/xlink" mimeType="text/xml" xlink:href="http://geoserver/wfs" method="POST">        <wps:Body>         <wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.0.0">           <wfs:Query typeName="'+t+'">'+(u.length>0||c.length>0?'<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml">'+i(...c,u)+"</ogc:Filter>":"")+'             <ogc:SortBy xmlns:ogc="http://www.opengis.net/ogc">               <ogc:SortProperty>                 <ogc:PropertyName>'+a+'</ogc:PropertyName>               </ogc:SortProperty>             </ogc:SortBy>           </wfs:Query>         </wfs:GetFeature>       </wps:Body>     </wps:Reference>   </wps:Input>   <wps:Input>     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">fieldName</ows:Identifier>     <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">fieldName</ows:Title>     <wps:Data>       <wps:LiteralData>'+a+'</wps:LiteralData>     </wps:Data>   </wps:Input>   <wps:Input>     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">maxFeatures</ows:Identifier>     <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">maxFeatures</ows:Title>     <wps:Data>       <wps:LiteralData>'+l+'</wps:LiteralData>     </wps:Data>   </wps:Input>   <wps:Input>     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">startIndex</ows:Identifier>     <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">startIndex</ows:Title>     <wps:Data>       <wps:LiteralData>'+n+'</wps:LiteralData>     </wps:Data>   </wps:Input> </wps:DataInputs> <wps:ResponseForm>   <wps:RawDataOutput mimeType="application/json">     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">result</ows:Identifier>   </wps:RawDataOutput> </wps:ResponseForm></wps:Execute>'}}},768271:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var o=r(923645),s=r.n(o)()((function(e){return e[1]}));s.push([e.id,"",""]);const a=s},506806:(e,t,r)=>{"use strict";var o,s=(o=r(715132))&&o.__esModule?o:{default:o};t.Z=s.default},715132:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),i=r(124852),l=p(i),n=p(r(45697));function p(e){return e&&e.__esModule?e:{default:e}}var u={position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden"},c={zIndex:2,position:"absolute",top:0,bottom:0,transition:"transform .3s ease-out",WebkitTransition:"-webkit-transform .3s ease-out",willChange:"transform",overflowY:"auto"},d={position:"absolute",top:0,left:0,right:0,bottom:0,overflowY:"scroll",WebkitOverflowScrolling:"touch",transition:"left .3s ease-out, right .3s ease-out"},h={zIndex:1,position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0,visibility:"hidden",transition:"opacity .3s ease-out, visibility .3s ease-out",backgroundColor:"rgba(0,0,0,.3)"},m={zIndex:1,position:"fixed",top:0,bottom:0},g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={sidebarWidth:e.defaultSidebarWidth,touchIdentifier:null,touchStartX:null,touchStartY:null,touchCurrentX:null,touchCurrentY:null,dragSupported:!1},r.overlayClicked=r.overlayClicked.bind(r),r.onTouchStart=r.onTouchStart.bind(r),r.onTouchMove=r.onTouchMove.bind(r),r.onTouchEnd=r.onTouchEnd.bind(r),r.onScroll=r.onScroll.bind(r),r.saveSidebarRef=r.saveSidebarRef.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidMount",value:function(){this.setState({dragSupported:"object"===("undefined"==typeof window?"undefined":s(window))&&"ontouchstart"in window}),this.saveSidebarWidth()}},{key:"componentDidUpdate",value:function(){this.isTouching()||this.saveSidebarWidth()}},{key:"onTouchStart",value:function(e){if(!this.isTouching()){var t=e.targetTouches[0];this.setState({touchIdentifier:t.identifier,touchStartX:t.clientX,touchStartY:t.clientY,touchCurrentX:t.clientX,touchCurrentY:t.clientY})}}},{key:"onTouchMove",value:function(e){if(this.isTouching())for(var t=0;t<e.targetTouches.length;t++)if(e.targetTouches[t].identifier===this.state.touchIdentifier){this.setState({touchCurrentX:e.targetTouches[t].clientX,touchCurrentY:e.targetTouches[t].clientY});break}}},{key:"onTouchEnd",value:function(){if(this.isTouching()){var e=this.touchSidebarWidth();(this.props.open&&e<this.state.sidebarWidth-this.props.dragToggleDistance||!this.props.open&&e>this.props.dragToggleDistance)&&this.props.onSetOpen(!this.props.open),this.setState({touchIdentifier:null,touchStartX:null,touchStartY:null,touchCurrentX:null,touchCurrentY:null})}}},{key:"onScroll",value:function(){this.isTouching()&&this.inCancelDistanceOnScroll()&&this.setState({touchIdentifier:null,touchStartX:null,touchStartY:null,touchCurrentX:null,touchCurrentY:null})}},{key:"inCancelDistanceOnScroll",value:function(){return this.props.pullRight?Math.abs(this.state.touchCurrentX-this.state.touchStartX)<20:Math.abs(this.state.touchStartX-this.state.touchCurrentX)<20}},{key:"isTouching",value:function(){return null!==this.state.touchIdentifier}},{key:"overlayClicked",value:function(){this.props.open&&this.props.onSetOpen(!1)}},{key:"saveSidebarWidth",value:function(){var e=this.sidebar.offsetWidth;e!==this.state.sidebarWidth&&this.setState({sidebarWidth:e})}},{key:"saveSidebarRef",value:function(e){this.sidebar=e}},{key:"touchSidebarWidth",value:function(){return this.props.pullRight?this.props.open&&window.innerWidth-this.state.touchStartX<this.state.sidebarWidth?this.state.touchCurrentX>this.state.touchStartX?this.state.sidebarWidth+this.state.touchStartX-this.state.touchCurrentX:this.state.sidebarWidth:Math.min(window.innerWidth-this.state.touchCurrentX,this.state.sidebarWidth):this.props.open&&this.state.touchStartX<this.state.sidebarWidth?this.state.touchCurrentX>this.state.touchStartX?this.state.sidebarWidth:this.state.sidebarWidth-this.state.touchStartX+this.state.touchCurrentX:Math.min(this.state.touchCurrentX,this.state.sidebarWidth)}},{key:"render",value:function(){var e=o({},c,this.props.styles.sidebar),t=o({},d,this.props.styles.content),r=o({},h,this.props.styles.overlay),s=this.state.dragSupported&&this.props.touch,a=this.isTouching(),i={className:this.props.rootClassName,style:o({},u,this.props.styles.root),role:"navigation"},n=void 0;if(this.props.pullRight?(e.right=0,e.transform="translateX(100%)",e.WebkitTransform="translateX(100%)",this.props.shadow&&(e.boxShadow="-2px 2px 4px rgba(0, 0, 0, 0.15)")):(e.left=0,e.transform="translateX(-100%)",e.WebkitTransform="translateX(-100%)",this.props.shadow&&(e.boxShadow="2px 2px 4px rgba(0, 0, 0, 0.15)")),a){var p=this.touchSidebarWidth()/this.state.sidebarWidth;this.props.pullRight?(e.transform="translateX("+100*(1-p)+"%)",e.WebkitTransform="translateX("+100*(1-p)+"%)"):(e.transform="translateX(-"+100*(1-p)+"%)",e.WebkitTransform="translateX(-"+100*(1-p)+"%)"),r.opacity=p,r.visibility="visible"}else this.props.docked?(0!==this.state.sidebarWidth&&(e.transform="translateX(0%)",e.WebkitTransform="translateX(0%)"),this.props.pullRight?t.right=this.state.sidebarWidth+"px":t.left=this.state.sidebarWidth+"px"):this.props.open&&(e.transform="translateX(0%)",e.WebkitTransform="translateX(0%)",r.opacity=1,r.visibility="visible");if(!a&&this.props.transitions||(e.transition="none",e.WebkitTransition="none",t.transition="none",r.transition="none"),s)if(this.props.open)i.onTouchStart=this.onTouchStart,i.onTouchMove=this.onTouchMove,i.onTouchEnd=this.onTouchEnd,i.onTouchCancel=this.onTouchEnd,i.onScroll=this.onScroll;else{var g=o({},m,this.props.styles.dragHandle);g.width=this.props.touchHandleWidth,this.props.pullRight?g.right=0:g.left=0,n=l.default.createElement("div",{style:g,onTouchStart:this.onTouchStart,onTouchMove:this.onTouchMove,onTouchEnd:this.onTouchEnd,onTouchCancel:this.onTouchEnd})}return l.default.createElement("div",i,l.default.createElement("div",{className:this.props.sidebarClassName,style:e,ref:this.saveSidebarRef},this.props.sidebar),l.default.createElement("div",{className:this.props.overlayClassName,style:r,role:"presentation",tabIndex:"0",onClick:this.overlayClicked}),l.default.createElement("div",{className:this.props.contentClassName,style:t},n,this.props.children))}}]),t}(i.Component);g.propTypes={children:n.default.node.isRequired,styles:n.default.shape({root:n.default.object,sidebar:n.default.object,content:n.default.object,overlay:n.default.object,dragHandle:n.default.object}),rootClassName:n.default.string,sidebarClassName:n.default.string,contentClassName:n.default.string,overlayClassName:n.default.string,sidebar:n.default.node.isRequired,docked:n.default.bool,open:n.default.bool,transitions:n.default.bool,touch:n.default.bool,touchHandleWidth:n.default.number,pullRight:n.default.bool,shadow:n.default.bool,dragToggleDistance:n.default.number,onSetOpen:n.default.func,defaultSidebarWidth:n.default.number},g.defaultProps={docked:!1,open:!1,transitions:!0,touch:!0,touchHandleWidth:20,pullRight:!1,shadow:!0,dragToggleDistance:30,onSetOpen:function(){},styles:{},defaultSidebarWidth:0},t.default=g},819412:(e,t,r)=>{var o=r(798098);e.exports=function(e,t){var r=new o.io.GeoJSONReader,s=r.read(JSON.stringify(e.geometry)),a=r.read(JSON.stringify(t.geometry)),i=s.union(a);return{type:"Feature",geometry:i=(new o.io.GeoJSONWriter).write(i),properties:e.properties}}}}]);