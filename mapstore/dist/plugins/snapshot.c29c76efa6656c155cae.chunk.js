(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[8117],{692741:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});const n={GrabMap:null,Preview:null}},239177:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});const n={GrabMap:s(726413).Z,Preview:s(630992).Z}},726413:(e,t,s)=>{"use strict";s.d(t,{Z:()=>E});var n=s(45697),a=s.n(n),o=s(124852),r=s.n(o),i=s(234228),p=s(331655),l=s(618446),h=s.n(l),c=s(461120),m=s.n(c),u=s(459425),d=s.n(u),g=s(882702),y=s(893379),f=s.n(y),v=s(555198);function b(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}f()(v.Z,{insert:"head",singleton:!1}),v.Z.locals;class S extends r().Component{constructor(){super(...arguments),b(this,"getCanvas",(()=>this.refs.canvas)),b(this,"mapChanged",(e=>!h()(e.layers,this.props.layers)||e.active!==this.props.active||e.config!==this.props.config)),b(this,"mapIsLoading",(e=>e.some((e=>e.visibility&&e.loading)))),b(this,"triggerShooting",(e=>{this.previousTimeout&&clearTimeout(this.previousTimeout),this.previousTimeout=setTimeout((()=>{this.doSnapshot(this.props)}),e)})),b(this,"doSnapshot",(e=>{var t=window.getComputedStyle(this.mapDiv).getPropertyValue("left");t="auto"===t?0:t;let s,n,a,o,r,i=this.mapDiv.getElementsByClassName("leaflet-map-pane"),p=i&&i[0],l=p&&p.getElementsByClassName("leaflet-objects-pane"),h=l&&l[0],c=h&&h.getElementsByTagName("svg"),u=c&&c[0]&&c[0].cloneNode(!0);if(u){let e=u.style&&u.style.transform?u.style.transform.replace(/\(|\)|translate3d|translate/g,"").split("px, "):["0","0"];e=[Number.parseFloat(e[0].replace("px","")),Number.parseFloat(e[1].replace("px",""))],e=u.style.transform&&"translate3d"===u.style.transform.substr(0,11)?[0,0]:e,s=c[0]?c[0].getBoundingClientRect().left-e[0]:0,n=c[0]?c[0].getBoundingClientRect().top-e[1]:0,r=c[0].outerHTML?c[0].outerHTML:this.outerHTML(c[0]),o=u.getAttribute("width"),a=u.getAttribute("height"),u.setAttribute("style","")}let y=0;t&&(y=parseInt(t.replace("px",""),10));let f=this.mapDiv.getElementsByClassName("leaflet-map-pane"),v=f&&f[0]&&f[0].style&&f[0].style.transform?f[0].style.transform.replace(/\(|\)|translate3d|translate/g,"").split("px, "):["0","0"];v=[Number.parseFloat(v[0].replace("px","")),Number.parseFloat(v[1].replace("px",""))];let b=this.mapDiv.getElementsByClassName("leaflet-tile-pane"),S=b&&b[0].cloneNode(!0);if(S.style.zIndex=-9999,document.body.appendChild(S),S.style.overflow="hidden",S){let t=[].slice.call(S.getElementsByClassName("leaflet-layer"),0);t.sort((function(e,t){return Number.parseFloat(e.style.zIndex)-Number.parseFloat(t.style.zIndex)}));let i=this.getCanvas(),p=i&&i.getContext("2d");if(!p)return;p.clearRect(0,0,i.width,i.height);let l=function(e){for(let t=0;t<e.children.length;t++)if(e.children[t])for(let s=0;s<e.children[t].children.length;s++)e.children[t].children[s]&&"IMG"===e.children[t].children[s].tagName&&(e.children[t].children[s].style.position="absolute",e.children[t].children[s].style.left=e.children[t].children[s].getBoundingClientRect().left+y+v[0]+"px",e.children[t].children[s].style.top=e.children[t].children[s].getBoundingClientRect().top+v[1]+"px",e.children[t].children[s].style.transform="none")},h=t.map((t=>{let s=this.refs.canvas.cloneNode();return s.width=s.width+y,l(t),m()(t,{canvas:s,logging:!1,proxy:this.proxy,allowTaint:e&&e.allowTaint,useCORS:e&&e.allowTaint})}),this);h=[this.refs.canvas,...h],g.Promise.all(h).then((p=>{let l=p.reduce(((e,s,n)=>{let a=t[n-1];if(void 0===a)return e;let o=e.getContext("2d");return a.style&&!isNaN(Number.parseFloat(a.style.opacity))?o.globalAlpha=Number.parseFloat(a.style.opacity):o.globalAlpha=1,o.drawImage(s,-1*y,0),e})),h=()=>{document.body.removeChild(S);let t=this.mapDiv.getElementsByClassName("leaflet-marker-pane");if(t&&t.length>0){let s=this.refs.canvas.cloneNode();s.width=s.width+y,m()(t,{canvas:s,logging:!1,proxy:this.proxy,allowTaint:e&&e.allowTaint,useCORS:e&&e.allowTaint}).then((e=>{let t=l.getContext("2d");t.globalAlpha=1,t.drawImage(e,-1*y,0),this.props.onStatusChange("READY",this.isTainted(l)),this.props.onSnapshotReady(i,null,null,null,this.isTainted(l))}))}else this.props.onStatusChange("READY",this.isTainted(l)),this.props.onSnapshotReady(i,null,null,null,this.isTainted(l))};if(u){let e=document.createElement("canvas");s=s||0,n=n||0,e.setAttribute("width",Number.parseFloat(o)+y),e.setAttribute("height",a),d()(e,r,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:s,offsetY:n,renderCallback:()=>{l.getContext("2d").drawImage(e,-1*y,0),h()}})}else h()}))}})),b(this,"isTainted",(e=>{let t=(e||this.refs.canvas).getContext("2d");try{return t.getImageData(0,0,1,1),!1}catch(e){return 18===e.code}})),b(this,"exportImage",(()=>this.refs.canvas.toDataURL())),b(this,"outerHTML",(e=>{const t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}))}componentDidMount(){this.mapDiv=document.getElementById(this.props.mapId),this.proxy=null;let e=(0,p.b)();e&&("object"==typeof e&&(e=e.url),this.proxy=-1!==e.indexOf("?url=")?e.replace("?url=",""):e),!this.mapIsLoading(this.props.layers)&&this.props.active&&(this.props.onStatusChange("SHOTING"),this.triggerShooting(this.props.timeout))}UNSAFE_componentWillReceiveProps(e){let t=this.mapIsLoading(e.layers),s=this.mapChanged(e);this.previousTimeout&&clearTimeout(this.previousTimeout),e.active&&!t&&s?this.props.onStatusChange("SHOTING"):e.active||(this.props.onStatusChange("DISABLED"),this.props.snapstate.error&&this.props.onSnapshotError(null))}shouldComponentUpdate(e){return this.mapChanged(e)||this.props.snapstate!==e.snapstate}componentDidUpdate(e){let t=this.mapIsLoading(this.props.layers),s=this.mapChanged(e);!this.props.active||t||!s&&"SHOTING"!==this.props.snapstate.state||this.triggerShooting(this.props.timeout)}componentWillUnmount(){this.previousTimeout&&clearTimeout(this.previousTimeout)}render(){return r().createElement("canvas",{width:this.props.config&&this.props.config.size?this.props.config.size.width:"100%",height:this.props.config&&this.props.config.size?this.props.config.size.height:"100%",style:{maxWidth:"400px",maxHeight:"400px"},ref:"canvas"})}}b(S,"propTypes",{config:i.ZP.PropTypes.config,layers:a().array,snapstate:a().object,active:a().bool,onSnapshotReady:a().func,onStatusChange:a().func,onSnapshotError:a().func,allowTaint:a().bool,browser:a().object,canvas:a().node,timeout:a().number,drawCanvas:a().bool,mapId:a().string}),b(S,"defaultProps",{config:null,layers:[],snapstate:{state:"DISABLED"},active:!1,onSnapshotReady:()=>{},onStatusChange:()=>{},onSnapshotError:()=>{},browser:{},canvas:r().createElement("canvas",null),drawCanvas:!0,mapId:"map",timeout:2e3});const E=S},630992:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=s(726413).Z},446931:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>E});var n=s(893379),a=s.n(n),o=s(546290);a()(o.Z,{insert:"head",singleton:!1}),o.Z.locals,s(532454);var r=s(727418),i=s.n(r),p=s(45697),l=s.n(p),h=s(124852),c=s.n(h),m=s(234228),u=s(918141);function d(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class g extends c().Component{constructor(){super(...arguments),d(this,"renderLayers",(e=>{if(e){let t=this.props.config.projection||"EPSG:3857",s=this;return e.map(((e,n)=>{var a=i()({},e,{srs:t},"wms"===e.type?{forceProxy:!this.props.allowTaint}:{});return c().createElement(u.LLayer,{type:e.type,position:n,key:e.id||e.name,options:a},s.renderLayerContent(e))}))}return null})),d(this,"renderLayerContent",(e=>e.features&&"vector"===e.type?e.features.map((e=>c().createElement(u.Feature,{key:e.id,type:e.type,geometry:e.geometry}))):null)),d(this,"layerLoad",(()=>{if(this.toLoad--,0===this.toLoad){let e=this.refs.snapMap?this.refs.snapMap.map:null;e&&e.once("postrender",(e=>setTimeout((()=>{let t=e.map&&e.map.getTargetElement()&&e.map.getTargetElement().getElementsByTagName("canvas")[0];t&&this.createSnapshot(t)}),500)))}})),d(this,"layerLoading",(()=>{"SHOTING"!==this.props.snapstate.state&&this.props.onStatusChange("SHOTING"),this.toLoad=this.toLoad?this.toLoad:0,this.toLoad++})),d(this,"createSnapshot",(e=>{this.props.onSnapshotReady(e,null,null,null,this.isTainted(e))})),d(this,"isTainted",(e=>{if(e){let t=e.getContext("2d");try{return t.getImageData(0,0,1,1),!1}catch(e){return 18===e.code}}return!1}))}shouldComponentUpdate(e){return e.active||e.active!==this.props.active}componentDidUpdate(){this.props.active||(this.props.onStatusChange("DISABLED"),this.props.snapstate.error&&this.props.onSnapshotError(null))}render(){return this.props.active?c().createElement(u.LMap,{id:"snapshot_hidden_map-"+this.props.id,className:"snapshot_hidden_map",style:{width:this.props.config&&this.props.config.size?this.props.config.size.width:"100%",height:this.props.config&&this.props.config.size?this.props.config.size.height:"100%"},center:this.props.config.center,zoom:this.props.config.zoom,mapStateSource:this.props.config.mapStateSource,projection:this.props.config.projection||"EPSG:3857",zoomControl:!1,onLayerLoading:this.layerLoading,onLayerLoad:this.layerLoad,ref:"snapMap"},this.renderLayers(this.props.layers)):null}}d(g,"propTypes",{id:l().node,config:m.ZP.PropTypes.config,layers:l().array,snapstate:l().object,active:l().bool,onSnapshotReady:l().func,onStatusChange:l().func,onSnapshotError:l().func,allowTaint:l().bool}),d(g,"defaultProps",{config:null,layers:[],snapstate:{state:"DISABLED"},active:!1,onSnapshotReady:()=>{},onStatusChange:()=>{},onSnapshotError:()=>{}});var y=s(331655),f=s(618446),v=s.n(f);function b(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class S extends c().Component{constructor(){super(...arguments),b(this,"getCanvas",(()=>this.refs.canvas)),b(this,"mapChanged",(e=>!v()(e.layers,this.props.layers)||e.active!==this.props.active||e.config!==this.props.config)),b(this,"mapIsLoading",(e=>e.some((e=>e.visibility&&e.loading)))),b(this,"triggerShooting",(e=>{this.previousTimeout&&clearTimeout(this.previousTimeout),this.previousTimeout=setTimeout((()=>{this.doSnapshot()}),e)})),b(this,"doSnapshot",(()=>{var e=document.getElementById(this.props.mapId);let t=e&&e.getElementsByTagName("canvas")[0];if(t&&this.getCanvas()){let e=this.getCanvas(),s=e.getContext("2d");s.clearRect(0,0,e.width,e.height),s.drawImage(t,0,0),this.props.onSnapshotReady(t),this.props.onStatusChange("READY",this.isTainted(t))}})),b(this,"isTainted",(e=>{let t=(e||this.refs.canvas).getContext("2d");try{return t.getImageData(0,0,1,1),!1}catch(e){return 18===e.code}})),b(this,"exportImage",(()=>this.refs.canvas.toDataURL()))}componentDidMount(){this.proxy=null;let e=(0,y.b)();e&&("object"==typeof e&&(e=e.url),this.proxy=-1!==e.indexOf("?url=")?e.replace("?url=",""):e),!this.mapIsLoading(this.props.layers)&&this.props.active&&(this.props.onStatusChange("SHOTING"),this.triggerShooting(this.props.timeout))}UNSAFE_componentWillReceiveProps(e){this.previousTimeout&&clearTimeout(this.previousTimeout),e.active||(this.props.onStatusChange("DISABLED"),this.props.snapstate.error&&this.props.onSnapshotError(null))}shouldComponentUpdate(e){return this.mapChanged(e)||this.props.snapstate!==e.snapstate}componentDidUpdate(e){let t=this.mapIsLoading(this.props.layers),s=this.mapChanged(e);t||!this.props.active||!s&&"SHOTING"!==this.props.snapstate.state||("SHOTING"!==this.props.snapstate.state&&this.props.onStatusChange("SHOTING"),this.triggerShooting(this.props.timeout))}componentWillUnmount(){this.previousTimeout&&clearTimeout(this.previousTimeout)}render(){return c().createElement("canvas",{width:this.props.config&&this.props.config.size?this.props.config.size.width:"100%",height:this.props.config&&this.props.config.size?this.props.config.size.height:"100%",style:{maxWidth:"400px",maxHeight:"400px",width:"100%",visibility:this.props.active?"block":"none"},ref:"canvas"})}}b(S,"propTypes",{config:m.ZP.PropTypes.config,layers:l().array,snapstate:l().object,active:l().bool,onSnapshotReady:l().func,onStatusChange:l().func,onSnapshotError:l().func,allowTaint:l().bool,browser:l().object,canvas:l().node,timeout:l().number,drawCanvas:l().bool,mapId:l().string}),b(S,"defaultProps",{config:null,layers:[],snapstate:{state:"DISABLED"},active:!1,onSnapshotReady:()=>{},onStatusChange:()=>{},onSnapshotError:()=>{},browser:{},canvas:c().createElement("canvas",null),drawCanvas:!0,mapId:"map",timeout:0});const E={GrabMap:g,Preview:S}},918141:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Feature:()=>l,LLayer:()=>h,LMap:()=>c,MeasurementSupport:()=>m,Overview:()=>u,ScaleBar:()=>d,default:()=>g});var n=s(278426),a=s(877758),o=s(323113),r=s(36624),i=s(904101),p=s(37525);const l=n.Z,h=a.Z,c=o.Z,m=r.Z,u=i.Z,d=p.Z,g={LLayer:h,LMap:c,MeasurementSupport:m,Overview:u,ScaleBar:d,Feature:l}},291635:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>te});var n=s(727418),a=s.n(n),o=s(124852),r=s.n(o),i=s(630294),p=s(171703),l=s(22222),h=s(687753),c=s(685476);const m="CHANGE_SNAPSHOT_STATE",u="SNAPSHOT_ERROR",d="SNAPSHOT_READY",g="SNAPSHOT_ADD_QUEUE",y="SNAPSHOT_REMOVE_QUEUE";function f(e){return(0,c.RP)(e,"snapshot.png","image/png"),{type:"SAVE_IMAGE",dataURL:e}}var v=s(893379),b=s.n(v),S=s(150737);b()(S.Z,{insert:"head",singleton:!1}),S.Z.locals;var E=s(618446),w=s.n(E),T=s(45697),C=s.n(T),x=s(234228),I=s(23888),N=s(131400),L=s(804504),q=s(590504),P=s(466737);function R(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.e(5716).then(s.bind(s,365716));class D extends r().Component{render(){return r().createElement("div",{className:"spinner"},r().createElement("div",{className:"spinner-card "+this.props.sSize},r().createElement("div",{className:"spinner-bg spinner-loader"},"Loading.."),r().createElement("div",{className:"spinner-fg"},this.props.value)))}}R(D,"propTypes",{id:C().string,value:C().number,sSize:C().string}),R(D,"defaultProps",{id:"mapstore-basicspinner",value:null,sSize:null});const M=D;var O=s(805025),k=s.n(O),B=s(936817),Z=s.n(B);const A=e=>{const t=s(792806)("./"+e+"/SnapshotSupport").default;return t.default||t};function G(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}let z;class j extends r().Component{constructor(){super(...arguments),G(this,"renderLayers",(()=>this.props.layers.map(((e,t)=>e.visibility?r().createElement("li",{key:t},e.title):null)))),G(this,"renderButton",(e=>r().createElement(I.Z,{bsStyle:this.props.buttonStyle,bsSize:"xs",disabled:!e,onClick:this.onClick},r().createElement(i.Glyphicon,{glyph:"floppy-save",disabled:{}})," ",r().createElement(L.Z,{msgId:this.props.saveBtnText})))),G(this,"renderError",(()=>this.props.snapshot.error?r().createElement(i.Row,{className:"text-center",style:{marginTop:"5px"}},r().createElement("h4",null,r().createElement("span",{className:"label label-danger"}," ",this.props.snapshot.error))):this.isBingOrGoogle()?r().createElement(i.Row,{className:"text-center",style:{marginTop:"5px"}},r().createElement("h4",null,r().createElement("span",{className:"label label-danger"},this.getgoogleBingError()))):null)),G(this,"mapIsLoading",(e=>e.some((e=>e.loading)))),G(this,"renderPreview",(()=>{if(!z.Preview)return r().createElement("div",{className:"snapshot-notsupported"},r().createElement(L.Z,{msgId:"snapshot.notsupported"}));let e,t=this.isBingOrGoogle(),s=this.isSnapshotReady();return e=t?k():Z(),[r().createElement("div",{style:{display:s&&!t?"block":"none"},key:"snapshotPreviewContainer"},t?null:r().createElement(z.Preview,{ref:"snapshotPreview",timeout:this.props.timeout,config:this.props.map,layers:this.props.layers.filter((e=>e.visibility)),snapstate:this.props.snapshot,onStatusChange:this.props.onStatusChange,active:this.props.active&&!t,allowTaint:!0,drawCanvas:s&&!t,browser:this.props.browser})),r().createElement(i.Image,{key:"snapshotLoader",src:e,style:{margin:"0 auto",display:s&&!t?"none":"block"},responsive:!0})]})),G(this,"renderSize",(()=>{const e=this.props.map&&this.props.map.size||{width:100,height:100};return e.width+" X "+e.height})),G(this,"renderSnapshotQueue",(()=>this.props.snapshot.queue&&this.props.snapshot.queue.length>0?r().createElement("div",{key:"counter",style:{margin:"20px"}},this.renderDownloadMessage(),r().createElement(M,{value:this.props.snapshot.queue.length})," "):null)),G(this,"renderDownloadMessage",(()=>r().createElement(L.Z,{msgId:this.props.downloadingMsg}))),G(this,"wrap",(e=>this.props.wrap?this.props.wrapWithPanel?r().createElement(i.Panel,{id:this.props.id,header:r().createElement("span",null,r().createElement("span",{className:"snapshot-panel-title"},r().createElement(L.Z,{msgId:"snapshot.title"})),r().createElement("span",{className:"settings-panel-close panel-close",onClick:this.props.toggleControl})),style:this.props.panelStyle,className:this.props.panelClassName},e):r().createElement(P.Z,null,r().createElement(q.Z,{id:"mapstore-snapshot-panel",style:this.props.panelStyle,bounds:this.props.bounds},r().createElement("span",{role:"header"},r().createElement("span",{className:"snapshot-panel-title"},r().createElement(L.Z,{msgId:"snapshot.title"})),r().createElement("button",{onClick:this.props.toggleControl,className:"print-panel-close close"},this.props.closeGlyph?r().createElement(i.Glyphicon,{glyph:this.props.closeGlyph}):r().createElement("span",null,"×"))),e)):e)),G(this,"renderTaintedMessage",(()=>this.props.snapshot&&this.props.snapshot&&this.props.snapshot.tainted?r().createElement(i.Alert,{bsStyle:"warning"},r().createElement(L.Z,{msgId:"snapshot.taintedMessage"})):null)),G(this,"onClick",(()=>{if(this.refs.snapshotPreview.isTainted())this.createSnapshot();else{let e=this.refs.snapshotPreview.exportImage();this.props.downloadImg(e)}})),G(this,"createSnapshot",(()=>{this.props.onCreateSnapshot({key:(new Date).getTime(),config:this.props.map,layers:this.props.layers.filter((e=>e.visibility)),snapstate:this.props.snapshot,active:this.props.active,allowTaint:!1,drawCanvas:!0,browser:this.props.browser})})),G(this,"isBingOrGoogle",(()=>this.props.layers.some((e=>"google"===e.type&&e.visibility||"bing"===e.type&&e.visibility)))),G(this,"getgoogleBingError",(()=>r().createElement(L.Z,{msgId:this.props.googleBingErrorMsg}))),G(this,"isSnapshotReady",(()=>"READY"===this.props.snapshot.state&&!this.mapIsLoading(this.props.layers)&&this.props.map&&this.props.map.size))}UNSAFE_componentWillMount(){z=A(this.props.mapType)}UNSAFE_componentWillReceiveProps(e){e.mapType!==this.props.mapType&&(z=A(e.mapType))}shouldComponentUpdate(e){return!w()(e.layers,this.props.layers)||e.active!==this.props.active||e.map!==this.props.map||this.props.snapshot!==e.snapshot}render(){let e=this.isBingOrGoogle(),t=this.isSnapshotReady();return this.props.active?this.wrap(r().createElement(i.Grid,{role:"body",className:"snapshot-panel",fluid:!0},r().createElement(i.Row,{key:"main"},r().createElement(i.Col,{key:"previewCol",xs:7,sm:7,md:7},this.renderPreview()),r().createElement(i.Col,{key:"dataCol",xs:5,sm:5,md:5},r().createElement(i.Table,{responsive:!0},r().createElement("tbody",null,r().createElement("tr",null,r().createElement("td",null,r().createElement(L.Z,{msgId:"snapshot.date"})),r().createElement("td",null," ",r().createElement(N.t6,{dateParams:this.props.dateFormat}))),r().createElement("tr",null,r().createElement("td",null,r().createElement(L.Z,{msgId:"snapshot.layers"})),r().createElement("td",null,r().createElement("ul",null,this.renderLayers()))),r().createElement("tr",null,r().createElement("td",null,r().createElement(L.Z,{msgId:"snapshot.size"})),r().createElement("td",null,this.renderSize())))))),this.renderError(),r().createElement(i.Row,{key:"buttons",htopclassName:"pull-right",style:{marginTop:"5px"}},this.renderButton(!e&&t),this.renderTaintedMessage(),this.renderSnapshotQueue()))):null}}G(j,"propTypes",{id:C().string,name:C().oneOfType([C().string,C().element]),saveBtnText:C().oneOfType([C().string,C().element]),map:x.ZP.PropTypes.config,layers:C().array,img:C().object,snapshot:C().object,active:C().bool,status:C().string,browser:C().object,onStatusChange:C().func,onCreateSnapshot:C().func,downloadImg:C().func,serviceBoxUrl:C().string,dateFormat:C().object,googleBingErrorMsg:C().node,downloadingMsg:C().node,timeout:C().number,mapType:C().string,wrap:C().bool,wrapWithPanel:C().bool,panelStyle:C().object,panelClassName:C().string,toggleControl:C().func,style:C().object,closeGlyph:C().string,buttonStyle:C().string}),G(j,"defaultProps",{id:"snapshot_panel",layers:[],snapshot:{state:"DISABLED",img:{}},browser:{},icon:r().createElement(i.Glyphicon,{glyph:"camera"}),onStatusChange:()=>{},onCreateSnapshot:()=>{},toggleControl:()=>{},downloadImg:()=>{},saveBtnText:"snapshot.save",serviceBoxUrl:null,dateFormat:{day:"numeric",month:"long",year:"numeric"},googleBingErrorMsg:"snapshot.googleBingError",downloadingMsg:"snapshot.downloadingSnapshots",timeout:1e3,mapType:"leaflet",wrap:!1,wrapWithPanel:!1,panelStyle:{minWidth:"720px",zIndex:100,position:"absolute",overflow:"auto",top:"60px",right:"100px"},panelClassName:"snapshot-panel",closeGlyph:"1-close",buttonStyle:"primary",bounds:"#container"});const _=j;function U(){return U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},U.apply(this,arguments)}function F(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}let H;class W extends r().Component{constructor(){super(...arguments),F(this,"renderGrabMaps",(e=>e.map((e=>r().createElement(H.GrabMap,U({id:e.key,active:!0,snapstate:"SHOOTING",timeout:0,onSnapshotReady:t=>{this.saveImage(t,e)}},e)))))),F(this,"saveImage",((e,t)=>{try{this.props.onSnapshotError();let s=e.toDataURL();this.props.onRemoveSnapshot(t),setTimeout((()=>{this.props.downloadImg(s)}),0)}catch(e){this.props.onSnapshotError("Error saving snapshot"),this.props.onRemoveSnapshot(t)}}))}UNSAFE_componentWillMount(){H=A(this.props.mapType)}UNSAFE_componentWillReceiveProps(e){e.mapType!==this.props.mapType&&(H=A(e.mapType))}render(){return void 0!==this.props.queue&&this.props.queue.length>0?r().createElement("div",{className:"snapshot_hidden_map"},r().createElement("div",{key:"hiddenGrabMaps",style:{zIndex:-9999}},this.renderGrabMaps(this.props.queue))):r().createElement("noscript",null)}}F(W,"propTypes",{queue:C().array,browser:C().string,onRemoveSnapshot:C().func,onSnapshotError:C().func,downloadImg:C().func,mapType:C().string}),F(W,"contextTypes",{messages:C().object}),F(W,"defaultProps",{onRemoveSnapshot:()=>{},onSnapshotError:()=>{},mapType:"leaflet"});const Y=W;var X=s(612912),Q=s(274363),V=s(101092),$=s(488400);const J=(0,l.P1)([Q.Od,V.$v,X.l2,e=>e.controls&&e.controls.toolbar&&"snapshot"===e.controls.toolbar.active||e.controls.snapshot&&e.controls.snapshot.enabled,e=>e.browser,e=>e.snapshot||{queue:[]}],((e,t,s,n,a,o)=>({map:e,mapType:t,layers:s,active:n,browser:a,snapshot:o}))),K=(0,p.connect)(J,{onCreateSnapshot:function(e){return{type:g,options:e}},onStatusChange:function(e,t){return{type:m,state:e,tainted:t}},downloadImg:f,toggleControl:h.Xi.bind(null,"snapshot",null)})(_),ee=(0,p.connect)((e=>({queue:e.snapshot&&e.snapshot.queue||[]})),{downloadImg:f,onSnapshotError:function(e){return{type:u,error:e}},onRemoveSnapshot:function(e){return{type:y,options:e}}})(Y),te={SnapshotPlugin:a()(ee,{Toolbar:{name:"snapshot",position:8,panel:K,help:r().createElement($.Z,{msgId:"helptexts.snapshot"}),tooltip:"snapshot.tooltip",icon:r().createElement(i.Glyphicon,{glyph:"camera"}),wrap:!0,title:"snapshot.title",exclusive:!0,priority:1},BurgerMenu:{name:"snapshot",position:3,panel:K,text:r().createElement($.Z,{msgId:"snapshot.title"}),icon:r().createElement(i.Glyphicon,{glyph:"camera"}),action:h.Xi.bind(null,"snapshot",null),tools:[ee],priority:2},SidebarMenu:{name:"snapshot",position:3,panel:K,text:r().createElement($.Z,{msgId:"snapshot.title"}),icon:r().createElement(i.Glyphicon,{glyph:"camera"}),tooltip:"snapshot.tooltip",action:h.Xi.bind(null,"snapshot",null),toggle:!0,priority:1}}),reducers:{snapshot:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:return a()({},e,{state:t.state,tainted:t.tainted});case d:return a()({},e,{img:{data:t.imgData,width:t.width,height:t.height,size:t.size}});case u:return a()({},e,{error:t.error});case g:{let s=[];return s=e&&void 0!==e.queue?[...e.queue,t.options]:[t.options],a()({},e,{queue:s})}case y:{let s=e.queue||[];return s=s.filter((e=>e.key!==t.options.key)),a()({},e,{queue:s})}default:return e}}}}},488400:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(171703),a=s(804504);const o=(0,n.connect)((e=>({locale:e.locale&&e.locale.currentLocale,messages:e.locale&&e.locale.messages||[]})))(a.Z)},556233:(e,t,s)=>{"use strict";s.d(t,{rp:()=>p,Ov:()=>h,wd:()=>c,L0:()=>m}),s(701469);var n=s(91175),a=s.n(n),o=s(807654),r=s.n(o);function i(e){var t=Math.floor(e),s=60*(e-t),n=Math.floor(s),a=60*(s-n);return t+"° "+n+"' "+Math.floor(a)+"'' "}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,{measureTrueBearing:t=!1,fractionDigits:s=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="";if(t){let t="";e>=0&&e<10?t="00":e>10&&e<100&&(t="0"),n=t+(s>0?e.toFixed(s):Math.floor(e))+"°"}else e>=0&&e<90?n="N "+i(e)+"E":e>90&&e<=180?n="S "+i(180-e)+"E":e>180&&e<270?n="S "+i(e-180)+"W":e>=270&&e<=360&&(n="N "+i(360-e)+"W");return n}const l={yd:{ft:3,m:.9144,km:9144e-7,yd:1,mi:.00056818181818,nm:.00049373650107},ft:{ft:1,m:.3048,km:3048e-7,yd:.33333333333334,mi:.0001893932,nm:164579e-9},m:{ft:3.28084,m:1,km:.001,yd:1.0936132983377,mi:621371e-9,nm:.000539956803},km:{ft:3280.84,m:1e3,km:1,yd:1093.6132983377,mi:.62137121212121,nm:.5399568207343395},mi:{ft:5280.000168959982,m:1609.3440514990027,km:1.6093440514990027,yd:1760,mi:1,nm:.8689762697078849},nm:{ft:6076.115679999979,m:1852.0000592639938,km:1.8520000592639938,yd:2025.3718285214,mi:1.150779484848481,nm:1},sqft:{sqft:1,sqm:.09290304,sqkm:9.2903043596611e-8,sqmi:3.587e-8,sqnm:2.7051601137505e-8},sqyd:{sqft:8.9999247491639,sqm:.83612040133779,sqkm:8.3612040133779e-7,sqyd:1,sqmi:3.228278917579e-7,sqnm:2.4346237458194e-7},sqm:{sqft:10.76391,sqm:1,sqkm:1e-6,sqyd:1.196,sqmi:3.8610215854245e-7,sqnm:2.91181e-7},sqkm:{sqft:10763910,sqm:1e6,sqkm:1,sqyd:1196e3,sqmi:.38610215854245,sqnm:.291181},sqmi:{sqft:27878398.920726,sqm:2589988.110336,sqkm:2.589988110336,sqyd:27878398.920726,sqmi:1,sqnm:.75415532795574},sqnm:{sqft:36966388.603652,sqm:3434290.0120544,sqkm:3.4342900120544,sqyd:36966388.603652,sqmi:1.325986786715,sqnm:1}};function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"m",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"m";return l[t]&&l[t][s]?e*l[t][s]:e}const c=e=>!r()(parseFloat(e[0]))&&!r()(parseFloat(e[1])),m=function(){let{coordinates:e,type:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=e;if("LineString"===t){if(s=e.filter(c),s.length<2)return[]}else if("Polygon"===t){if(s=a()(e).filter(c),s.length<3)return[[]];s=[s.concat([a()(s)])]}return s}},555198:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(923645),a=s.n(n)()((function(e){return e[1]}));a.push([e.id,"  .ms2 .snapshot_hidden_map{\n            position:absolute;\n            width: 100%;\n            height: 100%;\n            margin: 0;\n            padding: 0;\n            visibility: hidden;\n            overflow: hidden;\n            z-index:-1000;\n        }\n",""]);const o=a},546290:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(923645),a=s.n(n)()((function(e){return e[1]}));a.push([e.id,"  .ms2 .snapshot_hidden_map{\n            position:absolute;\n            width: 100%;\n            height: 100%;\n            margin: 0;\n            padding: 0;\n            visibility: hidden;\n            overflow: hidden;\n            z-index:-1000;\n        }\n",""]);const o=a},150737:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(923645),a=s.n(n)()((function(e){return e[1]}));a.push([e.id," .ms2 .snapshot-panel {\n    width: 700px;\n}\n.ms2 .snapshot-panel ul {\n    list-style:none;\n    padding-left:0;\n}\n\n.ms2 #mapstore-snapshot-panel {\n    position: absolute;\n    right: 200px;\n    min-width: 725px;\n}\n",""]);const o=a},805025:(e,t,s)=>{e.exports=s.p+"web/client/components/mapcontrols/Snapshot/not-available.png"},936817:(e,t,s)=>{e.exports=s.p+"web/client/components/mapcontrols/Snapshot/shoting.gif"},792806:(e,t,s)=>{var n={"./cesium/SnapshotSupport":692741,"./leaflet/SnapshotSupport":239177,"./openlayers/SnapshotSupport":446931};function a(e){var t=o(e);return s(t)}function o(e){if(!s.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=o,e.exports=a,a.id=792806}}]);